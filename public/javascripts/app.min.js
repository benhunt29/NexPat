var app=angular.module("NextPat",["ngRoute"]);app.config(["$routeProvider","$locationProvider",function(e,t){t.html5Mode(!0),e.when("/",{templateUrl:"/views/home.html",controller:"mainController"}).when("/about",{templateUrl:"/views/about.html",controller:"aboutController"}).when("/contact",{templateUrl:"/views/contact.html",controller:"contactController"}).when("/login",{templateUrl:"/views/login.html",controller:"loginController"}).when("/signUp",{templateUrl:"/views/signUp.html",controller:"loginController"}).when("/questionnaire",{templateUrl:"/views/questionnaire.html",controller:"questionnaireController"}).when("/help",{templateUrl:"/views/help.html",controller:"helpController"}).otherwise({redirectTo:"/"})}]),app.controller("mainController",["$scope","$location",function(e,t){var o=[{question:"Have you been here before?",route:"login"},{question:"Would you like to sign up?",route:"signUp"},{question:"Okay, your information will not be saved."}];e.question=o[0].question;var n=0;e.showButtons=!0,e.getQuestion=function(r){var i=(o[n].question,o[n].route);r?t.path(i):(n++,e.question=o[n].question,n==o.length-1&&(e.showButtons=!1))}}]),app.controller("aboutController",["$scope",function(e){e.message="I'm a page that describes this application!"}]),app.controller("contactController",["$scope",function(e){e.message="I'm a page that tells you how to yell (by writing an all-caps email) at the developer!"}]),app.controller("signUpController",["$scope","$http",function(e,t){}]),app.controller("loginController",["$scope","$http","authService","$location","$rootScope",function(e,t,o,n,r){e.submit=function(){t.post("api/login",e.form).then(function(e){o.saveToken(e.data),r.user=o.getUser(),n.path("/questionnaire")})}}]),app.controller("navCtrl",["authService","$scope","$rootScope","$location",function(e,t,o,n){o.user=e.getUser(),o.user&&o.user.username&&n.path("/questionnaire"),t.logout=function(){e.logout(),o.user=e.getUser(),n.path("/login")}}]),app.controller("helpController",["$scope",function(e){e.message="I'm a help page that currently doesn't help at all"}]),app.controller("questionnaireController",["$rootScope","$scope","$location","$http",function(e,t,o,n){var r=[{question:"Are you interested in living abroad?",type:"boolean"},{question:"Do you speak any languages besides English?",type:"boolean"},{question:"What field do you work in?",type:"list",answerOptions:["Technology","Engineering","Finance","Law","Business"]}],i=1;t.type=r[0].type,t.question=r[0].question,t.getQuestion=function(e){i==r.length?(t.question="Your list is being generated!",t.type=""):(t.question=r[i].question,t.type=r[i].type,"list"==t.type&&(t.list=r[i].answerOptions),r[i-1].answer=e,i++)},t.addCountry=function(){n.post("/api/userCountries",{username:e.user.username,userCountries:["france","germany","spain"]}).then(function(e){t.userCountries=e.userCountries})}}]),app.service("authService",["$window",function(e){this.parseJwt=function(t){if(t){var o=t.split(".")[1],n=o.replace("-","+").replace("_","/");return JSON.parse(e.atob(n))}return{}},this.saveToken=function(t){e.localStorage.jwtToken=t,console.log("Saved token:",e.localStorage.jwtToken)},this.getToken=function(){return e.localStorage.jwtToken},this.isAuthed=function(){var e=this.getToken();if(e){var t=this.parseJwt(e),o=Math.round((new Date).getTime()/1e3)<=t.exp;return o||this.logout(),o}return!1},this.logout=function(){delete e.localStorage.jwtToken},this.getUser=function(){return this.parseJwt(this.getToken())}}]),app.factory("authInterceptor",["$q","$location","authService",function(e,t,o){return{request:function(e){return e.headers=e.headers||{},o.isAuthed()&&(e.headers.Authorization="Bearer "+o.getToken()),e},response:function(o){return 401===o.status&&t.path("/login"),o||e.when(o)},responseError:function(o){return 401===o.status?t.path("/login"):console.log(o),e.reject(o)}}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJHJvdXRlUHJvdmlkZXIiLCIkbG9jYXRpb25Qcm92aWRlciIsImh0bWw1TW9kZSIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJvdGhlcndpc2UiLCJyZWRpcmVjdFRvIiwiJHNjb3BlIiwiJGxvY2F0aW9uIiwiaW50cm9RdWVzdGlvbnMiLCJxdWVzdGlvbiIsInJvdXRlIiwicXVlc3Rpb25OdW0iLCJzaG93QnV0dG9ucyIsImdldFF1ZXN0aW9uIiwiYW5zd2VyIiwicGF0aCIsImxlbmd0aCIsIm1lc3NhZ2UiLCIkaHR0cCIsImF1dGhTZXJ2aWNlIiwiJHJvb3RTY29wZSIsInN1Ym1pdCIsInBvc3QiLCJmb3JtIiwidGhlbiIsInJlc3BvbnNlIiwic2F2ZVRva2VuIiwiZGF0YSIsInVzZXIiLCJnZXRVc2VyIiwidXNlcm5hbWUiLCJsb2dvdXQiLCJxdWVzdGlvbnMiLCJ0eXBlIiwiYW5zd2VyT3B0aW9ucyIsImxpc3QiLCJhZGRDb3VudHJ5IiwidXNlckNvdW50cmllcyIsInNlcnZpY2UiLCIkd2luZG93IiwidGhpcyIsInBhcnNlSnd0IiwidG9rZW4iLCJiYXNlNjRVcmwiLCJzcGxpdCIsImJhc2U2NCIsInJlcGxhY2UiLCJKU09OIiwicGFyc2UiLCJhdG9iIiwibG9jYWxTdG9yYWdlIiwiand0VG9rZW4iLCJjb25zb2xlIiwibG9nIiwiZ2V0VG9rZW4iLCJpc0F1dGhlZCIsInBhcmFtcyIsIm5vdEV4cGlyZWQiLCJNYXRoIiwicm91bmQiLCJEYXRlIiwiZ2V0VGltZSIsImV4cCIsImZhY3RvcnkiLCIkcSIsInJlcXVlc3QiLCJoZWFkZXJzIiwiQXV0aG9yaXphdGlvbiIsInN0YXR1cyIsInJlc3BvbnNlRXJyb3IiLCJyZWplY3QiXSwibWFwcGluZ3MiOiJBQUFBLEdBQUFBLEtBQUFDLFFBQUFDLE9BQUEsV0FBQSxXQUVBRixLQUFBRyxRQUFB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QUdBN0QsRUFBQVEsS0FBQSxVQUVBVSxHQUFBdUMsRUFBQS9ELEtBQUF3QixJQUNBNEMsY0FBQSxTQUFBNUMsR0FPQSxNQU5BLE9BQUFBLEVBQUEyQyxPQUNBN0QsRUFBQVEsS0FBQSxVQUdBcUMsUUFBQUMsSUFBQTVCLEdBRUF1QyxFQUFBTSxPQUFBN0MiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnTmV4dFBhdCcsIFsnbmdSb3V0ZSddKTtcblxuYXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJywnJGxvY2F0aW9uUHJvdmlkZXInLCBmdW5jdGlvbigkcm91dGVQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIpe1xuXG4gICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xuXG4gICAgJHJvdXRlUHJvdmlkZXIud2hlbignLycsXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2hvbWUuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnbWFpbkNvbnRyb2xsZXInXG4gICAgICAgIH0pLndoZW4oJy9hYm91dCcsXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2Fib3V0Lmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2Fib3V0Q29udHJvbGxlcidcbiAgICAgICAgfSkud2hlbignL2NvbnRhY3QnLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9jb250YWN0Lmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2NvbnRhY3RDb250cm9sbGVyJ1xuICAgICAgICB9KS53aGVuKCcvbG9naW4nLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9sb2dpbi5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdsb2dpbkNvbnRyb2xsZXInXG4gICAgICAgIH0pLndoZW4oJy9zaWduVXAnLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9zaWduVXAuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnbG9naW5Db250cm9sbGVyJ1xuICAgICAgICB9KS53aGVuKCcvcXVlc3Rpb25uYWlyZScsXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL3F1ZXN0aW9ubmFpcmUuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAncXVlc3Rpb25uYWlyZUNvbnRyb2xsZXInXG4gICAgICAgIH0pLndoZW4oJy9oZWxwJyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvaGVscC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdoZWxwQ29udHJvbGxlcidcbiAgICAgICAgfSkub3RoZXJ3aXNlKHtcbiAgICAgICAgcmVkaXJlY3RUbzogJy8nXG4gICAgfSk7XG59XSk7XG5cbmFwcC5jb250cm9sbGVyKCdtYWluQ29udHJvbGxlcicsIFsnJHNjb3BlJywnJGxvY2F0aW9uJywgZnVuY3Rpb24oJHNjb3BlLCRsb2NhdGlvbil7XG5cbiAgICB2YXIgaW50cm9RdWVzdGlvbnMgPSBbe3F1ZXN0aW9uOiBcIkhhdmUgeW91IGJlZW4gaGVyZSBiZWZvcmU/XCIsIHJvdXRlOidsb2dpbid9LFxuICAgICAgICB7cXVlc3Rpb246IFwiV291bGQgeW91IGxpa2UgdG8gc2lnbiB1cD9cIiwgcm91dGU6ICdzaWduVXAnfSxcbiAgICAgICAge3F1ZXN0aW9uOiBcIk9rYXksIHlvdXIgaW5mb3JtYXRpb24gd2lsbCBub3QgYmUgc2F2ZWQuXCJ9XTtcbiAgICAkc2NvcGUucXVlc3Rpb24gPSBpbnRyb1F1ZXN0aW9uc1swXS5xdWVzdGlvbjtcbiAgICB2YXIgcXVlc3Rpb25OdW0gPSAwO1xuICAgICRzY29wZS5zaG93QnV0dG9ucyA9IHRydWU7XG4gICAgJHNjb3BlLmdldFF1ZXN0aW9uID0gZnVuY3Rpb24oYW5zd2VyKSB7XG4gICAgICAgIHZhciBxdWVzdGlvblRleHQgPSBpbnRyb1F1ZXN0aW9uc1txdWVzdGlvbk51bV0ucXVlc3Rpb247XG4gICAgICAgIHZhciByb3V0ZSA9IGludHJvUXVlc3Rpb25zW3F1ZXN0aW9uTnVtXS5yb3V0ZTtcbiAgICAgICAgaWYgKGFuc3dlcikge1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgocm91dGUpO1xuICAgICAgICB9IGVsc2V7XG4gICAgICAgICAgICBxdWVzdGlvbk51bSsrO1xuICAgICAgICAgICAgJHNjb3BlLnF1ZXN0aW9uID0gaW50cm9RdWVzdGlvbnNbcXVlc3Rpb25OdW1dLnF1ZXN0aW9uO1xuICAgICAgICAgICAgaWYocXVlc3Rpb25OdW0gPT0gaW50cm9RdWVzdGlvbnMubGVuZ3RoLTEpe1xuICAgICAgICAgICAgICAgICRzY29wZS5zaG93QnV0dG9ucyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbn1dKTtcblxuYXBwLmNvbnRyb2xsZXIoJ2Fib3V0Q29udHJvbGxlcicsIFsnJHNjb3BlJyxmdW5jdGlvbigkc2NvcGUpe1xuICAgICRzY29wZS5tZXNzYWdlID0gXCJJJ20gYSBwYWdlIHRoYXQgZGVzY3JpYmVzIHRoaXMgYXBwbGljYXRpb24hXCI7XG59XSk7XG5cbmFwcC5jb250cm9sbGVyKCdjb250YWN0Q29udHJvbGxlcicsWyckc2NvcGUnLCBmdW5jdGlvbigkc2NvcGUpe1xuICAgICRzY29wZS5tZXNzYWdlID0gXCJJJ20gYSBwYWdlIHRoYXQgdGVsbHMgeW91IGhvdyB0byB5ZWxsIChieSB3cml0aW5nIGFuIGFsbC1jYXBzIGVtYWlsKSBhdCB0aGUgZGV2ZWxvcGVyIVwiO1xufV0pO1xuXG5hcHAuY29udHJvbGxlcignc2lnblVwQ29udHJvbGxlcicsWyckc2NvcGUnLCckaHR0cCcsIGZ1bmN0aW9uKCRzY29wZSwkaHR0cCl7XG5cblxufV0pO1xuXG5hcHAuY29udHJvbGxlcignbG9naW5Db250cm9sbGVyJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnYXV0aFNlcnZpY2UnLCAnJGxvY2F0aW9uJywgJyRyb290U2NvcGUnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCBhdXRoU2VydmljZSwgJGxvY2F0aW9uLCAkcm9vdFNjb3BlKXtcbiAgICAkc2NvcGUuc3VibWl0ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgJGh0dHAucG9zdCgnYXBpL2xvZ2luJywgJHNjb3BlLmZvcm0pXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBhdXRoU2VydmljZS5zYXZlVG9rZW4ocmVzcG9uc2UuZGF0YSk7XG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS51c2VyID0gYXV0aFNlcnZpY2UuZ2V0VXNlcigpO1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKFwiL3F1ZXN0aW9ubmFpcmVcIik7XG4gICAgICAgICAgICB9KTtcbiAgICB9O1xufV0pO1xuXG5hcHAuY29udHJvbGxlcignbmF2Q3RybCcsIFsnYXV0aFNlcnZpY2UnLCckc2NvcGUnLCckcm9vdFNjb3BlJywnJGxvY2F0aW9uJywgZnVuY3Rpb24oYXV0aFNlcnZpY2UsICRzY29wZSwkcm9vdFNjb3BlLCAkbG9jYXRpb24pe1xuICAgICRyb290U2NvcGUudXNlciA9IGF1dGhTZXJ2aWNlLmdldFVzZXIoKTtcblxuICAgIGlmKCRyb290U2NvcGUudXNlciAmJiAkcm9vdFNjb3BlLnVzZXIudXNlcm5hbWUpe1xuICAgICAgICAkbG9jYXRpb24ucGF0aCgnL3F1ZXN0aW9ubmFpcmUnKTtcbiAgICB9XG5cbiAgICAkc2NvcGUubG9nb3V0ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgYXV0aFNlcnZpY2UubG9nb3V0KCk7XG4gICAgICAgICRyb290U2NvcGUudXNlciA9IGF1dGhTZXJ2aWNlLmdldFVzZXIoKTtcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvbG9naW5cIik7XG4gICAgfVxufV0pO1xuXG5hcHAuY29udHJvbGxlcignaGVscENvbnRyb2xsZXInLFsnJHNjb3BlJywgZnVuY3Rpb24oJHNjb3BlKXtcbiAgICAkc2NvcGUubWVzc2FnZSA9IFwiSSdtIGEgaGVscCBwYWdlIHRoYXQgY3VycmVudGx5IGRvZXNuJ3QgaGVscCBhdCBhbGxcIjtcbn1dKTtcblxuYXBwLmNvbnRyb2xsZXIoJ3F1ZXN0aW9ubmFpcmVDb250cm9sbGVyJyxbJyRyb290U2NvcGUnLCckc2NvcGUnLCckbG9jYXRpb24nLCAnJGh0dHAnLCBmdW5jdGlvbigkcm9vdFNjb3BlLCRzY29wZSwkbG9jYXRpb24sJGh0dHApe1xuXG4gICAgdmFyIHF1ZXN0aW9ucyA9IFt7cXVlc3Rpb246IFwiQXJlIHlvdSBpbnRlcmVzdGVkIGluIGxpdmluZyBhYnJvYWQ/XCIsdHlwZTonYm9vbGVhbid9LFxuICAgICAgICB7cXVlc3Rpb246XCJEbyB5b3Ugc3BlYWsgYW55IGxhbmd1YWdlcyBiZXNpZGVzIEVuZ2xpc2g/XCIsdHlwZTonYm9vbGVhbid9LFxuICAgIHtxdWVzdGlvbjpcIldoYXQgZmllbGQgZG8geW91IHdvcmsgaW4/XCIsdHlwZTonbGlzdCcsYW5zd2VyT3B0aW9uczpbJ1RlY2hub2xvZ3knLCdFbmdpbmVlcmluZycsJ0ZpbmFuY2UnLCdMYXcnLCdCdXNpbmVzcyddfV07XG4gICAgdmFyIHF1ZXN0aW9uTnVtID0gMTtcbiAgICAkc2NvcGUudHlwZSA9IHF1ZXN0aW9uc1swXS50eXBlO1xuICAgICRzY29wZS5xdWVzdGlvbiA9IHF1ZXN0aW9uc1swXS5xdWVzdGlvbjtcbiAgICAkc2NvcGUuZ2V0UXVlc3Rpb24gPSBmdW5jdGlvbihhbnN3ZXIpe1xuXG4gICAgICAgIGlmKHF1ZXN0aW9uTnVtPT1xdWVzdGlvbnMubGVuZ3RoKXtcbiAgICAgICAgICAgICRzY29wZS5xdWVzdGlvbiA9ICdZb3VyIGxpc3QgaXMgYmVpbmcgZ2VuZXJhdGVkISc7XG4gICAgICAgICAgICAkc2NvcGUudHlwZSA9ICcnO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICRzY29wZS5xdWVzdGlvbiA9IHF1ZXN0aW9uc1txdWVzdGlvbk51bV0ucXVlc3Rpb247XG4gICAgICAgICAgICAkc2NvcGUudHlwZSA9IHF1ZXN0aW9uc1txdWVzdGlvbk51bV0udHlwZTtcblxuICAgICAgICAgICAgaWYoJHNjb3BlLnR5cGUgPT0gJ2xpc3QnKXtcbiAgICAgICAgICAgICAgICAkc2NvcGUubGlzdCA9IHF1ZXN0aW9uc1txdWVzdGlvbk51bV0uYW5zd2VyT3B0aW9ucztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHF1ZXN0aW9uc1txdWVzdGlvbk51bS0xXS5hbnN3ZXIgPSBhbnN3ZXI7XG5cbiAgICAgICAgICAgIHF1ZXN0aW9uTnVtKys7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJHNjb3BlLmFkZENvdW50cnkgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgIC8vY29uc29sZS5sb2coJHJvb3RTY29wZS51c2VybmFtZSk7XG4gICAgICAgIC8vJGh0dHAucG9zdCgnL2FwaS91c2VyQ291bnRyaWVzJyx7dXNlcm5hbWU6ICRyb290U2NvcGUudXNlci51c2VybmFtZX0pLlxuICAgICAgICAvLyAgICB0aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgLy8gICAgICAgICRzY29wZS51c2VyQ291bnRyaWVzID0gcmVzcG9uc2UudXNlckNvdW50cmllcztcbiAgICAgICAgLy8gICAgfSk7XG4gICAgICAgICRodHRwLnBvc3QoJy9hcGkvdXNlckNvdW50cmllcycse3VzZXJuYW1lOiAkcm9vdFNjb3BlLnVzZXIudXNlcm5hbWUsdXNlckNvdW50cmllczogWydmcmFuY2UnLCdnZXJtYW55Jywnc3BhaW4nXX0pLlxuICAgICAgICAgICAgdGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnVzZXJDb3VudHJpZXMgPSByZXNwb25zZS51c2VyQ291bnRyaWVzO1xuICAgICAgICAgICAgfSlcbiAgICB9XG5cbn1dKTtcblxuYXBwLnNlcnZpY2UoJ2F1dGhTZXJ2aWNlJywgWyckd2luZG93JywgZnVuY3Rpb24gKCR3aW5kb3cpIHtcbiAgICB0aGlzLnBhcnNlSnd0ID0gZnVuY3Rpb24gKHRva2VuKSB7XG4gICAgICAgIGlmICh0b2tlbikge1xuICAgICAgICAgICAgdmFyIGJhc2U2NFVybCA9IHRva2VuLnNwbGl0KCcuJylbMV07XG4gICAgICAgICAgICB2YXIgYmFzZTY0ID0gYmFzZTY0VXJsLnJlcGxhY2UoJy0nLCAnKycpLnJlcGxhY2UoJ18nLCAnLycpO1xuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoJHdpbmRvdy5hdG9iKGJhc2U2NCkpO1xuICAgICAgICB9IGVsc2UgcmV0dXJuIHt9O1xuICAgIH07XG5cbiAgICB0aGlzLnNhdmVUb2tlbiA9IGZ1bmN0aW9uICh0b2tlbikge1xuICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbiA9IHRva2VuO1xuICAgICAgICBjb25zb2xlLmxvZygnU2F2ZWQgdG9rZW46Jywkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbik7XG4gICAgfTtcblxuICAgIHRoaXMuZ2V0VG9rZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbjtcbiAgICB9O1xuXG4gICAgdGhpcy5pc0F1dGhlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRva2VuID0gdGhpcy5nZXRUb2tlbigpO1xuICAgICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB0aGlzLnBhcnNlSnd0KHRva2VuKTtcbiAgICAgICAgICAgIHZhciBub3RFeHBpcmVkID0gTWF0aC5yb3VuZChuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDApIDw9IHBhcmFtcy5leHA7XG4gICAgICAgICAgICBpZiAoIW5vdEV4cGlyZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ291dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5vdEV4cGlyZWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRlbGV0ZSAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbjtcbiAgICB9O1xuXG4gICAgLy8gZXhwb3NlIHVzZXIgYXMgYW4gb2JqZWN0XG4gICAgdGhpcy5nZXRVc2VyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXJzZUp3dCh0aGlzLmdldFRva2VuKCkpXG4gICAgfTtcbn1dKTtcblxuYXBwLmZhY3RvcnkoJ2F1dGhJbnRlcmNlcHRvcicsIFsnJHEnLCAnJGxvY2F0aW9uJywgJ2F1dGhTZXJ2aWNlJywgZnVuY3Rpb24gKCRxLCAkbG9jYXRpb24sIGF1dGhTZXJ2aWNlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKGNvbmZpZykge1xuICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMgPSBjb25maWcuaGVhZGVycyB8fCB7fTtcbiAgICAgICAgICAgIGlmIChhdXRoU2VydmljZS5pc0F1dGhlZCgpKSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMuQXV0aG9yaXphdGlvbiA9ICdCZWFyZXIgJyArIGF1dGhTZXJ2aWNlLmdldFRva2VuKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gY29uZmlnO1xuICAgICAgICB9LFxuICAgICAgICByZXNwb25zZTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xuXG4gICAgICAgICAgICAgICAgLy8gaGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSB1c2VyIGlzIG5vdCBhdXRoZW50aWNhdGVkXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvbG9naW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UgfHwgJHEud2hlbihyZXNwb25zZSk7XG4gICAgICAgIH0sIHJlc3BvbnNlRXJyb3I6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvbG9naW5cIik7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZXNwb25zZSk7XG4gICAgICAgIH1cbiAgICB9O1xufV0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==