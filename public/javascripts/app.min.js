var app=angular.module("NextPat",["ngRoute","ngMaterial","ngMessages","validation.match"]);app.config(["$httpProvider","$routeProvider","$locationProvider","$mdThemingProvider",function(e,t,n,o){n.html5Mode(!0),e.interceptors.push("authInterceptor"),o.theme("default").primaryPalette("blue-grey").accentPalette("grey").warnPalette("red").backgroundPalette("blue-grey"),t.when("/",{templateUrl:"/views/home.html",controller:"mainController"}).when("/about",{templateUrl:"/views/about.html",controller:"aboutController"}).when("/contact",{templateUrl:"/views/contact.html",controller:"contactController"}).when("/login",{templateUrl:"/views/login.html",controller:"loginController"}).when("/signUp",{templateUrl:"/views/signUp.html",controller:"signUpController"}).when("/questionnaire",{templateUrl:"/views/questionnaire.html",controller:"questionnaireController"}).when("/help",{templateUrl:"/views/help.html",controller:"helpController"}).when("/country",{templateUrl:"/views/country.html",controller:"countryController"}).otherwise({redirectTo:"/"})}]),app.controller("mainController",["$scope","$location",function(e,t){var n=[{question:"Have you been here before?",route:"login"},{question:"Would you like to sign up?",route:"signUp"},{question:"Okay, your information will not be saved."}];e.question=n[0].question;var o=0;e.showButtons=!0,e.getQuestion=function(a){var r=(n[o].question,n[o].route);a?t.path(r):(o++,e.question=n[o].question,o==n.length-1&&(e.showButtons=!1))}}]),app.controller("aboutController",["$scope",function(e){e.message="I'm a page that describes this application!"}]),app.controller("contactController",["$scope",function(e){e.message="I'm a page that tells you how to yell (by writing an all-caps email) at the developer!"}]),app.controller("signUpController",["$scope","$http",function(e,t){e.register=function(){var n={username:e.form.userName,email:e.form.email,password:e.form.password,lastName:e.form.lastName,firstName:e.form.firstName,passwordConfirm:e.form.passwordConfirm};console.log("in here"),t.post("/api/register",n).then(function(e){console.log(e)})}}]),app.controller("countryController",["countryPage","$scope","$http",function(e,t,n){t.countryName=e.name,console.log(t.nationMasterLink)}]),app.controller("loginController",["$scope","$http","authService","$location","$rootScope",function(e,t,n,o,a){e.submit=function(){t.post("api/login",e.form).then(function(e){n.saveToken(e.data),a.user=n.getUser(),o.path("/questionnaire")})},e.googleLogin=function(){}}]),app.controller("navCtrl",["authService","$scope","$rootScope","$location","$http",function(e,t,n,o,a){n.user=e.getUser(),n.user&&n.user.username&&o.path("/questionnaire"),t.logout=function(){a.get("/api/questionnaire/"+n.user.username),a.get("/api/logout").then(function(e){console.log(e)}),e.logout(),n.user=e.getUser(),o.path("/login")}}]),app.controller("helpController",["$scope",function(e){e.message="I'm a help page that currently doesn't help at all"}]),app.controller("questionnaireController",["countryPage","questionnaire","$rootScope","$scope","$location","$http","$log","$q",function(e,t,n,o,a,r,i,s){function u(){return o.list.map(function(e){return{value:e.toLowerCase(),display:e}})}function l(e){var t=angular.lowercase(e);return function(e){return 0===e.value.indexOf(t)}}var c=t.questions,p={},h={};o.questionNum=0,o.data={},o.querySearch=function(e){return e?o.list.filter(l(e)):o.list},o.data={},o.answers=[],o.pushAnswer=function(e){e&&(o.answers.push(e),o.data.showAnswers=!0)},r.get("/api/questionnaire/"+n.user.username).then(function(e){console.log(n.user.username),"object"==typeof e.data?r.post("/api/worldFactbook",{languageOption:!0,language:e.data.question1}).then(function(n){o.recommendations=t.determineRecommendations(e.data,n.data)}):(o.getQuestion(),o.list=u())}),o.getQuestion=function(){o.data.showAnswers=!1,console.log(o.data.showAnswers),o.questionNum==c.length?(o.question="Your list is being generated!",h.username=n.user.username,h.questionResponses=p,console.log(h),r.post("/api/questionnaire",h),r.post("/api/worldFactbook",{languageOption:!0,language:p.question1}).then(function(e){o.recommendations=t.determineRecommendations(p,e.data)}),o.type=""):(o.question=c[o.questionNum].question,o.type=c[o.questionNum].type,console.log(o.question,o.type),"list"==o.type&&(o.list=c[o.questionNum].answerOptions))},o.logAnswer=function(e){o.data.showAnswers=!1,console.log(o.data.showAnswers),o.questionNum++,e.constructor===Array&&(e=e.join(" ")),p["question"+o.questionNum]=e,o.answers=[],o.searchText="",console.log(p)},o.addCountry=function(){r.post("/api/userCountries",{username:n.user.username,userCountries:["france","germany","spain"]}).then(function(e){o.userCountries=e.userCountries})},o.setCountryPage=function(t){e.name=t}}]),app.service("authService",["$window",function(e){this.parseJwt=function(t){if(t){var n=t.split(".")[1],o=n.replace("-","+").replace("_","/");return JSON.parse(e.atob(o))}return{}},this.saveToken=function(t){e.localStorage.jwtToken=t,console.log("Saved token:",e.localStorage.jwtToken)},this.getToken=function(){return e.localStorage.jwtToken},this.isAuthed=function(){var e=this.getToken();if(e){var t=this.parseJwt(e),n=Math.round((new Date).getTime()/1e3)<=t.exp;return n||this.logout(),n}return!1},this.logout=function(){delete e.localStorage.jwtToken},this.getUser=function(){return this.parseJwt(this.getToken())}}]),app.factory("authInterceptor",["$q","$location","authService",function(e,t,n){return{request:function(e){return e.headers=e.headers||{},console.log(e.url),n.isAuthed()&&(e.headers.Authorization="Bearer "+n.getToken()),e},response:function(o){return t.search().access_token&&(n.saveToken(t.search().access_token),t.search("access_token",void 0),t.path("/")),401===o.status&&t.path("/login"),o||e.when(o)},responseError:function(n){return 401===n.status?t.path("/login"):console.log(n),e.reject(n)}}}]),app.factory("questionnaire",function(){return{questions:[{question:"What language(s) do you speak?",type:"list",answerOptions:["Adyghe","Albanian","Aragonese","Armenian","Aromanian","Arpitan","Asturian","Avar","Azerbaijani","Bashkir","Basque","Belarusian","Bosnian","Breton","Bulgarian","Catalan","Chechen","Chuvash","Cornish","Corsican","Crimean","Croatian","Czech","Danish","Dutch","English","Erzya","Estonian","Faroese","Finnish","French","Frisian","Gagauz","Galician","Gallo","Georgian","German","Greek","Hungarian","Icelandic","Ingrian","Irish","Italian","Kabardian","Kashubian","Kazakh","Ladin","Latin","Latvian","Laz","Lithuanian","Luxembourgish","Macedonian","Maltese","Manx","Mari","Mingrelian","Mirandese","Montenegrin","Norwegian","Occitan","Ossetian","Picard","Polish","Portuguese","Romani","Romanian","Romansh","Russian","Sami","Sardinian","Scots","Scottish","Gaelic","Serbian","Silesian","Slovak","Slovene","Sorbian","Spanish","Svan","Swedish","Tabasaran","Tatar","Turkish","Ukrainian","Vepsian","VÃµro","Walloon","Welsh","Wymysorys"]},{question:"What field do you work in?",type:"list",answerOptions:["Agriculture","Industry","Services"]},{question:"What climate(s) would you prefer?",type:"list",answerOptions:["Temperate","Mediterranean","Tropical","Arid","Desert","Maritime","Wet"]},{question:"What is the ideal size for the largest metropolitan area?",type:"list",answerOptions:["Small (<100,000)","Medium (100,000-1 million)","Large (>1 million)"]},{question:"Would you like the population distribution to be mostly urban?",type:"boolean"},{question:"What would your ideal median age range be?",type:"list",answerOptions:["20-30yrs","30-40yrs","40+years"]},{question:"What cost of living should your destination have?",type:"list",answerOptions:["High","Average","Low"]},{question:"What percentage of the population should be internet users?",type:"list",answerOptions:["<25%","25%-50%","50%-75%",">75%"]}],determineRecommendations:function(e,t){function n(e,t,n){if(n>=e&&t>=n)return 10;var o=Math.abs(n-e)>Math.abs(n-t)?t:e,a=n>o?.5:1.5,r=20*(1-Math.min(1,Math.abs(n-a*o)/o));return r}return countries=[],t.forEach(function(t,o){var a,r,i,s=0,u=t.labor[e.question2]||0,l=u/7.5>10?10:u/10;i="array"==typeof e.question3?new RegExp(e.question3.join("|"),"i"):new RegExp(e.question3,"i");var c=null!=t.climate.match(i)?10:0,p=e.question4;switch(p){case"Small (<100,000)":r=0,a=1e5;break;case"Medium (100,000-1 million)":r=1e5,a=1e6;break;case"Large (>1 million)":r=1e6,a=1e20}var h,g=n(r,a,t.largestCityPop)||0,m=e.question5;h=m?t.urbanPopulation>50?10:10*t.urbanPopulation/50:t.urbanPopulation<50?10:500/t.urbanPopulation;var d=e.question6;switch(d){case"20-30yrs":r=0,a=30;break;case"30-40yrs":r=30,a=40;break;case"40+years":r=40,a=150}var f=n(r,a,t.medianAge),w=e.question7;switch(w){case"High":r=6e4,a=1e10;break;case"Average":r=3e4,a=6e4;break;case"Low":r=0,a=3e4}var y=n(r,a,t.perCapitaPPP),v=e.question8;switch(v){case"<25%":r=0,a=25;break;case"25%-50%":r=25,a=50;break;case"50%-75%":r=50,a=75;break;default:r=75,a=100}var q=n(r,a,t.internetUsagePerCapita);s=s+l+c+g+h+y+f+q,t.score=s,countries.push(t)}),countries.sort(function(e,t){return e.score>t.score?-1:e.score<t.score?1:e.countryName>t.countryName?1:e.countryName<t.countryName?-1:0}),countries.slice(0,4)}}}),app.factory("countryPage",function(){return{}}),app.directive("comparePasswords",function(){return{require:"ngModel",scope:{otherPassword:"=otherPassword"},link:function(e,t,n,o){ngModel.$validators.comparePasswords(function(t){return t===e.otherPassword}),console.log(e.otherPassword),e.$watch("otherPassword",function(){ngModel.$validate()})}}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJGh0dHBQcm92aWRlciIsIiRyb3V0ZVByb3ZpZGVyIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCIkbWRUaGVtaW5nUHJvdmlkZXIiLCJodG1sNU1vZGUiLCJpbnRlcmNlcHRvcnMiLCJwdXNoIiwidGhlbWUiLCJwcmltYXJ5UGFsZXR0ZSIsImFjY2VudFBhbGV0dGUiLCJ3YXJuUGFsZXR0ZSIsImJhY2tncm91bmRQYWxldHRlIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsIm90aGVyd2lzZSIsInJlZGlyZWN0VG8iLCIkc2NvcGUiLCIkbG9jYXRpb24iLCJpbnRyb1F1ZXN0aW9ucyIsInF1ZXN0aW9uIiwicm91dGUiLCJxdWVzdGlvbk51bSIsInNob3dCdXR0b25zIiwiZ2V0UXVlc3Rpb24iLCJhbnN3ZXIiLCJwYXRoIiwibGVuZ3RoIiwibWVzc2FnZSIsIiRodHRwIiwicmVnaXN0ZXIiLCJuZXdVc2VyIiwidXNlcm5hbWUiLCJmb3JtIiwidXNlck5hbWUiLCJlbWFpbCIsInBhc3N3b3JkIiwibGFzdE5hbWUiLCJmaXJzdE5hbWUiLCJwYXNzd29yZENvbmZpcm0iLCJjb25zb2xlIiwibG9nIiwicG9zdCIsInRoZW4iLCJyZXNwb25zZSIsImNvdW50cnlQYWdlIiwiY291bnRyeU5hbWUiLCJuYW1lIiwibmF0aW9uTWFzdGVyTGluayIsImF1dGhTZXJ2aWNlIiwiJHJvb3RTY29wZSIsInN1Ym1pdCIsInNhdmVUb2tlbiIsImRhdGEiLCJ1c2VyIiwiZ2V0VXNlciIsImdvb2dsZUxvZ2luIiwibG9nb3V0IiwiZ2V0IiwicXVlc3Rpb25uYWlyZSIsIiRsb2ciLCIkcSIsImxvYWRBbGwiLCJsaXN0IiwibWFwIiwiaXRlbSIsInZhbHVlIiwidG9Mb3dlckNhc2UiLCJkaXNwbGF5IiwiY3JlYXRlRmlsdGVyRm9yIiwicXVlcnkiLCJsb3dlcmNhc2VRdWVyeSIsImxvd2VyY2FzZSIsImluZGV4T2YiLCJxdWVzdGlvbnMiLCJxdWVzdGlvblJlc3BvbnNlcyIsInVzZXJRdWVzdGlvbm5haXJlIiwicXVlcnlTZWFyY2giLCJmaWx0ZXIiLCJhbnN3ZXJzIiwicHVzaEFuc3dlciIsInNob3dBbnN3ZXJzIiwidXNlckFuc3dlcnMiLCJsYW5ndWFnZU9wdGlvbiIsImxhbmd1YWdlIiwicXVlc3Rpb24xIiwiY291bnRyaWVzVG9TZWFyY2giLCJyZWNvbW1lbmRhdGlvbnMiLCJkZXRlcm1pbmVSZWNvbW1lbmRhdGlvbnMiLCJ0eXBlIiwiYW5zd2VyT3B0aW9ucyIsImxvZ0Fuc3dlciIsImNvbnN0cnVjdG9yIiwiQXJyYXkiLCJqb2luIiwic2VhcmNoVGV4dCIsImFkZENvdW50cnkiLCJ1c2VyQ291bnRyaWVzIiwic2V0Q291bnRyeVBhZ2UiLCJzZXJ2aWNlIiwiJHdpbmRvdyIsInRoaXMiLCJwYXJzZUp3dCIsInRva2VuIiwiYmFzZTY0VXJsIiwic3BsaXQiLCJiYXNlNjQiLCJyZXBsYWNlIiwiSlNPTiIsInBhcnNlIiwiYXRvYiIsImxvY2FsU3RvcmFnZSIsImp3dFRva2VuIiwiZ2V0VG9rZW4iLCJpc0F1dGhlZCIsInBhcmFtcyIsIm5vdEV4cGlyZWQiLCJNYXRoIiwicm91bmQiLCJEYXRlIiwiZ2V0VGltZSIsImV4cCIsImZhY3RvcnkiLCJyZXF1ZXN0IiwiaGVhZGVycyIsInVybCIsIkF1dGhvcml6YXRpb24iLCJzZWFyY2giLCJhY2Nlc3NfdG9rZW4iLCJ1bmRlZmluZWQiLCJzdGF0dXMiLCJyZXNwb25zZUVycm9yIiwicmVqZWN0IiwicXVlc3Rpb25uYWlyZUFuc3dlcnMiLCJnZXRQcm9wb3J0aW9uYWxTY29yZSIsImxvd2VyTGltaXQiLCJ1cHBlckxpbWl0IiwibGltaXQiLCJhYnMiLCJtdWx0aXBsaWVyIiwic2NvcmUiLCJtaW4iLCJjb3VudHJpZXMiLCJmb3JFYWNoIiwiY291bnRyeSIsImluZGV4IiwiY2xpbWF0ZVN0cmluZyIsImxhYm9yUGVyY2VudCIsImxhYm9yIiwicXVlc3Rpb24yIiwibGFib3JTY29yZSIsInF1ZXN0aW9uMyIsIlJlZ0V4cCIsImNsaW1hdGVTY29yZSIsImNsaW1hdGUiLCJtYXRjaCIsInVzZXJMYXJnZXN0Q2l0eVBvcCIsInF1ZXN0aW9uNCIsInVyYmFuUG9wdWxhdGlvblNjb3JlIiwibGFyZ2VzdENpdHlQb3BTY29yZSIsImxhcmdlc3RDaXR5UG9wIiwidXNlclVyYmFuUG9wdWxhdGlvbiIsInF1ZXN0aW9uNSIsInVyYmFuUG9wdWxhdGlvbiIsInVzZXJNZWRpYW5BZ2UiLCJxdWVzdGlvbjYiLCJtZWRpYW5BZ2VTY29yZSIsIm1lZGlhbkFnZSIsInVzZXJQZXJDYXBpdGFQUFAiLCJxdWVzdGlvbjciLCJwZXJDYXBpdGFQUFBTY29yZSIsInBlckNhcGl0YVBQUCIsInVzZXJJbnRlcm5ldFVzYWdlUGVyQ2FwaXRhIiwicXVlc3Rpb244IiwiaW50ZXJuZXRVc2FnZVNjb3JlIiwiaW50ZXJuZXRVc2FnZVBlckNhcGl0YSIsInNvcnQiLCJhIiwiYiIsInNsaWNlIiwiZGlyZWN0aXZlIiwicmVxdWlyZSIsInNjb3BlIiwib3RoZXJQYXNzd29yZCIsImxpbmsiLCJlbGVtIiwiYXR0ciIsImN0cmwiLCJuZ01vZGVsIiwiJHZhbGlkYXRvcnMiLCJjb21wYXJlUGFzc3dvcmRzIiwiJHdhdGNoIiwiJHZhbGlkYXRlIl0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxLQUFBQyxRQUFBQyxPQUFBLFdBQUEsVUFBQSxhQUFBLGFBQUEsb0JBRUFGLEtBQUFHLFFBQUEsZ0JBQUEsaUJBQUEsb0JBQUEscUJBQUEsU0FBQUMsRUFBQUMsRUFBQUMsRUFBQUMsR0FFQUQsRUFBQUUsV0FBQSxHQUVBSixFQUFBSyxhQUFBQyxLQUFBLG1CQUVBSCxFQUNBSSxNQUFBLFdBQ0FDLGVBQUEsYUFDQUMsY0FBQSxRQUNBQyxZQUFBLE9BQ0FDLGtCQUFBLGFBRUFWLEVBQUFXLEtBQUEsS0FFQUMsWUFBQSxtQkFDQUMsV0FBQSxtQkFDQUYsS0FBQSxVQUVBQyxZQUFBLG9CQUNB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QUEsRUFBQSxPQUtBdkwsSUFBQThILFFBQUEsY0FBQSxXQUNBLFdBR0E5SCxJQUFBd0wsVUFBQSxtQkFBQSxXQUNBLE9BS0FDLFFBQUEsVUFDQUMsT0FDQUMsY0FBQSxrQkFNQUMsS0FBQSxTQUFBRixFQUFBRyxFQUFBQyxFQUFBQyxHQUlBQyxRQUFBQyxZQUFBQyxpQkFBQSxTQUFBNUgsR0FDQSxNQUFBQSxLQUFBb0gsRUFBQUMsZ0JBR0EvSSxRQUFBQyxJQUFBNkksRUFBQUMsZUFFQUQsRUFBQVMsT0FBQSxnQkFBQSxXQUNBSCxRQUFBSSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdOZXh0UGF0JywgWyduZ1JvdXRlJywnbmdNYXRlcmlhbCcsJ25nTWVzc2FnZXMnLCd2YWxpZGF0aW9uLm1hdGNoJ10pO1xuXG5hcHAuY29uZmlnKFsnJGh0dHBQcm92aWRlcicsJyRyb3V0ZVByb3ZpZGVyJywnJGxvY2F0aW9uUHJvdmlkZXInLCckbWRUaGVtaW5nUHJvdmlkZXInLCBmdW5jdGlvbigkaHR0cFByb3ZpZGVyLCRyb3V0ZVByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlciwkbWRUaGVtaW5nUHJvdmlkZXIpe1xuXG4gICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xuXG4gICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaCgnYXV0aEludGVyY2VwdG9yJyk7XG5cbiAgICAkbWRUaGVtaW5nUHJvdmlkZXJcbiAgICAgICAgLnRoZW1lKCdkZWZhdWx0JylcbiAgICAgICAgLnByaW1hcnlQYWxldHRlKCdibHVlLWdyZXknKVxuICAgICAgICAuYWNjZW50UGFsZXR0ZSgnZ3JleScpXG4gICAgICAgIC53YXJuUGFsZXR0ZSgncmVkJylcbiAgICAgICAgLmJhY2tncm91bmRQYWxldHRlKCdibHVlLWdyZXknKTtcblxuICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy8nLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9ob21lLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ21haW5Db250cm9sbGVyJ1xuICAgICAgICB9KS53aGVuKCcvYWJvdXQnLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9hYm91dC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdhYm91dENvbnRyb2xsZXInXG4gICAgICAgIH0pLndoZW4oJy9jb250YWN0JyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvY29udGFjdC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjb250YWN0Q29udHJvbGxlcidcbiAgICAgICAgfSkud2hlbignL2xvZ2luJyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvbG9naW4uaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnbG9naW5Db250cm9sbGVyJ1xuICAgICAgICB9KS53aGVuKCcvc2lnblVwJyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3Mvc2lnblVwLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ3NpZ25VcENvbnRyb2xsZXInXG4gICAgICAgIH0pLndoZW4oJy9xdWVzdGlvbm5haXJlJyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvcXVlc3Rpb25uYWlyZS5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdxdWVzdGlvbm5haXJlQ29udHJvbGxlcidcbiAgICAgICAgfSkud2hlbignL2hlbHAnLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9oZWxwLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2hlbHBDb250cm9sbGVyJ1xuICAgICAgICB9KS53aGVuKCcvY291bnRyeScsXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2NvdW50cnkuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnY291bnRyeUNvbnRyb2xsZXInXG4gICAgICAgIH0pLm90aGVyd2lzZSh7XG4gICAgICAgIHJlZGlyZWN0VG86ICcvJ1xuICAgIH0pO1xufV0pO1xuXG5hcHAuY29udHJvbGxlcignbWFpbkNvbnRyb2xsZXInLCBbJyRzY29wZScsJyRsb2NhdGlvbicsIGZ1bmN0aW9uKCRzY29wZSwkbG9jYXRpb24pe1xuXG4gICAgdmFyIGludHJvUXVlc3Rpb25zID0gW3txdWVzdGlvbjogXCJIYXZlIHlvdSBiZWVuIGhlcmUgYmVmb3JlP1wiLCByb3V0ZTonbG9naW4nfSxcbiAgICAgICAge3F1ZXN0aW9uOiBcIldvdWxkIHlvdSBsaWtlIHRvIHNpZ24gdXA/XCIsIHJvdXRlOiAnc2lnblVwJ30sXG4gICAgICAgIHtxdWVzdGlvbjogXCJPa2F5LCB5b3VyIGluZm9ybWF0aW9uIHdpbGwgbm90IGJlIHNhdmVkLlwifV07XG4gICAgJHNjb3BlLnF1ZXN0aW9uID0gaW50cm9RdWVzdGlvbnNbMF0ucXVlc3Rpb247XG4gICAgdmFyIHF1ZXN0aW9uTnVtID0gMDtcbiAgICAkc2NvcGUuc2hvd0J1dHRvbnMgPSB0cnVlO1xuICAgICRzY29wZS5nZXRRdWVzdGlvbiA9IGZ1bmN0aW9uKGFuc3dlcikge1xuICAgICAgICB2YXIgcXVlc3Rpb25UZXh0ID0gaW50cm9RdWVzdGlvbnNbcXVlc3Rpb25OdW1dLnF1ZXN0aW9uO1xuICAgICAgICB2YXIgcm91dGUgPSBpbnRyb1F1ZXN0aW9uc1txdWVzdGlvbk51bV0ucm91dGU7XG4gICAgICAgIGlmIChhbnN3ZXIpIHtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKHJvdXRlKTtcbiAgICAgICAgfSBlbHNle1xuICAgICAgICAgICAgcXVlc3Rpb25OdW0rKztcbiAgICAgICAgICAgICRzY29wZS5xdWVzdGlvbiA9IGludHJvUXVlc3Rpb25zW3F1ZXN0aW9uTnVtXS5xdWVzdGlvbjtcbiAgICAgICAgICAgIGlmKHF1ZXN0aW9uTnVtID09IGludHJvUXVlc3Rpb25zLmxlbmd0aC0xKXtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0J1dHRvbnMgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG59XSk7XG5cbmFwcC5jb250cm9sbGVyKCdhYm91dENvbnRyb2xsZXInLCBbJyRzY29wZScsZnVuY3Rpb24oJHNjb3BlKXtcbiAgICAkc2NvcGUubWVzc2FnZSA9IFwiSSdtIGEgcGFnZSB0aGF0IGRlc2NyaWJlcyB0aGlzIGFwcGxpY2F0aW9uIVwiO1xufV0pO1xuXG5hcHAuY29udHJvbGxlcignY29udGFjdENvbnRyb2xsZXInLFsnJHNjb3BlJywgZnVuY3Rpb24oJHNjb3BlKXtcbiAgICAkc2NvcGUubWVzc2FnZSA9IFwiSSdtIGEgcGFnZSB0aGF0IHRlbGxzIHlvdSBob3cgdG8geWVsbCAoYnkgd3JpdGluZyBhbiBhbGwtY2FwcyBlbWFpbCkgYXQgdGhlIGRldmVsb3BlciFcIjtcbn1dKTtcblxuYXBwLmNvbnRyb2xsZXIoJ3NpZ25VcENvbnRyb2xsZXInLFsnJHNjb3BlJywnJGh0dHAnLCBmdW5jdGlvbigkc2NvcGUsJGh0dHApe1xuICAgICRzY29wZS5yZWdpc3RlciA9IGZ1bmN0aW9uKCl7XG5cblxuXG4gICAgICAgIHZhciBuZXdVc2VyID0ge1xuICAgICAgICAgICAgdXNlcm5hbWU6ICRzY29wZS5mb3JtLnVzZXJOYW1lLFxuICAgICAgICAgICAgZW1haWw6ICRzY29wZS5mb3JtLmVtYWlsLFxuICAgICAgICAgICAgcGFzc3dvcmQ6ICRzY29wZS5mb3JtLnBhc3N3b3JkLFxuICAgICAgICAgICAgbGFzdE5hbWU6ICRzY29wZS5mb3JtLmxhc3ROYW1lLFxuICAgICAgICAgICAgZmlyc3ROYW1lOiAkc2NvcGUuZm9ybS5maXJzdE5hbWUsXG4gICAgICAgICAgICBwYXNzd29yZENvbmZpcm06ICRzY29wZS5mb3JtLnBhc3N3b3JkQ29uZmlybVxuICAgICAgICB9O1xuICAgICAgICBjb25zb2xlLmxvZygnaW4gaGVyZScpO1xuICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL3JlZ2lzdGVyJyxuZXdVc2VyKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxufV0pO1xuXG5hcHAuY29udHJvbGxlcignY291bnRyeUNvbnRyb2xsZXInLCBbJ2NvdW50cnlQYWdlJywnJHNjb3BlJywnJGh0dHAnLCBmdW5jdGlvbihjb3VudHJ5UGFnZSwkc2NvcGUsJGh0dHApe1xuICAgICRzY29wZS5jb3VudHJ5TmFtZSA9IGNvdW50cnlQYWdlLm5hbWU7XG4gICAgY29uc29sZS5sb2coJHNjb3BlLm5hdGlvbk1hc3RlckxpbmspO1xufV0pO1xuXG5hcHAuY29udHJvbGxlcignbG9naW5Db250cm9sbGVyJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnYXV0aFNlcnZpY2UnLCAnJGxvY2F0aW9uJywgJyRyb290U2NvcGUnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCBhdXRoU2VydmljZSwgJGxvY2F0aW9uLCAkcm9vdFNjb3BlKXtcbiAgICAkc2NvcGUuc3VibWl0ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgJGh0dHAucG9zdCgnYXBpL2xvZ2luJywgJHNjb3BlLmZvcm0pXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBhdXRoU2VydmljZS5zYXZlVG9rZW4ocmVzcG9uc2UuZGF0YSk7XG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS51c2VyID0gYXV0aFNlcnZpY2UuZ2V0VXNlcigpO1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKFwiL3F1ZXN0aW9ubmFpcmVcIik7XG4gICAgICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmdvb2dsZUxvZ2luID0gZnVuY3Rpb24oKXtcbiAgICAgICAgLy8kaHR0cC5nZXQoJy9hcGkvbG9naW4vYXV0aC9nb29nbGUnKVxuICAgICAgICAvLyAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgLy8gICAgICAgIGF1dGhTZXJ2aWNlLnNhdmVUb2tlbihyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgLy8gICAgICAgICRyb290U2NvcGUudXNlciA9IGF1dGhTZXJ2aWNlLmdldFVzZXIoKTtcbiAgICAgICAgLy8gICAgICAgICRsb2NhdGlvbi5wYXRoKFwiL3F1ZXN0aW9ubmFpcmVcIik7XG4gICAgICAgIC8vICAgIH0pO1xuICAgIH1cbn1dKTtcblxuYXBwLmNvbnRyb2xsZXIoJ25hdkN0cmwnLCBbJ2F1dGhTZXJ2aWNlJywnJHNjb3BlJywnJHJvb3RTY29wZScsJyRsb2NhdGlvbicsJyRodHRwJywgZnVuY3Rpb24oYXV0aFNlcnZpY2UsICRzY29wZSwkcm9vdFNjb3BlLCAkbG9jYXRpb24sJGh0dHApe1xuICAgICRyb290U2NvcGUudXNlciA9IGF1dGhTZXJ2aWNlLmdldFVzZXIoKTtcblxuICAgIGlmKCRyb290U2NvcGUudXNlciAmJiAkcm9vdFNjb3BlLnVzZXIudXNlcm5hbWUpe1xuICAgICAgICAkbG9jYXRpb24ucGF0aCgnL3F1ZXN0aW9ubmFpcmUnKTtcbiAgICB9XG5cbiAgICAkc2NvcGUubG9nb3V0ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL3F1ZXN0aW9ubmFpcmUvJyskcm9vdFNjb3BlLnVzZXIudXNlcm5hbWUpO1xuICAgICAgICAkaHR0cC5nZXQoJy9hcGkvbG9nb3V0JykuXG4gICAgICAgICAgICB0aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgYXV0aFNlcnZpY2UubG9nb3V0KCk7XG4gICAgICAgICRyb290U2NvcGUudXNlciA9IGF1dGhTZXJ2aWNlLmdldFVzZXIoKTtcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvbG9naW5cIik7XG4gICAgfVxufV0pO1xuXG5hcHAuY29udHJvbGxlcignaGVscENvbnRyb2xsZXInLFsnJHNjb3BlJywgZnVuY3Rpb24oJHNjb3BlKXtcbiAgICAkc2NvcGUubWVzc2FnZSA9IFwiSSdtIGEgaGVscCBwYWdlIHRoYXQgY3VycmVudGx5IGRvZXNuJ3QgaGVscCBhdCBhbGxcIjtcbn1dKTtcblxuYXBwLmNvbnRyb2xsZXIoJ3F1ZXN0aW9ubmFpcmVDb250cm9sbGVyJyxbJ2NvdW50cnlQYWdlJywncXVlc3Rpb25uYWlyZScsJyRyb290U2NvcGUnLCckc2NvcGUnLCckbG9jYXRpb24nLCAnJGh0dHAnLCckbG9nJywnJHEnLGZ1bmN0aW9uKGNvdW50cnlQYWdlLHF1ZXN0aW9ubmFpcmUsJHJvb3RTY29wZSwkc2NvcGUsJGxvY2F0aW9uLCRodHRwLCRsb2csJHEpe1xuXG5cblxuICAgIHZhciBxdWVzdGlvbnMgPSBxdWVzdGlvbm5haXJlLnF1ZXN0aW9ucztcbiAgICB2YXIgcXVlc3Rpb25SZXNwb25zZXMgPSB7fTtcbiAgICB2YXIgdXNlclF1ZXN0aW9ubmFpcmUgPSB7fTtcbiAgICB2YXIgcmVjb21tZW5kYXRpb25zO1xuICAgICRzY29wZS5xdWVzdGlvbk51bSA9IDA7XG4gICAgJHNjb3BlLmRhdGEgPSB7fTtcblxuXG5cbiAgICAkc2NvcGUucXVlcnlTZWFyY2ggPSBmdW5jdGlvbihxdWVyeSkge1xuICAgICAgICAvL2NvbnNvbGUubG9nKHF1ZXJ5KTtcbiAgICAgICAgLy9jb25zb2xlLmxvZygkc2NvcGUubGlzdCk7XG4gICAgICAgIHJldHVybiBxdWVyeSA/ICRzY29wZS5saXN0LmZpbHRlciggY3JlYXRlRmlsdGVyRm9yKHF1ZXJ5KSApIDogJHNjb3BlLmxpc3Q7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGxvYWRBbGwoKSB7XG5cbiAgICAgICAgcmV0dXJuICRzY29wZS5saXN0Lm1hcCggZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IGl0ZW0udG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiBpdGVtXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjcmVhdGVGaWx0ZXJGb3IocXVlcnkpIHtcbiAgICAgICAgdmFyIGxvd2VyY2FzZVF1ZXJ5ID0gYW5ndWxhci5sb3dlcmNhc2UocXVlcnkpO1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gZmlsdGVyRm4oaXRlbSkge1xuICAgICAgICAgICAgcmV0dXJuIChpdGVtLnZhbHVlLmluZGV4T2YobG93ZXJjYXNlUXVlcnkpID09PSAwKTtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAkc2NvcGUuZGF0YSA9IHt9O1xuICAgIC8vJHNjb3BlLmRhdGEuc2hvd0Fuc3dlcnMgPSBmYWxzZTtcblxuICAgICRzY29wZS5hbnN3ZXJzID0gW107XG4gICAgJHNjb3BlLnB1c2hBbnN3ZXIgPSBmdW5jdGlvbihhbnN3ZXIpe1xuICAgICAgICBpZihhbnN3ZXIpe1xuICAgICAgICAgICAgJHNjb3BlLmFuc3dlcnMucHVzaChhbnN3ZXIpO1xuICAgICAgICAgICAgJHNjb3BlLmRhdGEuc2hvd0Fuc3dlcnMgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgICRodHRwLmdldCgnL2FwaS9xdWVzdGlvbm5haXJlLycrJHJvb3RTY29wZS51c2VyLnVzZXJuYW1lKS5cbiAgICAgICAgdGhlbihmdW5jdGlvbih1c2VyQW5zd2Vycyl7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygkcm9vdFNjb3BlLnVzZXIudXNlcm5hbWUpO1xuICAgICAgICAgICAgaWYodHlwZW9mIHVzZXJBbnN3ZXJzLmRhdGEgPT0gJ29iamVjdCcpe1xuICAgICAgICAgICAgICAgICRodHRwLnBvc3QoJy9hcGkvd29ybGRGYWN0Ym9vaycse2xhbmd1YWdlT3B0aW9uOnRydWUsbGFuZ3VhZ2U6dXNlckFuc3dlcnMuZGF0YS5xdWVzdGlvbjF9KS5cbiAgICAgICAgICAgICAgICAgICAgdGhlbihmdW5jdGlvbihjb3VudHJpZXNUb1NlYXJjaCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVjb21tZW5kYXRpb25zID0gcXVlc3Rpb25uYWlyZS5kZXRlcm1pbmVSZWNvbW1lbmRhdGlvbnModXNlckFuc3dlcnMuZGF0YSxjb3VudHJpZXNUb1NlYXJjaC5kYXRhKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICRzY29wZS5nZXRRdWVzdGlvbigpO1xuICAgICAgICAgICAgICAgICRzY29wZS5saXN0ID0gbG9hZEFsbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuXG5cbiAgICAvLyRzY29wZS50eXBlID0gcXVlc3Rpb25zWzBdLnR5cGU7XG4gICAgLy9jb25zb2xlLmxvZyhxdWVzdGlvbnNbMF0uYW5zd2VyT3B0aW9ucyk7XG4gICAgLy8kc2NvcGUucXVlc3Rpb24gPSBxdWVzdGlvbnNbMF0ucXVlc3Rpb247XG4gICAgLy8kc2NvcGUubGlzdCA9IHF1ZXN0aW9uc1swXS5hbnN3ZXJPcHRpb25zO1xuICAgICRzY29wZS5nZXRRdWVzdGlvbiA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICRzY29wZS5kYXRhLnNob3dBbnN3ZXJzID0gZmFsc2U7XG5cbiAgICAgICAgY29uc29sZS5sb2coJHNjb3BlLmRhdGEuc2hvd0Fuc3dlcnMpO1xuICAgICAgICBpZigkc2NvcGUucXVlc3Rpb25OdW09PXF1ZXN0aW9ucy5sZW5ndGgpe1xuICAgICAgICAgICAgLy8kc2NvcGUucXVlc3Rpb25OdW0rKztcbiAgICAgICAgICAgIC8vcXVlc3Rpb25SZXNwb25zZXNbXCJxdWVzdGlvblwiKygkc2NvcGUucXVlc3Rpb25OdW0tMSldID0gJHNjb3BlLmRhdGEuYW5zd2VyO1xuICAgICAgICAgICAgJHNjb3BlLnF1ZXN0aW9uID0gJ1lvdXIgbGlzdCBpcyBiZWluZyBnZW5lcmF0ZWQhJztcbiAgICAgICAgICAgIHVzZXJRdWVzdGlvbm5haXJlLnVzZXJuYW1lID0gJHJvb3RTY29wZS51c2VyLnVzZXJuYW1lO1xuICAgICAgICAgICAgdXNlclF1ZXN0aW9ubmFpcmUucXVlc3Rpb25SZXNwb25zZXMgPSBxdWVzdGlvblJlc3BvbnNlcztcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHVzZXJRdWVzdGlvbm5haXJlKTtcbiAgICAgICAgICAgICRodHRwLnBvc3QoJy9hcGkvcXVlc3Rpb25uYWlyZScsdXNlclF1ZXN0aW9ubmFpcmUpO1xuICAgICAgICAgICAgJGh0dHAucG9zdCgnL2FwaS93b3JsZEZhY3Rib29rJyx7bGFuZ3VhZ2VPcHRpb246dHJ1ZSxsYW5ndWFnZTpxdWVzdGlvblJlc3BvbnNlcy5xdWVzdGlvbjF9KS5cbiAgICAgICAgICAgICAgICB0aGVuKGZ1bmN0aW9uKGNvdW50cmllc1RvU2VhcmNoKXtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlY29tbWVuZGF0aW9ucyA9IHF1ZXN0aW9ubmFpcmUuZGV0ZXJtaW5lUmVjb21tZW5kYXRpb25zKHF1ZXN0aW9uUmVzcG9uc2VzLGNvdW50cmllc1RvU2VhcmNoLmRhdGEpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJHNjb3BlLnR5cGUgPSAnJztcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAkc2NvcGUucXVlc3Rpb24gPSBxdWVzdGlvbnNbJHNjb3BlLnF1ZXN0aW9uTnVtXS5xdWVzdGlvbjtcbiAgICAgICAgICAgICRzY29wZS50eXBlID0gcXVlc3Rpb25zWyRzY29wZS5xdWVzdGlvbk51bV0udHlwZTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5xdWVzdGlvbiwgJHNjb3BlLnR5cGUpO1xuICAgICAgICAgICAgaWYoJHNjb3BlLnR5cGUgPT0gJ2xpc3QnKXtcbiAgICAgICAgICAgICAgICAkc2NvcGUubGlzdCA9IHF1ZXN0aW9uc1skc2NvcGUucXVlc3Rpb25OdW1dLmFuc3dlck9wdGlvbnM7XG4gICAgICAgICAgICAgICAgLy8kc2NvcGUubGlzdCA9IGxvYWRBbGwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vJHNjb3BlLnF1ZXN0aW9uTnVtKys7XG4gICAgICAgICAgICAvLyRzY29wZS5kYXRhLnNob3dBbnN3ZXJzID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9O1xuICAgICRzY29wZS5sb2dBbnN3ZXIgPSBmdW5jdGlvbihhbnN3ZXIpe1xuICAgICAgICAkc2NvcGUuZGF0YS5zaG93QW5zd2VycyA9IGZhbHNlO1xuICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUuZGF0YS5zaG93QW5zd2Vycyk7XG5cbiAgICAgICAgJHNjb3BlLnF1ZXN0aW9uTnVtKys7XG4gICAgICAgIC8vYW5zd2VyID8gcXVlc3Rpb25SZXNwb25zZXNbXCJxdWVzdGlvblwiKygkc2NvcGUucXVlc3Rpb25OdW0pXSA9IGFuc3dlcjogcXVlc3Rpb25SZXNwb25zZXNbXCJxdWVzdGlvblwiKygkc2NvcGUucXVlc3Rpb25OdW0pXSA9ICRzY29wZS5hbnN3ZXJzO1xuICAgICAgICBpZihhbnN3ZXIuY29uc3RydWN0b3IgPT09IEFycmF5KXtcbiAgICAgICAgICAgIGFuc3dlciA9IGFuc3dlci5qb2luKCcgJylcbiAgICAgICAgfVxuICAgICAgICBxdWVzdGlvblJlc3BvbnNlc1tcInF1ZXN0aW9uXCIrKCRzY29wZS5xdWVzdGlvbk51bSldID0gYW5zd2VyO1xuXG4gICAgICAgICRzY29wZS5hbnN3ZXJzID0gW107XG4gICAgICAgICRzY29wZS5zZWFyY2hUZXh0ID0gJyc7XG5cbiAgICAgICAgLy8kc2NvcGUuJGFwcGx5KCRzY29wZS5zaG93QW5zd2VycyA9IGZhbHNlKTtcbiAgICAgICAgY29uc29sZS5sb2cocXVlc3Rpb25SZXNwb25zZXMpO1xuICAgIH07XG5cbiAgICAkc2NvcGUuYWRkQ291bnRyeSA9IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgLy9jb25zb2xlLmxvZygkcm9vdFNjb3BlLnVzZXJuYW1lKTtcbiAgICAgICAgLy8kaHR0cC5wb3N0KCcvYXBpL3VzZXJDb3VudHJpZXMnLHt1c2VybmFtZTogJHJvb3RTY29wZS51c2VyLnVzZXJuYW1lfSkuXG4gICAgICAgIC8vICAgIHRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAvLyAgICAgICAgJHNjb3BlLnVzZXJDb3VudHJpZXMgPSByZXNwb25zZS51c2VyQ291bnRyaWVzO1xuICAgICAgICAvLyAgICB9KTtcbiAgICAgICAgJGh0dHAucG9zdCgnL2FwaS91c2VyQ291bnRyaWVzJyx7dXNlcm5hbWU6ICRyb290U2NvcGUudXNlci51c2VybmFtZSx1c2VyQ291bnRyaWVzOiBbJ2ZyYW5jZScsJ2dlcm1hbnknLCdzcGFpbiddfSkuXG4gICAgICAgICAgICB0aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICAgICAgICAkc2NvcGUudXNlckNvdW50cmllcyA9IHJlc3BvbnNlLnVzZXJDb3VudHJpZXM7XG4gICAgICAgICAgICB9KVxuICAgIH07XG5cbiAgICAkc2NvcGUuc2V0Q291bnRyeVBhZ2UgPSBmdW5jdGlvbihjb3VudHJ5TmFtZSl7XG4gICAgICAgIGNvdW50cnlQYWdlLm5hbWUgPSBjb3VudHJ5TmFtZTtcbiAgICB9XG5cbn1dKTtcblxuYXBwLnNlcnZpY2UoJ2F1dGhTZXJ2aWNlJywgWyckd2luZG93JywgZnVuY3Rpb24gKCR3aW5kb3cpIHtcbiAgICB0aGlzLnBhcnNlSnd0ID0gZnVuY3Rpb24gKHRva2VuKSB7XG4gICAgICAgIGlmICh0b2tlbikge1xuICAgICAgICAgICAgdmFyIGJhc2U2NFVybCA9IHRva2VuLnNwbGl0KCcuJylbMV07XG4gICAgICAgICAgICB2YXIgYmFzZTY0ID0gYmFzZTY0VXJsLnJlcGxhY2UoJy0nLCAnKycpLnJlcGxhY2UoJ18nLCAnLycpO1xuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoJHdpbmRvdy5hdG9iKGJhc2U2NCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHRoaXMuc2F2ZVRva2VuID0gZnVuY3Rpb24gKHRva2VuKSB7XG4gICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLmp3dFRva2VuID0gdG9rZW47XG4gICAgICAgIGNvbnNvbGUubG9nKCdTYXZlZCB0b2tlbjonLCR3aW5kb3cubG9jYWxTdG9yYWdlLmp3dFRva2VuKTtcbiAgICB9O1xuXG4gICAgdGhpcy5nZXRUb2tlbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuICR3aW5kb3cubG9jYWxTdG9yYWdlLmp3dFRva2VuO1xuICAgIH07XG5cbiAgICB0aGlzLmlzQXV0aGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG9rZW4gPSB0aGlzLmdldFRva2VuKCk7XG4gICAgICAgIGlmICh0b2tlbikge1xuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHRoaXMucGFyc2VKd3QodG9rZW4pO1xuICAgICAgICAgICAgdmFyIG5vdEV4cGlyZWQgPSBNYXRoLnJvdW5kKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCkgPD0gcGFyYW1zLmV4cDtcbiAgICAgICAgICAgIGlmICghbm90RXhwaXJlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nb3V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbm90RXhwaXJlZDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZGVsZXRlICR3aW5kb3cubG9jYWxTdG9yYWdlLmp3dFRva2VuO1xuICAgIH07XG5cbiAgICAvLyBleHBvc2UgdXNlciBhcyBhbiBvYmplY3RcbiAgICB0aGlzLmdldFVzZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBhcnNlSnd0KHRoaXMuZ2V0VG9rZW4oKSlcbiAgICB9O1xufV0pO1xuXG5hcHAuZmFjdG9yeSgnYXV0aEludGVyY2VwdG9yJywgWyckcScsICckbG9jYXRpb24nLCAnYXV0aFNlcnZpY2UnLCBmdW5jdGlvbiAoJHEsICRsb2NhdGlvbiwgYXV0aFNlcnZpY2UpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICByZXF1ZXN0OiBmdW5jdGlvbiAoY29uZmlnKSB7XG4gICAgICAgICAgICBjb25maWcuaGVhZGVycyA9IGNvbmZpZy5oZWFkZXJzIHx8IHt9O1xuICAgICAgICAgICAgY29uc29sZS5sb2coY29uZmlnLnVybCk7XG4gICAgICAgICAgICBpZiAoYXV0aFNlcnZpY2UuaXNBdXRoZWQoKSkge1xuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSAnQmVhcmVyICcgKyBhdXRoU2VydmljZS5nZXRUb2tlbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcbiAgICAgICAgfSxcbiAgICAgICAgcmVzcG9uc2U6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgaWYoJGxvY2F0aW9uLnNlYXJjaCgpLmFjY2Vzc190b2tlbil7XG4gICAgICAgICAgICAgICAgYXV0aFNlcnZpY2Uuc2F2ZVRva2VuKCRsb2NhdGlvbi5zZWFyY2goKS5hY2Nlc3NfdG9rZW4pO1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5zZWFyY2goJ2FjY2Vzc190b2tlbicsIHVuZGVmaW5lZCk7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHtcblxuICAgICAgICAgICAgICAgIC8vIGhhbmRsZSB0aGUgY2FzZSB3aGVyZSB0aGUgdXNlciBpcyBub3QgYXV0aGVudGljYXRlZFxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKFwiL2xvZ2luXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlIHx8ICRxLndoZW4ocmVzcG9uc2UpO1xuICAgICAgICB9LCByZXNwb25zZUVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKFwiL2xvZ2luXCIpO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QocmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgfTtcbn1dKTtcblxuYXBwLmZhY3RvcnkoJ3F1ZXN0aW9ubmFpcmUnLCBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcXVlc3Rpb25zOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcXVlc3Rpb246IFwiV2hhdCBsYW5ndWFnZShzKSBkbyB5b3Ugc3BlYWs/XCIsIHR5cGU6ICdsaXN0JyxcbiAgICAgICAgICAgICAgICBhbnN3ZXJPcHRpb25zOiBbJ0FkeWdoZScsICdBbGJhbmlhbicsICdBcmFnb25lc2UnLCAnQXJtZW5pYW4nLCAnQXJvbWFuaWFuJywgJ0FycGl0YW4nLCAnQXN0dXJpYW4nLCAnQXZhcicsICdBemVyYmFpamFuaScsICdCYXNoa2lyJywgJ0Jhc3F1ZScsICdCZWxhcnVzaWFuJywgJ0Jvc25pYW4nLCAnQnJldG9uJywgJ0J1bGdhcmlhbicsICdDYXRhbGFuJywgJ0NoZWNoZW4nLCAnQ2h1dmFzaCcsICdDb3JuaXNoJywgJ0NvcnNpY2FuJywgJ0NyaW1lYW4nLCAnQ3JvYXRpYW4nLCAnQ3plY2gnLCAnRGFuaXNoJywgJ0R1dGNoJywgJ0VuZ2xpc2gnLCAnRXJ6eWEnLCAnRXN0b25pYW4nLCAnRmFyb2VzZScsICdGaW5uaXNoJywgJ0ZyZW5jaCcsICdGcmlzaWFuJywgJ0dhZ2F1eicsICdHYWxpY2lhbicsICdHYWxsbycsICdHZW9yZ2lhbicsICdHZXJtYW4nLCAnR3JlZWsnLCAnSHVuZ2FyaWFuJywgJ0ljZWxhbmRpYycsICdJbmdyaWFuJywgJ0lyaXNoJywgJ0l0YWxpYW4nLCAnS2FiYXJkaWFuJywgJ0thc2h1YmlhbicsICdLYXpha2gnLCAnTGFkaW4nLCAnTGF0aW4nLCAnTGF0dmlhbicsICdMYXonLCAnTGl0aHVhbmlhbicsICdMdXhlbWJvdXJnaXNoJywgJ01hY2Vkb25pYW4nLCAnTWFsdGVzZScsICdNYW54JywgJ01hcmknLCAnTWluZ3JlbGlhbicsICdNaXJhbmRlc2UnLCAnTW9udGVuZWdyaW4nLCAnTm9yd2VnaWFuJywgJ09jY2l0YW4nLCAnT3NzZXRpYW4nLCAnUGljYXJkJywgJ1BvbGlzaCcsICdQb3J0dWd1ZXNlJywgJ1JvbWFuaScsICdSb21hbmlhbicsICdSb21hbnNoJywgJ1J1c3NpYW4nLCAnU2FtaScsICdTYXJkaW5pYW4nLCAnU2NvdHMnLCAnU2NvdHRpc2gnLCdHYWVsaWMnLCAnU2VyYmlhbicsICdTaWxlc2lhbicsICdTbG92YWsnLCAnU2xvdmVuZScsICdTb3JiaWFuJywgJ1NwYW5pc2gnLCAnU3ZhbicsICdTd2VkaXNoJywgJ1RhYmFzYXJhbicsICdUYXRhcicsICdUdXJraXNoJywgJ1VrcmFpbmlhbicsICdWZXBzaWFuJywgJ1bDtXJvJywgJ1dhbGxvb24nLCAnV2Vsc2gnLCAnV3lteXNvcnlzJ11cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcXVlc3Rpb246ICdXaGF0IGZpZWxkIGRvIHlvdSB3b3JrIGluPycsXG4gICAgICAgICAgICAgICAgdHlwZTogJ2xpc3QnLFxuICAgICAgICAgICAgICAgIGFuc3dlck9wdGlvbnM6IFsnQWdyaWN1bHR1cmUnLCAnSW5kdXN0cnknLCAnU2VydmljZXMnXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBxdWVzdGlvbjogJ1doYXQgY2xpbWF0ZShzKSB3b3VsZCB5b3UgcHJlZmVyPycsXG4gICAgICAgICAgICAgICAgdHlwZTogJ2xpc3QnLFxuICAgICAgICAgICAgICAgIGFuc3dlck9wdGlvbnM6IFsnVGVtcGVyYXRlJywgJ01lZGl0ZXJyYW5lYW4nLCAnVHJvcGljYWwnLCAnQXJpZCcsICdEZXNlcnQnLCAnTWFyaXRpbWUnLCAnV2V0J11cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcXVlc3Rpb246ICdXaGF0IGlzIHRoZSBpZGVhbCBzaXplIGZvciB0aGUgbGFyZ2VzdCBtZXRyb3BvbGl0YW4gYXJlYT8nLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdsaXN0JyxcbiAgICAgICAgICAgICAgICBhbnN3ZXJPcHRpb25zOiBbJ1NtYWxsICg8MTAwLDAwMCknLCAnTWVkaXVtICgxMDAsMDAwLTEgbWlsbGlvbiknLCAnTGFyZ2UgKD4xIG1pbGxpb24pJ11cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcXVlc3Rpb246ICdXb3VsZCB5b3UgbGlrZSB0aGUgcG9wdWxhdGlvbiBkaXN0cmlidXRpb24gdG8gYmUgbW9zdGx5IHVyYmFuPycsXG4gICAgICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHF1ZXN0aW9uOiAnV2hhdCB3b3VsZCB5b3VyIGlkZWFsIG1lZGlhbiBhZ2UgcmFuZ2UgYmU/JywgdHlwZTogJ2xpc3QnLFxuICAgICAgICAgICAgICAgIGFuc3dlck9wdGlvbnM6IFsnMjAtMzB5cnMnLCAnMzAtNDB5cnMnLCAnNDAreWVhcnMnXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBxdWVzdGlvbjogJ1doYXQgY29zdCBvZiBsaXZpbmcgc2hvdWxkIHlvdXIgZGVzdGluYXRpb24gaGF2ZT8nLCB0eXBlOidsaXN0JyxcbiAgICAgICAgICAgICAgICBhbnN3ZXJPcHRpb25zOiBbJ0hpZ2gnLCdBdmVyYWdlJywnTG93J11cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcXVlc3Rpb246ICdXaGF0IHBlcmNlbnRhZ2Ugb2YgdGhlIHBvcHVsYXRpb24gc2hvdWxkIGJlIGludGVybmV0IHVzZXJzPycsIHR5cGU6J2xpc3QnLFxuICAgICAgICAgICAgICAgIGFuc3dlck9wdGlvbnM6IFsnPDI1JScsJzI1JS01MCUnLCc1MCUtNzUlJywnPjc1JSddXG4gICAgICAgICAgICB9XG4gICAgICAgIF0sXG4gICAgICAgIGRldGVybWluZVJlY29tbWVuZGF0aW9uczogZnVuY3Rpb24ocXVlc3Rpb25uYWlyZUFuc3dlcnMsY291bnRyaWVzVG9TZWFyY2gpe1xuXG4gICAgICAgICAgICBjb3VudHJpZXMgPSBbXTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0UHJvcG9ydGlvbmFsU2NvcmUobG93ZXJMaW1pdCx1cHBlckxpbWl0LHZhbHVlKXtcblxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA+PSBsb3dlckxpbWl0ICYmIHZhbHVlIDw9IHVwcGVyTGltaXQpe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTA7XG4gICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsaW1pdCA9IE1hdGguYWJzKHZhbHVlLWxvd2VyTGltaXQpID4gTWF0aC5hYnModmFsdWUtdXBwZXJMaW1pdCkgPyB1cHBlckxpbWl0IDogbG93ZXJMaW1pdDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG11bHRpcGxpZXIgPSB2YWx1ZSA+IGxpbWl0ID8gMC41IDogMS41O1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2NvcmUgPSAyMCooMSAtIE1hdGgubWluKDEsTWF0aC5hYnModmFsdWUgLSBtdWx0aXBsaWVyKmxpbWl0KS9saW1pdCkpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NvcmU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb3VudHJpZXNUb1NlYXJjaC5mb3JFYWNoKGZ1bmN0aW9uKGNvdW50cnksaW5kZXgpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2NvcmUgPSAwLCB1cHBlckxpbWl0LCBsb3dlckxpbWl0LCBjbGltYXRlU3RyaW5nO1xuICAgICAgICAgICAgICAgIHZhciBsYWJvclBlcmNlbnQgPSBjb3VudHJ5LmxhYm9yW3F1ZXN0aW9ubmFpcmVBbnN3ZXJzLnF1ZXN0aW9uMl0gfHwgMDtcbiAgICAgICAgICAgICAgICAvL2lmIHVzZXIncyBzcGVjaWZpZWQgaW5kdXN0cnkgaXMgbW9yZSB0aGFuIDc1JSBvZiB0aGUgY291bnRyeSdzIHdvcmtmb3JjZSwgc2V0IHNjb3JlIHRvIDEwXG4gICAgICAgICAgICAgICAgdmFyIGxhYm9yU2NvcmUgPSBsYWJvclBlcmNlbnQvNy41ID4gMTAgPyAxMCA6IGxhYm9yUGVyY2VudC8xMDtcbiAgICAgICAgICAgICAgICAvL2NyZWF0ZSBSZWd1bGFyIEV4cHJlc3Npb24gdG8gY2hlY2sgY2xpbWF0ZSBzdHJpbmcgZm9yIGNsaW1hdGUgYW5zd2Vyc1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcXVlc3Rpb25uYWlyZUFuc3dlcnMucXVlc3Rpb24zID09ICdhcnJheScpIHtcbiAgICAgICAgICAgICAgICAgICAgY2xpbWF0ZVN0cmluZyA9IG5ldyBSZWdFeHAocXVlc3Rpb25uYWlyZUFuc3dlcnMucXVlc3Rpb24zLmpvaW4oJ3wnKSwnaScpO1xuICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICBjbGltYXRlU3RyaW5nID0gbmV3IFJlZ0V4cChxdWVzdGlvbm5haXJlQW5zd2Vycy5xdWVzdGlvbjMsJ2knKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy9pZiBjbGltYXRlIHN0cmluZyBjb250YWlucyBvbmUgb2YgdGhlIGNsaW1hdGUgYW5zd2Vycywgc2V0IHNjb3JlIHRvIDEwXG4gICAgICAgICAgICAgICAgdmFyIGNsaW1hdGVTY29yZSA9IGNvdW50cnkuY2xpbWF0ZS5tYXRjaChjbGltYXRlU3RyaW5nKSAhPSBudWxsID8gMTA6IDA7XG5cbiAgICAgICAgICAgICAgICB2YXIgdXNlckxhcmdlc3RDaXR5UG9wID0gcXVlc3Rpb25uYWlyZUFuc3dlcnMucXVlc3Rpb240O1xuICAgICAgICAgICAgICAgIHN3aXRjaCh1c2VyTGFyZ2VzdENpdHlQb3Ape1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdTbWFsbCAoPDEwMCwwMDApJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VyTGltaXQgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBwZXJMaW1pdCA9IDFFNTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdNZWRpdW0gKDEwMCwwMDAtMSBtaWxsaW9uKSc6XG4gICAgICAgICAgICAgICAgICAgICAgICBsb3dlckxpbWl0ID0gMUU1O1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBwZXJMaW1pdCA9IDFFNjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdMYXJnZSAoPjEgbWlsbGlvbiknOlxuICAgICAgICAgICAgICAgICAgICAgICAgbG93ZXJMaW1pdCA9IDFFNjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwcGVyTGltaXQgPSAxRTIwO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIGxhcmdlc3RDaXR5UG9wU2NvcmUgPSBnZXRQcm9wb3J0aW9uYWxTY29yZShsb3dlckxpbWl0LHVwcGVyTGltaXQsY291bnRyeS5sYXJnZXN0Q2l0eVBvcCkgfHwgMDtcblxuICAgICAgICAgICAgICAgIHZhciB1c2VyVXJiYW5Qb3B1bGF0aW9uID0gcXVlc3Rpb25uYWlyZUFuc3dlcnMucXVlc3Rpb241O1xuICAgICAgICAgICAgICAgIHZhciB1cmJhblBvcHVsYXRpb25TY29yZTtcbiAgICAgICAgICAgICAgICBpZih1c2VyVXJiYW5Qb3B1bGF0aW9uKXtcbiAgICAgICAgICAgICAgICAgICAgdXJiYW5Qb3B1bGF0aW9uU2NvcmUgPSBjb3VudHJ5LnVyYmFuUG9wdWxhdGlvbiA+IDUwID8gMTAgOiAxMCpjb3VudHJ5LnVyYmFuUG9wdWxhdGlvbi81MDtcbiAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgdXJiYW5Qb3B1bGF0aW9uU2NvcmUgPSBjb3VudHJ5LnVyYmFuUG9wdWxhdGlvbiA8IDUwID8gMTAgOiAxMCo1MC9jb3VudHJ5LnVyYmFuUG9wdWxhdGlvbjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgdXNlck1lZGlhbkFnZSA9IHF1ZXN0aW9ubmFpcmVBbnN3ZXJzLnF1ZXN0aW9uNjtcbiAgICAgICAgICAgICAgICBzd2l0Y2godXNlck1lZGlhbkFnZSl7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJzIwLTMweXJzJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VyTGltaXQgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBwZXJMaW1pdCA9IDMwO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJzMwLTQweXJzJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VyTGltaXQgPSAzMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwcGVyTGltaXQgPSA0MDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICc0MCt5ZWFycyc6XG4gICAgICAgICAgICAgICAgICAgICAgICBsb3dlckxpbWl0ID0gNDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cHBlckxpbWl0ID0gMTUwO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgbWVkaWFuQWdlU2NvcmUgPSBnZXRQcm9wb3J0aW9uYWxTY29yZShsb3dlckxpbWl0LHVwcGVyTGltaXQsY291bnRyeS5tZWRpYW5BZ2UpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHVzZXJQZXJDYXBpdGFQUFAgPSBxdWVzdGlvbm5haXJlQW5zd2Vycy5xdWVzdGlvbjc7XG4gICAgICAgICAgICAgICAgc3dpdGNoKHVzZXJQZXJDYXBpdGFQUFApe1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdIaWdoJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VyTGltaXQgPSA2MDAwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwcGVyTGltaXQgPSAxRTEwO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ0F2ZXJhZ2UnOlxuICAgICAgICAgICAgICAgICAgICAgICAgbG93ZXJMaW1pdCA9IDMwMDAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBwZXJMaW1pdCA9IDYwMDAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ0xvdyc6XG4gICAgICAgICAgICAgICAgICAgICAgICBsb3dlckxpbWl0ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwcGVyTGltaXQgPSAzMDAwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBwZXJDYXBpdGFQUFBTY29yZSA9IGdldFByb3BvcnRpb25hbFNjb3JlKGxvd2VyTGltaXQsdXBwZXJMaW1pdCxjb3VudHJ5LnBlckNhcGl0YVBQUCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgdXNlckludGVybmV0VXNhZ2VQZXJDYXBpdGEgPSBxdWVzdGlvbm5haXJlQW5zd2Vycy5xdWVzdGlvbjg7XG4gICAgICAgICAgICAgICAgc3dpdGNoKHVzZXJJbnRlcm5ldFVzYWdlUGVyQ2FwaXRhKXtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnPDI1JSc6XG4gICAgICAgICAgICAgICAgICAgICAgICBsb3dlckxpbWl0ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwcGVyTGltaXQgPSAyNTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICcyNSUtNTAlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VyTGltaXQgPSAyNTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwcGVyTGltaXQgPSA1MDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICc1MCUtNzUlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VyTGltaXQgPSA1MDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwcGVyTGltaXQgPSA3NTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgbG93ZXJMaW1pdCA9IDc1O1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBwZXJMaW1pdCA9IDEwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBpbnRlcm5ldFVzYWdlU2NvcmUgPSBnZXRQcm9wb3J0aW9uYWxTY29yZShsb3dlckxpbWl0LHVwcGVyTGltaXQsY291bnRyeS5pbnRlcm5ldFVzYWdlUGVyQ2FwaXRhKTtcbiAgICAgICAgICAgICAgICBzY29yZSA9IHNjb3JlICsgbGFib3JTY29yZSArIGNsaW1hdGVTY29yZSArIGxhcmdlc3RDaXR5UG9wU2NvcmUgKyB1cmJhblBvcHVsYXRpb25TY29yZSArIHBlckNhcGl0YVBQUFNjb3JlICsgbWVkaWFuQWdlU2NvcmUgKyBpbnRlcm5ldFVzYWdlU2NvcmU7XG4gICAgICAgICAgICAgICAgY291bnRyeS5zY29yZSA9IHNjb3JlO1xuICAgICAgICAgICAgICAgIGNvdW50cmllcy5wdXNoKGNvdW50cnkpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvdW50cmllcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICAgICAgaWYgKGEuc2NvcmUgPiBiLnNjb3JlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGEuc2NvcmUgPCBiLnNjb3JlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihhLmNvdW50cnlOYW1lID4gYi5jb3VudHJ5TmFtZSl7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihhLmNvdW50cnlOYW1lIDwgYi5jb3VudHJ5TmFtZSl7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGNvdW50cmllcy5zbGljZSgwLDQpO1xuICAgICAgICB9XG4gICAgfTtcbn0pO1xuXG5hcHAuZmFjdG9yeSgnY291bnRyeVBhZ2UnLGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIHt9O1xufSk7XG5cbmFwcC5kaXJlY3RpdmUoJ2NvbXBhcmVQYXNzd29yZHMnLCBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICAvLyByZXN0cmljdCB0byBhbiBhdHRyaWJ1dGUgdHlwZS5cbiAgICAgICAgLy9yZXN0cmljdDogJ0EnLFxuXG4gICAgICAgIC8vIGVsZW1lbnQgbXVzdCBoYXZlIG5nLW1vZGVsIGF0dHJpYnV0ZS5cbiAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxuICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgb3RoZXJQYXNzd29yZDogXCI9b3RoZXJQYXNzd29yZFwiXG4gICAgICAgIH0sXG4gICAgICAgIC8vIHNjb3BlID0gdGhlIHBhcmVudCBzY29wZVxuICAgICAgICAvLyBlbGVtID0gdGhlIGVsZW1lbnQgdGhlIGRpcmVjdGl2ZSBpcyBvblxuICAgICAgICAvLyBhdHRyID0gYSBkaWN0aW9uYXJ5IG9mIGF0dHJpYnV0ZXMgb24gdGhlIGVsZW1lbnRcbiAgICAgICAgLy8gY3RybCA9IHRoZSBjb250cm9sbGVyIGZvciBuZ01vZGVsLlxuICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbSwgYXR0ciwgY3RybCkge1xuXG4gICAgICAgICAgICAvLyBhZGQgYSBwYXJzZXIgdGhhdCB3aWxsIHByb2Nlc3MgZWFjaCB0aW1lIHRoZSB2YWx1ZSBpc1xuICAgICAgICAgICAgLy8gcGFyc2VkIGludG8gdGhlIG1vZGVsIHdoZW4gdGhlIHVzZXIgdXBkYXRlcyBpdC5cbiAgICAgICAgICAgIG5nTW9kZWwuJHZhbGlkYXRvcnMuY29tcGFyZVBhc3N3b3JkcyhmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZSA9PT0gc2NvcGUub3RoZXJQYXNzd29yZDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhzY29wZS5vdGhlclBhc3N3b3JkKTtcblxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKFwib3RoZXJQYXNzd29yZFwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBuZ01vZGVsLiR2YWxpZGF0ZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuICAgIH07XG59KTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=