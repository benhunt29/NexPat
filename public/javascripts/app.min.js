var app=angular.module("NextPat",["ngRoute","ngMaterial"]);app.config(["$routeProvider","$locationProvider","$mdThemingProvider",function(e,t,n){t.html5Mode(!0),n.theme("default").primaryPalette("cyan").accentPalette("blue").warnPalette("red").backgroundPalette("blue-grey"),e.when("/",{templateUrl:"/views/home.html",controller:"mainController"}).when("/about",{templateUrl:"/views/about.html",controller:"aboutController"}).when("/contact",{templateUrl:"/views/contact.html",controller:"contactController"}).when("/login",{templateUrl:"/views/login.html",controller:"loginController"}).when("/signUp",{templateUrl:"/views/signUp.html",controller:"loginController"}).when("/questionnaire",{templateUrl:"/views/questionnaire.html",controller:"questionnaireController as ctrl"}).when("/help",{templateUrl:"/views/help.html",controller:"helpController"}).when("/country",{templateUrl:"/views/country.html",controller:"countryController"}).otherwise({redirectTo:"/"})}]),app.controller("mainController",["$scope","$location",function(e,t){var n=[{question:"Have you been here before?",route:"login"},{question:"Would you like to sign up?",route:"signUp"},{question:"Okay, your information will not be saved."}];e.question=n[0].question;var o=0;e.showButtons=!0,e.getQuestion=function(a){var r=(n[o].question,n[o].route);a?t.path(r):(o++,e.question=n[o].question,o==n.length-1&&(e.showButtons=!1))}}]),app.controller("aboutController",["$scope",function(e){e.message="I'm a page that describes this application!"}]),app.controller("contactController",["$scope",function(e){e.message="I'm a page that tells you how to yell (by writing an all-caps email) at the developer!"}]),app.controller("signUpController",["$scope","$http",function(e,t){}]),app.controller("countryController",["countryPage","$scope","$http",function(e,t,n){t.countryName=e.name,console.log(t.nationMasterLink)}]),app.controller("loginController",["$scope","$http","authService","$location","$rootScope",function(e,t,n,o,a){e.submit=function(){t.post("api/login",e.form).then(function(e){n.saveToken(e.data),a.user=n.getUser(),o.path("/questionnaire")})},e.googleLogin=function(){}}]),app.controller("navCtrl",["authService","$scope","$rootScope","$location","$http",function(e,t,n,o,a){n.user=e.getUser(),n.user&&n.user.username&&o.path("/questionnaire"),t.logout=function(){a.get("/api/questionnaire/"+n.user.username),a.get("/api/logout").then(function(e){console.log(e)}),e.logout(),n.user=e.getUser(),o.path("/login")}}]),app.controller("helpController",["$scope",function(e){e.message="I'm a help page that currently doesn't help at all"}]),app.controller("questionnaireController",["countryPage","questionnaire","$rootScope","$scope","$location","$http","$log","$q",function(e,t,n,o,a,r,i,s){function u(){return o.list.map(function(e){return{value:e.toLowerCase(),display:e}})}function l(e){var t=angular.lowercase(e);return function(e){return 0===e.value.indexOf(t)}}var c=t.questions,p={},h={};o.questionNum=0,o.data={},o.querySearch=function(e){return e?o.list.filter(l(e)):o.list},o.answers=[],o.pushAnswer=function(e){e&&o.answers.push(e)},r.get("/api/questionnaire/"+n.user.username).then(function(e){"object"==typeof e.data?r.post("/api/worldFactbook",{languageOption:!0,language:e.data.question1}).then(function(n){o.recommendations=t.determineRecommendations(e.data,n.data)}):(o.getQuestion(),o.list=u())}),o.getQuestion=function(){o.questionNum==c.length?(o.question="Your list is being generated!",h.username=n.user.username,h.questionResponses=p,console.log(h),r.post("/api/questionnaire",h),r.post("/api/worldFactbook",{languageOption:!0,language:p.question1}).then(function(e){o.recommendations=t.determineRecommendations(p,e.data)}),o.type=""):(o.question=c[o.questionNum].question,o.type=c[o.questionNum].type,console.log(o.question,o.type),"list"==o.type&&(o.list=c[o.questionNum].answerOptions))},o.logAnswer=function(e){o.questionNum++,e.constructor===Array&&(e=e.join(" ")),p["question"+o.questionNum]=e,o.answers=[],o.searchText="",console.log(p)},o.addCountry=function(){r.post("/api/userCountries",{username:n.user.username,userCountries:["france","germany","spain"]}).then(function(e){o.userCountries=e.userCountries})},o.setCountryPage=function(t){e.name=t}}]),app.service("authService",["$window",function(e){this.parseJwt=function(t){if(t){var n=t.split(".")[1],o=n.replace("-","+").replace("_","/");return JSON.parse(e.atob(o))}return{}},this.saveToken=function(t){e.localStorage.jwtToken=t,console.log("Saved token:",e.localStorage.jwtToken)},this.getToken=function(){return e.localStorage.jwtToken},this.isAuthed=function(){var e=this.getToken();if(e){var t=this.parseJwt(e),n=Math.round((new Date).getTime()/1e3)<=t.exp;return n||this.logout(),n}return!1},this.logout=function(){delete e.localStorage.jwtToken},this.getUser=function(){return this.parseJwt(this.getToken())}}]),app.factory("authInterceptor",["$q","$location","authService",function(e,t,n){return{request:function(e){return e.headers=e.headers||{},n.isAuthed()&&(e.headers.Authorization="Bearer "+n.getToken()),e},response:function(n){return 401===n.status&&t.path("/login"),n||e.when(n)},responseError:function(n){return 401===n.status?t.path("/login"):console.log(n),e.reject(n)}}}]),app.factory("questionnaire",function(){return{questions:[{question:"What language(s) do you speak?",type:"list",answerOptions:["Adyghe","Albanian","Aragonese","Armenian","Aromanian","Arpitan","Asturian","Avar","Azerbaijani","Bashkir","Basque","Belarusian","Bosnian","Breton","Bulgarian","Catalan","Chechen","Chuvash","Cornish","Corsican","Crimean","Croatian","Czech","Danish","Dutch","English","Erzya","Estonian","Faroese","Finnish","French","Frisian","Gagauz","Galician","Gallo","Georgian","German","Greek","Hungarian","Icelandic","Ingrian","Irish","Italian","Kabardian","Kashubian","Kazakh","Ladin","Latin","Latvian","Laz","Lithuanian","Luxembourgish","Macedonian","Maltese","Manx","Mari","Mingrelian","Mirandese","Montenegrin","Norwegian","Occitan","Ossetian","Picard","Polish","Portuguese","Romani","Romanian","Romansh","Russian","Sami","Sardinian","Scots","Scottish","Gaelic","Serbian","Silesian","Slovak","Slovene","Sorbian","Spanish","Svan","Swedish","Tabasaran","Tatar","Turkish","Ukrainian","Vepsian","VÃµro","Walloon","Welsh","Wymysorys"]},{question:"What field do you work in?",type:"list",answerOptions:["Agriculture","Industry","Services"]},{question:"What climate(s) would you prefer?",type:"list",answerOptions:["Temperate","Mediterranean","Tropical","Arid","Desert","Maritime","Wet"]},{question:"What is the ideal size for the largest metropolitan area?",type:"list",answerOptions:["Small (<100,000)","Medium (100,000-1 million)","Large (>1 million)"]},{question:"Would you like the population distribution to be mostly urban?",type:"boolean"},{question:"What would your ideal median age range be?",type:"list",answerOptions:["20-30yrs","30-40yrs","40+years"]},{question:"What cost of living should your destination have?",type:"list",answerOptions:["High","Average","Low"]},{question:"What percentage of the population should be internet users?",type:"list",answerOptions:["<25%","25%-50%","50%-75%",">75%"]}],determineRecommendations:function(e,t){function n(e,t,n){if(n>=e&&t>=n)return 10;var o=Math.abs(n-e)>Math.abs(n-t)?t:e,a=n>o?.5:1.5,r=20*(1-Math.min(1,Math.abs(n-a*o)/o));return r}return countries=[],t.forEach(function(t,o){var a,r,i,s=0,u=t.labor[e.question2]||0,l=u/7.5>10?10:u/10;i="array"==typeof e.question3?new RegExp(e.question3.join("|"),"i"):new RegExp(e.question3,"i");var c=null!=t.climate.match(i)?10:0,p=e.question4;switch(p){case"Small (<100,000)":r=0,a=1e5;break;case"Medium (100,000-1 million)":r=1e5,a=1e6;break;case"Large (>1 million)":r=1e6,a=1e20}var h,g=n(r,a,t.largestCityPop)||0,m=e.question5;h=m?t.urbanPopulation>50?10:10*t.urbanPopulation/50:t.urbanPopulation<50?10:500/t.urbanPopulation;var d=e.question6;switch(d){case"20-30yrs":r=0,a=30;break;case"30-40yrs":r=30,a=40;break;case"40+years":r=40,a=150}var f=n(r,a,t.medianAge),y=e.question7;switch(y){case"High":r=6e4,a=1e10;break;case"Average":r=3e4,a=6e4;break;case"Low":r=0,a=3e4}var w=n(r,a,t.perCapitaPPP),q=e.question8;switch(q){case"<25%":r=0,a=25;break;case"25%-50%":r=25,a=50;break;case"50%-75%":r=50,a=75;break;default:r=75,a=100}var v=n(r,a,t.internetUsagePerCapita);s=s+l+c+g+h+w+f+v,t.score=s,countries.push(t)}),countries.sort(function(e,t){return e.score>t.score?-1:e.score<t.score?1:e.countryName>t.countryName?1:e.countryName<t.countryName?-1:0}),countries.slice(0,4)}}}),app.factory("countryPage",function(){return{}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJHJvdXRlUHJvdmlkZXIiLCIkbG9jYXRpb25Qcm92aWRlciIsIiRtZFRoZW1pbmdQcm92aWRlciIsImh0bWw1TW9kZSIsInRoZW1lIiwicHJpbWFyeVBhbGV0dGUiLCJhY2NlbnRQYWxldHRlIiwid2FyblBhbGV0dGUiLCJiYWNrZ3JvdW5kUGFsZXR0ZSIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJvdGhlcndpc2UiLCJyZWRpcmVjdFRvIiwiJHNjb3BlIiwiJGxvY2F0aW9uIiwiaW50cm9RdWVzdGlvbnMiLCJxdWVzdGlvbiIsInJvdXRlIiwicXVlc3Rpb25OdW0iLCJzaG93QnV0dG9ucyIsImdldFF1ZXN0aW9uIiwiYW5zd2VyIiwicGF0aCIsImxlbmd0aCIsIm1lc3NhZ2UiLCIkaHR0cCIsImNvdW50cnlQYWdlIiwiY291bnRyeU5hbWUiLCJuYW1lIiwiY29uc29sZSIsImxvZyIsIm5hdGlvbk1hc3RlckxpbmsiLCJhdXRoU2VydmljZSIsIiRyb290U2NvcGUiLCJzdWJtaXQiLCJwb3N0IiwiZm9ybSIsInRoZW4iLCJyZXNwb25zZSIsInNhdmVUb2tlbiIsImRhdGEiLCJ1c2VyIiwiZ2V0VXNlciIsImdvb2dsZUxvZ2luIiwidXNlcm5hbWUiLCJsb2dvdXQiLCJnZXQiLCJxdWVzdGlvbm5haXJlIiwiJGxvZyIsIiRxIiwibG9hZEFsbCIsImxpc3QiLCJtYXAiLCJpdGVtIiwidmFsdWUiLCJ0b0xvd2VyQ2FzZSIsImRpc3BsYXkiLCJjcmVhdGVGaWx0ZXJGb3IiLCJxdWVyeSIsImxvd2VyY2FzZVF1ZXJ5IiwibG93ZXJjYXNlIiwiaW5kZXhPZiIsInF1ZXN0aW9ucyIsInF1ZXN0aW9uUmVzcG9uc2VzIiwidXNlclF1ZXN0aW9ubmFpcmUiLCJxdWVyeVNlYXJjaCIsImZpbHRlciIsImFuc3dlcnMiLCJwdXNoQW5zd2VyIiwicHVzaCIsInVzZXJBbnN3ZXJzIiwibGFuZ3VhZ2VPcHRpb24iLCJsYW5ndWFnZSIsInF1ZXN0aW9uMSIsImNvdW50cmllc1RvU2VhcmNoIiwicmVjb21tZW5kYXRpb25zIiwiZGV0ZXJtaW5lUmVjb21tZW5kYXRpb25zIiwidHlwZSIsImFuc3dlck9wdGlvbnMiLCJsb2dBbnN3ZXIiLCJjb25zdHJ1Y3RvciIsIkFycmF5Iiwiam9pbiIsInNlYXJjaFRleHQiLCJhZGRDb3VudHJ5IiwidXNlckNvdW50cmllcyIsInNldENvdW50cnlQYWdlIiwic2VydmljZSIsIiR3aW5kb3ciLCJ0aGlzIiwicGFyc2VKd3QiLCJ0b2tlbiIsImJhc2U2NFVybCIsInNwbGl0IiwiYmFzZTY0IiwicmVwbGFjZSIsIkpTT04iLCJwYXJzZSIsImF0b2IiLCJsb2NhbFN0b3JhZ2UiLCJqd3RUb2tlbiIsImdldFRva2VuIiwiaXNBdXRoZWQiLCJwYXJhbXMiLCJub3RFeHBpcmVkIiwiTWF0aCIsInJvdW5kIiwiRGF0ZSIsImdldFRpbWUiLCJleHAiLCJmYWN0b3J5IiwicmVxdWVzdCIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwic3RhdHVzIiwicmVzcG9uc2VFcnJvciIsInJlamVjdCIsInF1ZXN0aW9ubmFpcmVBbnN3ZXJzIiwiZ2V0UHJvcG9ydGlvbmFsU2NvcmUiLCJsb3dlckxpbWl0IiwidXBwZXJMaW1pdCIsImxpbWl0IiwiYWJzIiwibXVsdGlwbGllciIsInNjb3JlIiwibWluIiwiY291bnRyaWVzIiwiZm9yRWFjaCIsImNvdW50cnkiLCJpbmRleCIsImNsaW1hdGVTdHJpbmciLCJsYWJvclBlcmNlbnQiLCJsYWJvciIsInF1ZXN0aW9uMiIsImxhYm9yU2NvcmUiLCJxdWVzdGlvbjMiLCJSZWdFeHAiLCJjbGltYXRlU2NvcmUiLCJjbGltYXRlIiwibWF0Y2giLCJ1c2VyTGFyZ2VzdENpdHlQb3AiLCJxdWVzdGlvbjQiLCJ1cmJhblBvcHVsYXRpb25TY29yZSIsImxhcmdlc3RDaXR5UG9wU2NvcmUiLCJsYXJnZXN0Q2l0eVBvcCIsInVzZXJVcmJhblBvcHVsYXRpb24iLCJxdWVzdGlvbjUiLCJ1cmJhblBvcHVsYXRpb24iLCJ1c2VyTWVkaWFuQWdlIiwicXVlc3Rpb242IiwibWVkaWFuQWdlU2NvcmUiLCJtZWRpYW5BZ2UiLCJ1c2VyUGVyQ2FwaXRhUFBQIiwicXVlc3Rpb243IiwicGVyQ2FwaXRhUFBQU2NvcmUiLCJwZXJDYXBpdGFQUFAiLCJ1c2VySW50ZXJuZXRVc2FnZVBlckNhcGl0YSIsInF1ZXN0aW9uOCIsImludGVybmV0VXNhZ2VTY29yZSIsImludGVybmV0VXNhZ2VQZXJDYXBpdGEiLCJzb3J0IiwiYSIsImIiLCJzbGljZSJdLCJtYXBwaW5ncyI6IkFBQUEsR0FBQUEsS0FBQUMsUUFBQUMsT0FBQSxXQUFBLFVBQUEsY0FFQUYsS0FBQUcsUUFBQSxpQkFBQSxvQkFBQSxxQkFBQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUVBRCxFQUFBRSxXQUFBLEdBRUFELEVBQ0FFLE1BQUEsV0FDQUMsZUFBQSxRQUNBQyxjQUFBLFFBQ0FDLFlBQUEsT0FDQUMsa0JBQUEsYUFFQVIsRUFBQVMsS0FBQSxLQUVBQyxZQUFBLG1CQUNBQyxXQUFBLG1CQUNBRixLQUFBLFVBRUFDLFlBQUEsb0JBQ0FDLFdBQUEsb0JBQ0FGLEtBQUEsWUFFQUMsWUFBQSxzQkFDQUMsV0FBQSxzQkFDQUYsS0FBQSxVQUVBQyxZQUFBLG9CQUNBQyxXQUFBLG9CQUNBRixLQUFBLFdBRUFDLFlBQUEscUJBQ0FDLFdBQUEsb0JBQ0FGLEtBQUEsa0JBRUFDLFlBQUEsNEJBQ0FDLFdBQUEsb0NBQ0FGLEtBQUEsU0FFQUMsWUFBQSxtQkFDQUMsV0FBQSxtQkFDQUYsS0FBQSxZQUVBQyxZQUFBLHNCQUNBQyxXQUFBLHNCQUNBQyxXQUNBQyxXQUFBLFNBSUFqQixJQUFBZSxXQUFBLGtCQUFBLFNBQUEsWUFBQSxTQUFBRyxFQUFBQyxHQUVBLEdBQUFDLEtBQUFDLFNBQUEsNkJBQUFDLE1BQUEsVUFDQUQsU0FBQSw2QkFBQUMsTUFBQSxXQUNBRCxTQUFBLDZDQUNBSCxHQUFBRyxT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c0NvbnRlbnQiOlsidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdOZXh0UGF0JywgWyduZ1JvdXRlJywnbmdNYXRlcmlhbCddKTtcblxuYXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJywnJGxvY2F0aW9uUHJvdmlkZXInLCckbWRUaGVtaW5nUHJvdmlkZXInLCBmdW5jdGlvbigkcm91dGVQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIsJG1kVGhlbWluZ1Byb3ZpZGVyKXtcblxuICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcblxuICAgICRtZFRoZW1pbmdQcm92aWRlclxuICAgICAgICAudGhlbWUoJ2RlZmF1bHQnKVxuICAgICAgICAucHJpbWFyeVBhbGV0dGUoJ2N5YW4nKVxuICAgICAgICAuYWNjZW50UGFsZXR0ZSgnYmx1ZScpXG4gICAgICAgIC53YXJuUGFsZXR0ZSgncmVkJylcbiAgICAgICAgLmJhY2tncm91bmRQYWxldHRlKCdibHVlLWdyZXknKTtcblxuICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy8nLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9ob21lLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ21haW5Db250cm9sbGVyJ1xuICAgICAgICB9KS53aGVuKCcvYWJvdXQnLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9hYm91dC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdhYm91dENvbnRyb2xsZXInXG4gICAgICAgIH0pLndoZW4oJy9jb250YWN0JyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvY29udGFjdC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjb250YWN0Q29udHJvbGxlcidcbiAgICAgICAgfSkud2hlbignL2xvZ2luJyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvbG9naW4uaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnbG9naW5Db250cm9sbGVyJ1xuICAgICAgICB9KS53aGVuKCcvc2lnblVwJyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3Mvc2lnblVwLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2xvZ2luQ29udHJvbGxlcidcbiAgICAgICAgfSkud2hlbignL3F1ZXN0aW9ubmFpcmUnLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9xdWVzdGlvbm5haXJlLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ3F1ZXN0aW9ubmFpcmVDb250cm9sbGVyIGFzIGN0cmwnXG4gICAgICAgIH0pLndoZW4oJy9oZWxwJyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvaGVscC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdoZWxwQ29udHJvbGxlcidcbiAgICAgICAgfSkud2hlbignL2NvdW50cnknLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9jb3VudHJ5Lmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2NvdW50cnlDb250cm9sbGVyJ1xuICAgICAgICB9KS5vdGhlcndpc2Uoe1xuICAgICAgICByZWRpcmVjdFRvOiAnLydcbiAgICB9KTtcbn1dKTtcblxuYXBwLmNvbnRyb2xsZXIoJ21haW5Db250cm9sbGVyJywgWyckc2NvcGUnLCckbG9jYXRpb24nLCBmdW5jdGlvbigkc2NvcGUsJGxvY2F0aW9uKXtcblxuICAgIHZhciBpbnRyb1F1ZXN0aW9ucyA9IFt7cXVlc3Rpb246IFwiSGF2ZSB5b3UgYmVlbiBoZXJlIGJlZm9yZT9cIiwgcm91dGU6J2xvZ2luJ30sXG4gICAgICAgIHtxdWVzdGlvbjogXCJXb3VsZCB5b3UgbGlrZSB0byBzaWduIHVwP1wiLCByb3V0ZTogJ3NpZ25VcCd9LFxuICAgICAgICB7cXVlc3Rpb246IFwiT2theSwgeW91ciBpbmZvcm1hdGlvbiB3aWxsIG5vdCBiZSBzYXZlZC5cIn1dO1xuICAgICRzY29wZS5xdWVzdGlvbiA9IGludHJvUXVlc3Rpb25zWzBdLnF1ZXN0aW9uO1xuICAgIHZhciBxdWVzdGlvbk51bSA9IDA7XG4gICAgJHNjb3BlLnNob3dCdXR0b25zID0gdHJ1ZTtcbiAgICAkc2NvcGUuZ2V0UXVlc3Rpb24gPSBmdW5jdGlvbihhbnN3ZXIpIHtcbiAgICAgICAgdmFyIHF1ZXN0aW9uVGV4dCA9IGludHJvUXVlc3Rpb25zW3F1ZXN0aW9uTnVtXS5xdWVzdGlvbjtcbiAgICAgICAgdmFyIHJvdXRlID0gaW50cm9RdWVzdGlvbnNbcXVlc3Rpb25OdW1dLnJvdXRlO1xuICAgICAgICBpZiAoYW5zd2VyKSB7XG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aChyb3V0ZSk7XG4gICAgICAgIH0gZWxzZXtcbiAgICAgICAgICAgIHF1ZXN0aW9uTnVtKys7XG4gICAgICAgICAgICAkc2NvcGUucXVlc3Rpb24gPSBpbnRyb1F1ZXN0aW9uc1txdWVzdGlvbk51bV0ucXVlc3Rpb247XG4gICAgICAgICAgICBpZihxdWVzdGlvbk51bSA9PSBpbnRyb1F1ZXN0aW9ucy5sZW5ndGgtMSl7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNob3dCdXR0b25zID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xufV0pO1xuXG5hcHAuY29udHJvbGxlcignYWJvdXRDb250cm9sbGVyJywgWyckc2NvcGUnLGZ1bmN0aW9uKCRzY29wZSl7XG4gICAgJHNjb3BlLm1lc3NhZ2UgPSBcIkknbSBhIHBhZ2UgdGhhdCBkZXNjcmliZXMgdGhpcyBhcHBsaWNhdGlvbiFcIjtcbn1dKTtcblxuYXBwLmNvbnRyb2xsZXIoJ2NvbnRhY3RDb250cm9sbGVyJyxbJyRzY29wZScsIGZ1bmN0aW9uKCRzY29wZSl7XG4gICAgJHNjb3BlLm1lc3NhZ2UgPSBcIkknbSBhIHBhZ2UgdGhhdCB0ZWxscyB5b3UgaG93IHRvIHllbGwgKGJ5IHdyaXRpbmcgYW4gYWxsLWNhcHMgZW1haWwpIGF0IHRoZSBkZXZlbG9wZXIhXCI7XG59XSk7XG5cbmFwcC5jb250cm9sbGVyKCdzaWduVXBDb250cm9sbGVyJyxbJyRzY29wZScsJyRodHRwJywgZnVuY3Rpb24oJHNjb3BlLCRodHRwKXtcbn1dKTtcblxuYXBwLmNvbnRyb2xsZXIoJ2NvdW50cnlDb250cm9sbGVyJywgWydjb3VudHJ5UGFnZScsJyRzY29wZScsJyRodHRwJywgZnVuY3Rpb24oY291bnRyeVBhZ2UsJHNjb3BlLCRodHRwKXtcbiAgICAkc2NvcGUuY291bnRyeU5hbWUgPSBjb3VudHJ5UGFnZS5uYW1lO1xuICAgIGNvbnNvbGUubG9nKCRzY29wZS5uYXRpb25NYXN0ZXJMaW5rKTtcbn1dKTtcblxuYXBwLmNvbnRyb2xsZXIoJ2xvZ2luQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRodHRwJywgJ2F1dGhTZXJ2aWNlJywgJyRsb2NhdGlvbicsICckcm9vdFNjb3BlJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgYXV0aFNlcnZpY2UsICRsb2NhdGlvbiwgJHJvb3RTY29wZSl7XG4gICAgJHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICRodHRwLnBvc3QoJ2FwaS9sb2dpbicsICRzY29wZS5mb3JtKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgYXV0aFNlcnZpY2Uuc2F2ZVRva2VuKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICAgICAgICAgICRyb290U2NvcGUudXNlciA9IGF1dGhTZXJ2aWNlLmdldFVzZXIoKTtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChcIi9xdWVzdGlvbm5haXJlXCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5nb29nbGVMb2dpbiA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIC8vJGh0dHAuZ2V0KCcvYXBpL2xvZ2luL2F1dGgvZ29vZ2xlJylcbiAgICAgICAgLy8gICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIC8vICAgICAgICBhdXRoU2VydmljZS5zYXZlVG9rZW4ocmVzcG9uc2UuZGF0YSk7XG4gICAgICAgIC8vICAgICAgICAkcm9vdFNjb3BlLnVzZXIgPSBhdXRoU2VydmljZS5nZXRVc2VyKCk7XG4gICAgICAgIC8vICAgICAgICAkbG9jYXRpb24ucGF0aChcIi9xdWVzdGlvbm5haXJlXCIpO1xuICAgICAgICAvLyAgICB9KTtcbiAgICB9XG59XSk7XG5cbmFwcC5jb250cm9sbGVyKCduYXZDdHJsJywgWydhdXRoU2VydmljZScsJyRzY29wZScsJyRyb290U2NvcGUnLCckbG9jYXRpb24nLCckaHR0cCcsIGZ1bmN0aW9uKGF1dGhTZXJ2aWNlLCAkc2NvcGUsJHJvb3RTY29wZSwgJGxvY2F0aW9uLCRodHRwKXtcbiAgICAkcm9vdFNjb3BlLnVzZXIgPSBhdXRoU2VydmljZS5nZXRVc2VyKCk7XG5cbiAgICBpZigkcm9vdFNjb3BlLnVzZXIgJiYgJHJvb3RTY29wZS51c2VyLnVzZXJuYW1lKXtcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9xdWVzdGlvbm5haXJlJyk7XG4gICAgfVxuXG4gICAgJHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICRodHRwLmdldCgnL2FwaS9xdWVzdGlvbm5haXJlLycrJHJvb3RTY29wZS51c2VyLnVzZXJuYW1lKTtcbiAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL2xvZ291dCcpLlxuICAgICAgICAgICAgdGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIGF1dGhTZXJ2aWNlLmxvZ291dCgpO1xuICAgICAgICAkcm9vdFNjb3BlLnVzZXIgPSBhdXRoU2VydmljZS5nZXRVc2VyKCk7XG4gICAgICAgICRsb2NhdGlvbi5wYXRoKFwiL2xvZ2luXCIpO1xuICAgIH1cbn1dKTtcblxuYXBwLmNvbnRyb2xsZXIoJ2hlbHBDb250cm9sbGVyJyxbJyRzY29wZScsIGZ1bmN0aW9uKCRzY29wZSl7XG4gICAgJHNjb3BlLm1lc3NhZ2UgPSBcIkknbSBhIGhlbHAgcGFnZSB0aGF0IGN1cnJlbnRseSBkb2Vzbid0IGhlbHAgYXQgYWxsXCI7XG59XSk7XG5cbmFwcC5jb250cm9sbGVyKCdxdWVzdGlvbm5haXJlQ29udHJvbGxlcicsWydjb3VudHJ5UGFnZScsJ3F1ZXN0aW9ubmFpcmUnLCckcm9vdFNjb3BlJywnJHNjb3BlJywnJGxvY2F0aW9uJywgJyRodHRwJywnJGxvZycsJyRxJyxmdW5jdGlvbihjb3VudHJ5UGFnZSxxdWVzdGlvbm5haXJlLCRyb290U2NvcGUsJHNjb3BlLCRsb2NhdGlvbiwkaHR0cCwkbG9nLCRxKXtcblxuXG5cbiAgICB2YXIgcXVlc3Rpb25zID0gcXVlc3Rpb25uYWlyZS5xdWVzdGlvbnM7XG4gICAgdmFyIHF1ZXN0aW9uUmVzcG9uc2VzID0ge307XG4gICAgdmFyIHVzZXJRdWVzdGlvbm5haXJlID0ge307XG4gICAgdmFyIHJlY29tbWVuZGF0aW9ucztcbiAgICAkc2NvcGUucXVlc3Rpb25OdW0gPSAwO1xuICAgICRzY29wZS5kYXRhID0ge307XG5cblxuXG4gICAgJHNjb3BlLnF1ZXJ5U2VhcmNoID0gZnVuY3Rpb24ocXVlcnkpIHtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhxdWVyeSk7XG4gICAgICAgIC8vY29uc29sZS5sb2coJHNjb3BlLmxpc3QpO1xuICAgICAgICByZXR1cm4gcXVlcnkgPyAkc2NvcGUubGlzdC5maWx0ZXIoIGNyZWF0ZUZpbHRlckZvcihxdWVyeSkgKSA6ICRzY29wZS5saXN0O1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBsb2FkQWxsKCkge1xuXG4gICAgICAgIHJldHVybiAkc2NvcGUubGlzdC5tYXAoIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHZhbHVlOiBpdGVtLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICAgICAgZGlzcGxheTogaXRlbVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY3JlYXRlRmlsdGVyRm9yKHF1ZXJ5KSB7XG4gICAgICAgIHZhciBsb3dlcmNhc2VRdWVyeSA9IGFuZ3VsYXIubG93ZXJjYXNlKHF1ZXJ5KTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGZpbHRlckZuKGl0ZW0pIHtcbiAgICAgICAgICAgIHJldHVybiAoaXRlbS52YWx1ZS5pbmRleE9mKGxvd2VyY2FzZVF1ZXJ5KSA9PT0gMCk7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgJHNjb3BlLmFuc3dlcnMgPSBbXTtcbiAgICAkc2NvcGUucHVzaEFuc3dlciA9IGZ1bmN0aW9uKGFuc3dlcil7XG4gICAgICAgIGlmKGFuc3dlcil7XG4gICAgICAgICAgICAkc2NvcGUuYW5zd2Vycy5wdXNoKGFuc3dlcik7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJGh0dHAuZ2V0KCcvYXBpL3F1ZXN0aW9ubmFpcmUvJyskcm9vdFNjb3BlLnVzZXIudXNlcm5hbWUpLlxuICAgICAgICB0aGVuKGZ1bmN0aW9uKHVzZXJBbnN3ZXJzKXtcbiAgICAgICAgICAgIGlmKHR5cGVvZiB1c2VyQW5zd2Vycy5kYXRhID09ICdvYmplY3QnKXtcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL3dvcmxkRmFjdGJvb2snLHtsYW5ndWFnZU9wdGlvbjp0cnVlLGxhbmd1YWdlOnVzZXJBbnN3ZXJzLmRhdGEucXVlc3Rpb24xfSkuXG4gICAgICAgICAgICAgICAgICAgIHRoZW4oZnVuY3Rpb24oY291bnRyaWVzVG9TZWFyY2gpe1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlY29tbWVuZGF0aW9ucyA9IHF1ZXN0aW9ubmFpcmUuZGV0ZXJtaW5lUmVjb21tZW5kYXRpb25zKHVzZXJBbnN3ZXJzLmRhdGEsY291bnRyaWVzVG9TZWFyY2guZGF0YSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZ2V0UXVlc3Rpb24oKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUubGlzdCA9IGxvYWRBbGwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cblxuXG4gICAgLy8kc2NvcGUudHlwZSA9IHF1ZXN0aW9uc1swXS50eXBlO1xuICAgIC8vY29uc29sZS5sb2cocXVlc3Rpb25zWzBdLmFuc3dlck9wdGlvbnMpO1xuICAgIC8vJHNjb3BlLnF1ZXN0aW9uID0gcXVlc3Rpb25zWzBdLnF1ZXN0aW9uO1xuICAgIC8vJHNjb3BlLmxpc3QgPSBxdWVzdGlvbnNbMF0uYW5zd2VyT3B0aW9ucztcbiAgICAkc2NvcGUuZ2V0UXVlc3Rpb24gPSBmdW5jdGlvbigpe1xuXG4gICAgICAgIGlmKCRzY29wZS5xdWVzdGlvbk51bT09cXVlc3Rpb25zLmxlbmd0aCl7XG4gICAgICAgICAgICAvLyRzY29wZS5xdWVzdGlvbk51bSsrO1xuICAgICAgICAgICAgLy9xdWVzdGlvblJlc3BvbnNlc1tcInF1ZXN0aW9uXCIrKCRzY29wZS5xdWVzdGlvbk51bS0xKV0gPSAkc2NvcGUuZGF0YS5hbnN3ZXI7XG4gICAgICAgICAgICAkc2NvcGUucXVlc3Rpb24gPSAnWW91ciBsaXN0IGlzIGJlaW5nIGdlbmVyYXRlZCEnO1xuICAgICAgICAgICAgdXNlclF1ZXN0aW9ubmFpcmUudXNlcm5hbWUgPSAkcm9vdFNjb3BlLnVzZXIudXNlcm5hbWU7XG4gICAgICAgICAgICB1c2VyUXVlc3Rpb25uYWlyZS5xdWVzdGlvblJlc3BvbnNlcyA9IHF1ZXN0aW9uUmVzcG9uc2VzO1xuICAgICAgICAgICAgY29uc29sZS5sb2codXNlclF1ZXN0aW9ubmFpcmUpO1xuICAgICAgICAgICAgJGh0dHAucG9zdCgnL2FwaS9xdWVzdGlvbm5haXJlJyx1c2VyUXVlc3Rpb25uYWlyZSk7XG4gICAgICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL3dvcmxkRmFjdGJvb2snLHtsYW5ndWFnZU9wdGlvbjp0cnVlLGxhbmd1YWdlOnF1ZXN0aW9uUmVzcG9uc2VzLnF1ZXN0aW9uMX0pLlxuICAgICAgICAgICAgICAgIHRoZW4oZnVuY3Rpb24oY291bnRyaWVzVG9TZWFyY2gpe1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVjb21tZW5kYXRpb25zID0gcXVlc3Rpb25uYWlyZS5kZXRlcm1pbmVSZWNvbW1lbmRhdGlvbnMocXVlc3Rpb25SZXNwb25zZXMsY291bnRyaWVzVG9TZWFyY2guZGF0YSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkc2NvcGUudHlwZSA9ICcnO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICRzY29wZS5xdWVzdGlvbiA9IHF1ZXN0aW9uc1skc2NvcGUucXVlc3Rpb25OdW1dLnF1ZXN0aW9uO1xuICAgICAgICAgICAgJHNjb3BlLnR5cGUgPSBxdWVzdGlvbnNbJHNjb3BlLnF1ZXN0aW9uTnVtXS50eXBlO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJHNjb3BlLnF1ZXN0aW9uLCAkc2NvcGUudHlwZSk7XG4gICAgICAgICAgICBpZigkc2NvcGUudHlwZSA9PSAnbGlzdCcpe1xuICAgICAgICAgICAgICAgICRzY29wZS5saXN0ID0gcXVlc3Rpb25zWyRzY29wZS5xdWVzdGlvbk51bV0uYW5zd2VyT3B0aW9ucztcbiAgICAgICAgICAgICAgICAvLyRzY29wZS5saXN0ID0gbG9hZEFsbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8kc2NvcGUucXVlc3Rpb25OdW0rKztcbiAgICAgICAgfVxuICAgIH07XG4gICAgJHNjb3BlLmxvZ0Fuc3dlciA9IGZ1bmN0aW9uKGFuc3dlcil7XG4gICAgICAgICRzY29wZS5xdWVzdGlvbk51bSsrO1xuICAgICAgICAvL2Fuc3dlciA/IHF1ZXN0aW9uUmVzcG9uc2VzW1wicXVlc3Rpb25cIisoJHNjb3BlLnF1ZXN0aW9uTnVtKV0gPSBhbnN3ZXI6IHF1ZXN0aW9uUmVzcG9uc2VzW1wicXVlc3Rpb25cIisoJHNjb3BlLnF1ZXN0aW9uTnVtKV0gPSAkc2NvcGUuYW5zd2VycztcbiAgICAgICAgaWYoYW5zd2VyLmNvbnN0cnVjdG9yID09PSBBcnJheSl7XG4gICAgICAgICAgICBhbnN3ZXIgPSBhbnN3ZXIuam9pbignICcpXG4gICAgICAgIH1cbiAgICAgICAgcXVlc3Rpb25SZXNwb25zZXNbXCJxdWVzdGlvblwiKygkc2NvcGUucXVlc3Rpb25OdW0pXSA9IGFuc3dlcjtcbiAgICAgICAgJHNjb3BlLmFuc3dlcnMgPSBbXTtcbiAgICAgICAgJHNjb3BlLnNlYXJjaFRleHQgPSAnJztcbiAgICAgICAgY29uc29sZS5sb2cocXVlc3Rpb25SZXNwb25zZXMpO1xuICAgIH07XG5cbiAgICAkc2NvcGUuYWRkQ291bnRyeSA9IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgLy9jb25zb2xlLmxvZygkcm9vdFNjb3BlLnVzZXJuYW1lKTtcbiAgICAgICAgLy8kaHR0cC5wb3N0KCcvYXBpL3VzZXJDb3VudHJpZXMnLHt1c2VybmFtZTogJHJvb3RTY29wZS51c2VyLnVzZXJuYW1lfSkuXG4gICAgICAgIC8vICAgIHRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAvLyAgICAgICAgJHNjb3BlLnVzZXJDb3VudHJpZXMgPSByZXNwb25zZS51c2VyQ291bnRyaWVzO1xuICAgICAgICAvLyAgICB9KTtcbiAgICAgICAgJGh0dHAucG9zdCgnL2FwaS91c2VyQ291bnRyaWVzJyx7dXNlcm5hbWU6ICRyb290U2NvcGUudXNlci51c2VybmFtZSx1c2VyQ291bnRyaWVzOiBbJ2ZyYW5jZScsJ2dlcm1hbnknLCdzcGFpbiddfSkuXG4gICAgICAgICAgICB0aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICAgICAgICAkc2NvcGUudXNlckNvdW50cmllcyA9IHJlc3BvbnNlLnVzZXJDb3VudHJpZXM7XG4gICAgICAgICAgICB9KVxuICAgIH07XG5cbiAgICAkc2NvcGUuc2V0Q291bnRyeVBhZ2UgPSBmdW5jdGlvbihjb3VudHJ5TmFtZSl7XG4gICAgICAgIGNvdW50cnlQYWdlLm5hbWUgPSBjb3VudHJ5TmFtZTtcbiAgICB9XG5cbn1dKTtcblxuYXBwLnNlcnZpY2UoJ2F1dGhTZXJ2aWNlJywgWyckd2luZG93JywgZnVuY3Rpb24gKCR3aW5kb3cpIHtcbiAgICB0aGlzLnBhcnNlSnd0ID0gZnVuY3Rpb24gKHRva2VuKSB7XG4gICAgICAgIGlmICh0b2tlbikge1xuICAgICAgICAgICAgdmFyIGJhc2U2NFVybCA9IHRva2VuLnNwbGl0KCcuJylbMV07XG4gICAgICAgICAgICB2YXIgYmFzZTY0ID0gYmFzZTY0VXJsLnJlcGxhY2UoJy0nLCAnKycpLnJlcGxhY2UoJ18nLCAnLycpO1xuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoJHdpbmRvdy5hdG9iKGJhc2U2NCkpO1xuICAgICAgICB9IGVsc2UgcmV0dXJuIHt9O1xuICAgIH07XG5cbiAgICB0aGlzLnNhdmVUb2tlbiA9IGZ1bmN0aW9uICh0b2tlbikge1xuICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbiA9IHRva2VuO1xuICAgICAgICBjb25zb2xlLmxvZygnU2F2ZWQgdG9rZW46Jywkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbik7XG4gICAgfTtcblxuICAgIHRoaXMuZ2V0VG9rZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbjtcbiAgICB9O1xuXG4gICAgdGhpcy5pc0F1dGhlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRva2VuID0gdGhpcy5nZXRUb2tlbigpO1xuICAgICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB0aGlzLnBhcnNlSnd0KHRva2VuKTtcbiAgICAgICAgICAgIHZhciBub3RFeHBpcmVkID0gTWF0aC5yb3VuZChuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDApIDw9IHBhcmFtcy5leHA7XG4gICAgICAgICAgICBpZiAoIW5vdEV4cGlyZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ291dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5vdEV4cGlyZWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRlbGV0ZSAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbjtcbiAgICB9O1xuXG4gICAgLy8gZXhwb3NlIHVzZXIgYXMgYW4gb2JqZWN0XG4gICAgdGhpcy5nZXRVc2VyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXJzZUp3dCh0aGlzLmdldFRva2VuKCkpXG4gICAgfTtcbn1dKTtcblxuYXBwLmZhY3RvcnkoJ2F1dGhJbnRlcmNlcHRvcicsIFsnJHEnLCAnJGxvY2F0aW9uJywgJ2F1dGhTZXJ2aWNlJywgZnVuY3Rpb24gKCRxLCAkbG9jYXRpb24sIGF1dGhTZXJ2aWNlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKGNvbmZpZykge1xuICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMgPSBjb25maWcuaGVhZGVycyB8fCB7fTtcbiAgICAgICAgICAgIGlmIChhdXRoU2VydmljZS5pc0F1dGhlZCgpKSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMuQXV0aG9yaXphdGlvbiA9ICdCZWFyZXIgJyArIGF1dGhTZXJ2aWNlLmdldFRva2VuKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gY29uZmlnO1xuICAgICAgICB9LFxuICAgICAgICByZXNwb25zZTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xuXG4gICAgICAgICAgICAgICAgLy8gaGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSB1c2VyIGlzIG5vdCBhdXRoZW50aWNhdGVkXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvbG9naW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UgfHwgJHEud2hlbihyZXNwb25zZSk7XG4gICAgICAgIH0sIHJlc3BvbnNlRXJyb3I6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvbG9naW5cIik7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZXNwb25zZSk7XG4gICAgICAgIH1cbiAgICB9O1xufV0pO1xuXG5hcHAuZmFjdG9yeSgncXVlc3Rpb25uYWlyZScsIGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBxdWVzdGlvbnM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBxdWVzdGlvbjogXCJXaGF0IGxhbmd1YWdlKHMpIGRvIHlvdSBzcGVhaz9cIiwgdHlwZTogJ2xpc3QnLFxuICAgICAgICAgICAgICAgIGFuc3dlck9wdGlvbnM6IFsnQWR5Z2hlJywgJ0FsYmFuaWFuJywgJ0FyYWdvbmVzZScsICdBcm1lbmlhbicsICdBcm9tYW5pYW4nLCAnQXJwaXRhbicsICdBc3R1cmlhbicsICdBdmFyJywgJ0F6ZXJiYWlqYW5pJywgJ0Jhc2hraXInLCAnQmFzcXVlJywgJ0JlbGFydXNpYW4nLCAnQm9zbmlhbicsICdCcmV0b24nLCAnQnVsZ2FyaWFuJywgJ0NhdGFsYW4nLCAnQ2hlY2hlbicsICdDaHV2YXNoJywgJ0Nvcm5pc2gnLCAnQ29yc2ljYW4nLCAnQ3JpbWVhbicsICdDcm9hdGlhbicsICdDemVjaCcsICdEYW5pc2gnLCAnRHV0Y2gnLCAnRW5nbGlzaCcsICdFcnp5YScsICdFc3RvbmlhbicsICdGYXJvZXNlJywgJ0Zpbm5pc2gnLCAnRnJlbmNoJywgJ0ZyaXNpYW4nLCAnR2FnYXV6JywgJ0dhbGljaWFuJywgJ0dhbGxvJywgJ0dlb3JnaWFuJywgJ0dlcm1hbicsICdHcmVlaycsICdIdW5nYXJpYW4nLCAnSWNlbGFuZGljJywgJ0luZ3JpYW4nLCAnSXJpc2gnLCAnSXRhbGlhbicsICdLYWJhcmRpYW4nLCAnS2FzaHViaWFuJywgJ0themFraCcsICdMYWRpbicsICdMYXRpbicsICdMYXR2aWFuJywgJ0xheicsICdMaXRodWFuaWFuJywgJ0x1eGVtYm91cmdpc2gnLCAnTWFjZWRvbmlhbicsICdNYWx0ZXNlJywgJ01hbngnLCAnTWFyaScsICdNaW5ncmVsaWFuJywgJ01pcmFuZGVzZScsICdNb250ZW5lZ3JpbicsICdOb3J3ZWdpYW4nLCAnT2NjaXRhbicsICdPc3NldGlhbicsICdQaWNhcmQnLCAnUG9saXNoJywgJ1BvcnR1Z3Vlc2UnLCAnUm9tYW5pJywgJ1JvbWFuaWFuJywgJ1JvbWFuc2gnLCAnUnVzc2lhbicsICdTYW1pJywgJ1NhcmRpbmlhbicsICdTY290cycsICdTY290dGlzaCcsJ0dhZWxpYycsICdTZXJiaWFuJywgJ1NpbGVzaWFuJywgJ1Nsb3ZhaycsICdTbG92ZW5lJywgJ1NvcmJpYW4nLCAnU3BhbmlzaCcsICdTdmFuJywgJ1N3ZWRpc2gnLCAnVGFiYXNhcmFuJywgJ1RhdGFyJywgJ1R1cmtpc2gnLCAnVWtyYWluaWFuJywgJ1ZlcHNpYW4nLCAnVsO1cm8nLCAnV2FsbG9vbicsICdXZWxzaCcsICdXeW15c29yeXMnXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBxdWVzdGlvbjogJ1doYXQgZmllbGQgZG8geW91IHdvcmsgaW4/JyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnbGlzdCcsXG4gICAgICAgICAgICAgICAgYW5zd2VyT3B0aW9uczogWydBZ3JpY3VsdHVyZScsICdJbmR1c3RyeScsICdTZXJ2aWNlcyddXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHF1ZXN0aW9uOiAnV2hhdCBjbGltYXRlKHMpIHdvdWxkIHlvdSBwcmVmZXI/JyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnbGlzdCcsXG4gICAgICAgICAgICAgICAgYW5zd2VyT3B0aW9uczogWydUZW1wZXJhdGUnLCAnTWVkaXRlcnJhbmVhbicsICdUcm9waWNhbCcsICdBcmlkJywgJ0Rlc2VydCcsICdNYXJpdGltZScsICdXZXQnXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBxdWVzdGlvbjogJ1doYXQgaXMgdGhlIGlkZWFsIHNpemUgZm9yIHRoZSBsYXJnZXN0IG1ldHJvcG9saXRhbiBhcmVhPycsXG4gICAgICAgICAgICAgICAgdHlwZTogJ2xpc3QnLFxuICAgICAgICAgICAgICAgIGFuc3dlck9wdGlvbnM6IFsnU21hbGwgKDwxMDAsMDAwKScsICdNZWRpdW0gKDEwMCwwMDAtMSBtaWxsaW9uKScsICdMYXJnZSAoPjEgbWlsbGlvbiknXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBxdWVzdGlvbjogJ1dvdWxkIHlvdSBsaWtlIHRoZSBwb3B1bGF0aW9uIGRpc3RyaWJ1dGlvbiB0byBiZSBtb3N0bHkgdXJiYW4/JyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcXVlc3Rpb246ICdXaGF0IHdvdWxkIHlvdXIgaWRlYWwgbWVkaWFuIGFnZSByYW5nZSBiZT8nLCB0eXBlOiAnbGlzdCcsXG4gICAgICAgICAgICAgICAgYW5zd2VyT3B0aW9uczogWycyMC0zMHlycycsICczMC00MHlycycsICc0MCt5ZWFycyddXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHF1ZXN0aW9uOiAnV2hhdCBjb3N0IG9mIGxpdmluZyBzaG91bGQgeW91ciBkZXN0aW5hdGlvbiBoYXZlPycsIHR5cGU6J2xpc3QnLFxuICAgICAgICAgICAgICAgIGFuc3dlck9wdGlvbnM6IFsnSGlnaCcsJ0F2ZXJhZ2UnLCdMb3cnXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBxdWVzdGlvbjogJ1doYXQgcGVyY2VudGFnZSBvZiB0aGUgcG9wdWxhdGlvbiBzaG91bGQgYmUgaW50ZXJuZXQgdXNlcnM/JywgdHlwZTonbGlzdCcsXG4gICAgICAgICAgICAgICAgYW5zd2VyT3B0aW9uczogWyc8MjUlJywnMjUlLTUwJScsJzUwJS03NSUnLCc+NzUlJ11cbiAgICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgZGV0ZXJtaW5lUmVjb21tZW5kYXRpb25zOiBmdW5jdGlvbihxdWVzdGlvbm5haXJlQW5zd2Vycyxjb3VudHJpZXNUb1NlYXJjaCl7XG5cbiAgICAgICAgICAgIGNvdW50cmllcyA9IFtdO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRQcm9wb3J0aW9uYWxTY29yZShsb3dlckxpbWl0LHVwcGVyTGltaXQsdmFsdWUpe1xuXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlID49IGxvd2VyTGltaXQgJiYgdmFsdWUgPD0gdXBwZXJMaW1pdCl7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAxMDtcbiAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxpbWl0ID0gTWF0aC5hYnModmFsdWUtbG93ZXJMaW1pdCkgPiBNYXRoLmFicyh2YWx1ZS11cHBlckxpbWl0KSA/IHVwcGVyTGltaXQgOiBsb3dlckxpbWl0O1xuICAgICAgICAgICAgICAgICAgICB2YXIgbXVsdGlwbGllciA9IHZhbHVlID4gbGltaXQgPyAwLjUgOiAxLjU7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzY29yZSA9IDIwKigxIC0gTWF0aC5taW4oMSxNYXRoLmFicyh2YWx1ZSAtIG11bHRpcGxpZXIqbGltaXQpL2xpbWl0KSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzY29yZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvdW50cmllc1RvU2VhcmNoLmZvckVhY2goZnVuY3Rpb24oY291bnRyeSxpbmRleCkge1xuICAgICAgICAgICAgICAgIHZhciBzY29yZSA9IDAsIHVwcGVyTGltaXQsIGxvd2VyTGltaXQsIGNsaW1hdGVTdHJpbmc7XG4gICAgICAgICAgICAgICAgdmFyIGxhYm9yUGVyY2VudCA9IGNvdW50cnkubGFib3JbcXVlc3Rpb25uYWlyZUFuc3dlcnMucXVlc3Rpb24yXSB8fCAwO1xuICAgICAgICAgICAgICAgIC8vaWYgdXNlcidzIHNwZWNpZmllZCBpbmR1c3RyeSBpcyBtb3JlIHRoYW4gNzUlIG9mIHRoZSBjb3VudHJ5J3Mgd29ya2ZvcmNlLCBzZXQgc2NvcmUgdG8gMTBcbiAgICAgICAgICAgICAgICB2YXIgbGFib3JTY29yZSA9IGxhYm9yUGVyY2VudC83LjUgPiAxMCA/IDEwIDogbGFib3JQZXJjZW50LzEwO1xuICAgICAgICAgICAgICAgIC8vY3JlYXRlIFJlZ3VsYXIgRXhwcmVzc2lvbiB0byBjaGVjayBjbGltYXRlIHN0cmluZyBmb3IgY2xpbWF0ZSBhbnN3ZXJzXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBxdWVzdGlvbm5haXJlQW5zd2Vycy5xdWVzdGlvbjMgPT0gJ2FycmF5Jykge1xuICAgICAgICAgICAgICAgICAgICBjbGltYXRlU3RyaW5nID0gbmV3IFJlZ0V4cChxdWVzdGlvbm5haXJlQW5zd2Vycy5xdWVzdGlvbjMuam9pbignfCcpLCdpJyk7XG4gICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgIGNsaW1hdGVTdHJpbmcgPSBuZXcgUmVnRXhwKHF1ZXN0aW9ubmFpcmVBbnN3ZXJzLnF1ZXN0aW9uMywnaScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvL2lmIGNsaW1hdGUgc3RyaW5nIGNvbnRhaW5zIG9uZSBvZiB0aGUgY2xpbWF0ZSBhbnN3ZXJzLCBzZXQgc2NvcmUgdG8gMTBcbiAgICAgICAgICAgICAgICB2YXIgY2xpbWF0ZVNjb3JlID0gY291bnRyeS5jbGltYXRlLm1hdGNoKGNsaW1hdGVTdHJpbmcpICE9IG51bGwgPyAxMDogMDtcblxuICAgICAgICAgICAgICAgIHZhciB1c2VyTGFyZ2VzdENpdHlQb3AgPSBxdWVzdGlvbm5haXJlQW5zd2Vycy5xdWVzdGlvbjQ7XG4gICAgICAgICAgICAgICAgc3dpdGNoKHVzZXJMYXJnZXN0Q2l0eVBvcCl7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ1NtYWxsICg8MTAwLDAwMCknOlxuICAgICAgICAgICAgICAgICAgICAgICAgbG93ZXJMaW1pdCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cHBlckxpbWl0ID0gMUU1O1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ01lZGl1bSAoMTAwLDAwMC0xIG1pbGxpb24pJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VyTGltaXQgPSAxRTU7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cHBlckxpbWl0ID0gMUU2O1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ0xhcmdlICg+MSBtaWxsaW9uKSc6XG4gICAgICAgICAgICAgICAgICAgICAgICBsb3dlckxpbWl0ID0gMUU2O1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBwZXJMaW1pdCA9IDFFMjA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgbGFyZ2VzdENpdHlQb3BTY29yZSA9IGdldFByb3BvcnRpb25hbFNjb3JlKGxvd2VyTGltaXQsdXBwZXJMaW1pdCxjb3VudHJ5Lmxhcmdlc3RDaXR5UG9wKSB8fCAwO1xuXG4gICAgICAgICAgICAgICAgdmFyIHVzZXJVcmJhblBvcHVsYXRpb24gPSBxdWVzdGlvbm5haXJlQW5zd2Vycy5xdWVzdGlvbjU7XG4gICAgICAgICAgICAgICAgdmFyIHVyYmFuUG9wdWxhdGlvblNjb3JlO1xuICAgICAgICAgICAgICAgIGlmKHVzZXJVcmJhblBvcHVsYXRpb24pe1xuICAgICAgICAgICAgICAgICAgICB1cmJhblBvcHVsYXRpb25TY29yZSA9IGNvdW50cnkudXJiYW5Qb3B1bGF0aW9uID4gNTAgPyAxMCA6IDEwKmNvdW50cnkudXJiYW5Qb3B1bGF0aW9uLzUwO1xuICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICB1cmJhblBvcHVsYXRpb25TY29yZSA9IGNvdW50cnkudXJiYW5Qb3B1bGF0aW9uIDwgNTAgPyAxMCA6IDEwKjUwL2NvdW50cnkudXJiYW5Qb3B1bGF0aW9uO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciB1c2VyTWVkaWFuQWdlID0gcXVlc3Rpb25uYWlyZUFuc3dlcnMucXVlc3Rpb242O1xuICAgICAgICAgICAgICAgIHN3aXRjaCh1c2VyTWVkaWFuQWdlKXtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnMjAtMzB5cnMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgbG93ZXJMaW1pdCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cHBlckxpbWl0ID0gMzA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnMzAtNDB5cnMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgbG93ZXJMaW1pdCA9IDMwO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBwZXJMaW1pdCA9IDQwO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJzQwK3llYXJzJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VyTGltaXQgPSA0MDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwcGVyTGltaXQgPSAxNTA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBtZWRpYW5BZ2VTY29yZSA9IGdldFByb3BvcnRpb25hbFNjb3JlKGxvd2VyTGltaXQsdXBwZXJMaW1pdCxjb3VudHJ5Lm1lZGlhbkFnZSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgdXNlclBlckNhcGl0YVBQUCA9IHF1ZXN0aW9ubmFpcmVBbnN3ZXJzLnF1ZXN0aW9uNztcbiAgICAgICAgICAgICAgICBzd2l0Y2godXNlclBlckNhcGl0YVBQUCl7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ0hpZ2gnOlxuICAgICAgICAgICAgICAgICAgICAgICAgbG93ZXJMaW1pdCA9IDYwMDAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBwZXJMaW1pdCA9IDFFMTA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnQXZlcmFnZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICBsb3dlckxpbWl0ID0gMzAwMDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cHBlckxpbWl0ID0gNjAwMDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnTG93JzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VyTGltaXQgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBwZXJMaW1pdCA9IDMwMDAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHBlckNhcGl0YVBQUFNjb3JlID0gZ2V0UHJvcG9ydGlvbmFsU2NvcmUobG93ZXJMaW1pdCx1cHBlckxpbWl0LGNvdW50cnkucGVyQ2FwaXRhUFBQKTtcblxuICAgICAgICAgICAgICAgIHZhciB1c2VySW50ZXJuZXRVc2FnZVBlckNhcGl0YSA9IHF1ZXN0aW9ubmFpcmVBbnN3ZXJzLnF1ZXN0aW9uODtcbiAgICAgICAgICAgICAgICBzd2l0Y2godXNlckludGVybmV0VXNhZ2VQZXJDYXBpdGEpe1xuICAgICAgICAgICAgICAgICAgICBjYXNlICc8MjUlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VyTGltaXQgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBwZXJMaW1pdCA9IDI1O1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJzI1JS01MCUnOlxuICAgICAgICAgICAgICAgICAgICAgICAgbG93ZXJMaW1pdCA9IDI1O1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBwZXJMaW1pdCA9IDUwO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJzUwJS03NSUnOlxuICAgICAgICAgICAgICAgICAgICAgICAgbG93ZXJMaW1pdCA9IDUwO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBwZXJMaW1pdCA9IDc1O1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBsb3dlckxpbWl0ID0gNzU7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cHBlckxpbWl0ID0gMTAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIGludGVybmV0VXNhZ2VTY29yZSA9IGdldFByb3BvcnRpb25hbFNjb3JlKGxvd2VyTGltaXQsdXBwZXJMaW1pdCxjb3VudHJ5LmludGVybmV0VXNhZ2VQZXJDYXBpdGEpO1xuICAgICAgICAgICAgICAgIHNjb3JlID0gc2NvcmUgKyBsYWJvclNjb3JlICsgY2xpbWF0ZVNjb3JlICsgbGFyZ2VzdENpdHlQb3BTY29yZSArIHVyYmFuUG9wdWxhdGlvblNjb3JlICsgcGVyQ2FwaXRhUFBQU2NvcmUgKyBtZWRpYW5BZ2VTY29yZSArIGludGVybmV0VXNhZ2VTY29yZTtcbiAgICAgICAgICAgICAgICBjb3VudHJ5LnNjb3JlID0gc2NvcmU7XG4gICAgICAgICAgICAgICAgY291bnRyaWVzLnB1c2goY291bnRyeSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY291bnRyaWVzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGEuc2NvcmUgPiBiLnNjb3JlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGEuc2NvcmUgPCBiLnNjb3JlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZihhLmNvdW50cnlOYW1lID4gYi5jb3VudHJ5TmFtZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZihhLmNvdW50cnlOYW1lIDwgYi5jb3VudHJ5TmFtZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gY291bnRyaWVzLnNsaWNlKDAsNCk7XG4gICAgICAgIH1cbiAgICB9O1xufSk7XG5cbmFwcC5mYWN0b3J5KCdjb3VudHJ5UGFnZScsZnVuY3Rpb24oKXtcbiAgICByZXR1cm4ge307XG59KTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=