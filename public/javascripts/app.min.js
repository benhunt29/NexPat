var app=angular.module("NextPat",["ngRoute"]);app.config(["$routeProvider","$locationProvider",function(e,t){t.html5Mode(!0),e.when("/",{templateUrl:"/views/home.html",controller:"mainController"}).when("/about",{templateUrl:"/views/about.html",controller:"aboutController"}).when("/contact",{templateUrl:"/views/contact.html",controller:"contactController"}).when("/login",{templateUrl:"/views/login.html",controller:"loginController"}).when("/signUp",{templateUrl:"/views/signUp.html",controller:"loginController"}).when("/questionnaire",{templateUrl:"/views/questionnaire.html",controller:"questionnaireController"}).when("/help",{templateUrl:"/views/help.html",controller:"helpController"}).otherwise({redirectTo:"/"})}]),app.controller("mainController",["$scope","$location",function(e,t){var n=[{question:"Have you been here before?",route:"login"},{question:"Would you like to sign up?",route:"signUp"},{question:"Okay, your information will not be saved."}];e.question=n[0].question;var o=0;e.showButtons=!0,e.getQuestion=function(a){var r=(n[o].question,n[o].route);a?t.path(r):(o++,e.question=n[o].question,o==n.length-1&&(e.showButtons=!1))}}]),app.controller("aboutController",["$scope",function(e){e.message="I'm a page that describes this application!"}]),app.controller("contactController",["$scope",function(e){e.message="I'm a page that tells you how to yell (by writing an all-caps email) at the developer!"}]),app.controller("signUpController",["$scope","$http",function(e,t){}]),app.controller("loginController",["$scope","$http","authService","$location","$rootScope",function(e,t,n,o,a){e.submit=function(){t.post("api/login",e.form).then(function(e){n.saveToken(e.data),a.user=n.getUser(),o.path("/questionnaire")})}}]),app.controller("navCtrl",["authService","$scope","$rootScope","$location",function(e,t,n,o){n.user=e.getUser(),n.user&&n.user.username&&o.path("/questionnaire"),t.logout=function(){e.logout(),n.user=e.getUser(),o.path("/login")}}]),app.controller("helpController",["$scope",function(e){e.message="I'm a help page that currently doesn't help at all"}]),app.controller("questionnaireController",["questionnaire","$rootScope","$scope","$location","$http",function(e,t,n,o,a){var r=e.questions,i={},s={},l=0;n.data={answer:""},a.get("/api/questionnaire/"+t.user.username).then(function(t){"object"==typeof t.data?a.post("/api/worldFactbook",{languageOption:!0,language:t.data.question1}).then(function(o){n.recommendations=e.determineRecommendations(t.data,o.data)}):n.getQuestion()}),n.getQuestion=function(){l==r.length?(l++,i["question"+(l-1)]=n.data.answer,n.question="Your list is being generated!",s.username=t.user.username,s.questionResponses=i,a.post("/api/questionnaire",s),a.post("/api/worldFactbook",{languageOption:!0,language:i.question1}).then(function(t){n.recommendations=e.determineRecommendations(i,t.data)}),n.type=""):(n.question=r[l].question,n.type=r[l].type,"list"==n.type&&(n.list=r[l].answerOptions),l++)},n.logAnswer=function(){i["question"+(l-1)]=n.data.answer},n.addCountry=function(){a.post("/api/userCountries",{username:t.user.username,userCountries:["france","germany","spain"]}).then(function(e){n.userCountries=e.userCountries})}}]),app.service("authService",["$window",function(e){this.parseJwt=function(t){if(t){var n=t.split(".")[1],o=n.replace("-","+").replace("_","/");return JSON.parse(e.atob(o))}return{}},this.saveToken=function(t){e.localStorage.jwtToken=t,console.log("Saved token:",e.localStorage.jwtToken)},this.getToken=function(){return e.localStorage.jwtToken},this.isAuthed=function(){var e=this.getToken();if(e){var t=this.parseJwt(e),n=Math.round((new Date).getTime()/1e3)<=t.exp;return n||this.logout(),n}return!1},this.logout=function(){delete e.localStorage.jwtToken},this.getUser=function(){return this.parseJwt(this.getToken())}}]),app.factory("authInterceptor",["$q","$location","authService",function(e,t,n){return{request:function(e){return e.headers=e.headers||{},n.isAuthed()&&(e.headers.Authorization="Bearer "+n.getToken()),e},response:function(n){return 401===n.status&&t.path("/login"),n||e.when(n)},responseError:function(n){return 401===n.status?t.path("/login"):console.log(n),e.reject(n)}}}]),app.factory("questionnaire",function(){return{questions:[{question:"What language(s) do you speak?",type:"list",answerOptions:["Adyghe","Albanian","Aragonese","Armenian","Aromanian","Arpitan","Asturian","Avar","Azerbaijani","Bashkir","Basque","Belarusian","Bosnian","Breton","Bulgarian","Catalan","Chechen","Chuvash","Cornish","Corsican","Crimean","Croatian","Czech","Danish","Dutch","English","Erzya","Estonian","Faroese","Finnish","French","Frisian","Gagauz","Galician","Gallo","Georgian","German","Greek","Hungarian","Icelandic","Ingrian","Irish","Italian","Kabardian","Kashubian","Kazakh","Ladin","Latin","Latvian","Laz","Lithuanian","Luxembourgish","Macedonian","Maltese","Manx","Mari","Mingrelian","Mirandese","Montenegrin","Norwegian","Occitan","Ossetian","Picard","Polish","Portuguese","Romani","Romanian","Romansh","Russian","Sami","Sardinian","Scots","Scottish","Gaelic","Serbian","Silesian","Slovak","Slovene","Sorbian","Spanish","Svan","Swedish","Tabasaran","Tatar","Turkish","Ukrainian","Vepsian","VÃµro","Walloon","Welsh","Wymysorys"]},{question:"What field do you work in?",type:"list",answerOptions:["Agriculture","Industry","Services"]},{question:"What climate(s) would you prefer?",type:"list",answerOptions:["Temperate","Mediterranean","Tropical","Arid","Desert","Maritime","Wet"]},{question:"What is the ideal size for the largest metropolitan area?",type:"list",answerOptions:["Small (<100,000)","Medium (100,000-1 million)","Large (>1 million)"]},{question:"Would you like the population distribution to be mostly urban?",type:"boolean"},{question:"What would your ideal median age range be?",type:"list",answerOptions:["20-30yrs","30-40yrs","40+years"]},{question:"What cost of living should your destination have?",type:"list",answerOptions:["High","Average","Low"]},{question:"What percentage of the population should be internet users?",type:"list",answerOptions:["<25%","25%-50%","50%-75%",">75%"]}],determineRecommendations:function(e,t){function n(e,t,n){if(console.log("value",n),console.log(t,e),n>=e&&t>=n)return 10;var o=Math.abs(n-e)>Math.abs(n-t)?t:e,a=n>o?.5:1.5,r=20*(1-Math.min(1,Math.abs(n-a*o)/o));return console.log(r),r}return countries=[],t.forEach(function(t,o){var a,r,i,s=0,l=t.labor[e.question2]||0,u=l/7.5>10?10:l/10;i="array"==typeof e.question3?new RegExp(e.question3.join("|"),"i"):new RegExp(e.question3,"i");var c=null!=t.climate.match(i)?10:0,p=e.question4;switch(console.log(p),p){case"Small (<100,000)":r=0,a=1e5;break;case"Medium (100,000-1 million)":r=1e5,a=1e6;break;case"Large (>1 million)":r=1e6,a=1e20}console.log(t.countryName);var h,g=n(r,a,t.largestCityPop)||0,m=e.question5;h=m?t.urbanPopulation>50?10:10*t.urbanPopulation/50:t.urbanPopulation<50?10:500/t.urbanPopulation;var d=e.question6;switch(d){case"20-30yrs":r=0,a=30;break;case"30-40yrs":r=30,a=40;break;case"40+years":r=40,a=150}var w=n(r,a,t.medianAge),f=e.question7;switch(f){case"High":r=6e4,a=1e10;break;case"Average":r=3e4,a=6e4;break;case"Low":r=0,a=3e4}var y=n(r,a,t.perCapitaPPP),v=e.question8;switch(v){case"<25%":r=0,a=25;break;case"25%-50%":r=25,a=50;break;case"50%-75%":r=50,a=75;break;default:r=75,a=100}var b=n(r,a,t.internetUsagePerCapita);console.log("laborScore",u,"climateScore",c,"largestCityPopScore",g,"urbanPopulationScore",h,"perCapitaPPPScore",y,"medianAgeScore",w,"internetUsageScore",b),s=s+u+c+g+h+y+w+b,t.score=s,countries.push(t)}),countries.sort(function(e,t){return e.score>t.score?-1:e.score<t.score?1:e.countryName>t.countryName?1:e.countryName<t.countryName?-1:0}),countries.slice(0,4)}}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJHJvdXRlUHJvdmlkZXIiLCIkbG9jYXRpb25Qcm92aWRlciIsImh0bWw1TW9kZSIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJvdGhlcndpc2UiLCJyZWRpcmVjdFRvIiwiJHNjb3BlIiwiJGxvY2F0aW9uIiwiaW50cm9RdWVzdGlvbnMiLCJxdWVzdGlvbiIsInJvdXRlIiwicXVlc3Rpb25OdW0iLCJzaG93QnV0dG9ucyIsImdldFF1ZXN0aW9uIiwiYW5zd2VyIiwicGF0aCIsImxlbmd0aCIsIm1lc3NhZ2UiLCIkaHR0cCIsImF1dGhTZXJ2aWNlIiwiJHJvb3RTY29wZSIsInN1Ym1pdCIsInBvc3QiLCJmb3JtIiwidGhlbiIsInJlc3BvbnNlIiwic2F2ZVRva2VuIiwiZGF0YSIsInVzZXIiLCJnZXRVc2VyIiwidXNlcm5hbWUiLCJsb2dvdXQiLCJxdWVzdGlvbm5haXJlIiwicXVlc3Rpb25zIiwicXVlc3Rpb25SZXNwb25zZXMiLCJ1c2VyUXVlc3Rpb25uYWlyZSIsImdldCIsInVzZXJBbnN3ZXJzIiwibGFuZ3VhZ2VPcHRpb24iLCJsYW5ndWFnZSIsInF1ZXN0aW9uMSIsImNvdW50cmllc1RvU2VhcmNoIiwicmVjb21tZW5kYXRpb25zIiwiZGV0ZXJtaW5lUmVjb21tZW5kYXRpb25zIiwidHlwZSIsImxpc3QiLCJhbnN3ZXJPcHRpb25zIiwibG9nQW5zd2VyIiwiYWRkQ291bnRyeSIsInVzZXJDb3VudHJpZXMiLCJzZXJ2aWNlIiwiJHdpbmRvdyIsInRoaXMiLCJwYXJzZUp3dCIsInRva2VuIiwiYmFzZTY0VXJsIiwic3BsaXQiLCJiYXNlNjQiLCJyZXBsYWNlIiwiSlNPTiIsInBhcnNlIiwiYXRvYiIsImxvY2FsU3RvcmFnZSIsImp3dFRva2VuIiwiY29uc29sZSIsImxvZyIsImdldFRva2VuIiwiaXNBdXRoZWQiLCJwYXJhbXMiLCJub3RFeHBpcmVkIiwiTWF0aCIsInJvdW5kIiwiRGF0ZSIsImdldFRpbWUiLCJleHAiLCJmYWN0b3J5IiwiJHEiLCJyZXF1ZXN0IiwiaGVhZGVycyIsIkF1dGhvcml6YXRpb24iLCJzdGF0dXMiLCJyZXNwb25zZUVycm9yIiwicmVqZWN0IiwicXVlc3Rpb25uYWlyZUFuc3dlcnMiLCJnZXRQcm9wb3J0aW9uYWxTY29yZSIsImxvd2VyTGltaXQiLCJ1cHBlckxpbWl0IiwidmFsdWUiLCJsaW1pdCIsImFicyIsIm11bHRpcGxpZXIiLCJzY29yZSIsIm1pbiIsImNvdW50cmllcyIsImZvckVhY2giLCJjb3VudHJ5IiwiaW5kZXgiLCJjbGltYXRlU3RyaW5nIiwibGFib3JQZXJjZW50IiwibGFib3IiLCJxdWVzdGlvbjIiLCJsYWJvclNjb3JlIiwicXVlc3Rpb24zIiwiUmVnRXhwIiwiam9pbiIsImNsaW1hdGVTY29yZSIsImNsaW1hdGUiLCJtYXRjaCIsInVzZXJMYXJnZXN0Q2l0eVBvcCIsInF1ZXN0aW9uNCIsImNvdW50cnlOYW1lIiwidXJiYW5Qb3B1bGF0aW9uU2NvcmUiLCJsYXJnZXN0Q2l0eVBvcFNjb3JlIiwibGFyZ2VzdENpdHlQb3AiLCJ1c2VyVXJiYW5Qb3B1bGF0aW9uIiwicXVlc3Rpb241IiwidXJiYW5Qb3B1bGF0aW9uIiwidXNlck1lZGlhbkFnZSIsInF1ZXN0aW9uNiIsIm1lZGlhbkFnZVNjb3JlIiwibWVkaWFuQWdlIiwidXNlclBlckNhcGl0YVBQUCIsInF1ZXN0aW9uNyIsInBlckNhcGl0YVBQUFNjb3JlIiwicGVyQ2FwaXRhUFBQIiwidXNlckludGVybmV0VXNhZ2VQZXJDYXBpdGEiLCJxdWVzdGlvbjgiLCJpbnRlcm5ldFVzYWdlU2NvcmUiLCJpbnRlcm5ldFVzYWdlUGVyQ2FwaXRhIiwicHVzaCIsInNvcnQiLCJhIiwiYiIsInNsaWNlIl0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxLQUFBQyxRQUFBQyxPQUFBLFdBQUEsV0FFQUYsS0FBQUcsUUFBQSxpQkFBQSxvQkFBQSxTQUFBQyxF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QSxJQUtBLEdBQUFxQyxHQUFBdkMsRUFBQUMsRUFBQUMsRUFBQVMsRUFBQTZCLGNBRUFDLEVBQUExQyxFQUFBMkMsU0FDQSxRQUFBRCxHQUNBLElBQUEsT0FDQXhDLEVBQUEsRUFDQUMsRUFBQSxFQUNBLE1BQ0EsS0FBQSxVQUNBRCxFQUFBLEdBQ0FDLEVBQUEsRUFDQSxNQUNBLEtBQUEsVUFDQUQsRUFBQSxHQUNBQyxFQUFBLEVBQ0EsTUFDQSxTQUNBRCxFQUFBLEdBQ0FDLEVBQUEsSUFJQSxHQUFBeUMsR0FBQTNDLEVBQUFDLEVBQUFDLEVBQUFTLEVBQUFpQyx1QkFDQWhFLFNBQUFDLElBQUEsYUFBQW9DLEVBQUEsZUFBQUksRUFBQSxzQkFBQU8sRUFBQSx1QkFBQUQsRUFBQSxvQkFBQVksRUFBQSxpQkFBQUosRUFBQSxxQkFBQVEsR0FDQXBDLEVBQUFBLEVBQUFVLEVBQUFJLEVBQUFPLEVBQUFELEVBQUFZLEVBQUFKLEVBQUFRLEVBQ0FoQyxFQUFBSixNQUFBQSxFQUNBRSxVQUFBb0MsS0FBQWxDLEtBR0FGLFVBQUFxQyxLQUFBLFNBQUFDLEVBQUFDLEdBQ0EsTUFBQUQsR0FBQXhDLE1BQUF5QyxFQUFBekMsTUFDQSxHQUVBd0MsRUFBQXhDLE1BQUF5QyxFQUFBekMsTUFDQSxFQUVBd0MsRUFBQXJCLFlBQUFzQixFQUFBdEIsWUFDQSxFQUVBcUIsRUFBQXJCLFlBQUFzQixFQUFBdEIsWUFDQSxHQUVBLElBR0FqQixVQUFBd0MsTUFBQSxFQUFBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ05leHRQYXQnLCBbJ25nUm91dGUnXSk7XG5cbmFwcC5jb25maWcoWyckcm91dGVQcm92aWRlcicsJyRsb2NhdGlvblByb3ZpZGVyJywgZnVuY3Rpb24oJHJvdXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyKXtcblxuICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcblxuICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy8nLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9ob21lLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ21haW5Db250cm9sbGVyJ1xuICAgICAgICB9KS53aGVuKCcvYWJvdXQnLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9hYm91dC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdhYm91dENvbnRyb2xsZXInXG4gICAgICAgIH0pLndoZW4oJy9jb250YWN0JyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvY29udGFjdC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjb250YWN0Q29udHJvbGxlcidcbiAgICAgICAgfSkud2hlbignL2xvZ2luJyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvbG9naW4uaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnbG9naW5Db250cm9sbGVyJ1xuICAgICAgICB9KS53aGVuKCcvc2lnblVwJyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3Mvc2lnblVwLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2xvZ2luQ29udHJvbGxlcidcbiAgICAgICAgfSkud2hlbignL3F1ZXN0aW9ubmFpcmUnLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9xdWVzdGlvbm5haXJlLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ3F1ZXN0aW9ubmFpcmVDb250cm9sbGVyJ1xuICAgICAgICB9KS53aGVuKCcvaGVscCcsXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2hlbHAuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnaGVscENvbnRyb2xsZXInXG4gICAgICAgIH0pLm90aGVyd2lzZSh7XG4gICAgICAgIHJlZGlyZWN0VG86ICcvJ1xuICAgIH0pO1xufV0pO1xuXG5hcHAuY29udHJvbGxlcignbWFpbkNvbnRyb2xsZXInLCBbJyRzY29wZScsJyRsb2NhdGlvbicsIGZ1bmN0aW9uKCRzY29wZSwkbG9jYXRpb24pe1xuXG4gICAgdmFyIGludHJvUXVlc3Rpb25zID0gW3txdWVzdGlvbjogXCJIYXZlIHlvdSBiZWVuIGhlcmUgYmVmb3JlP1wiLCByb3V0ZTonbG9naW4nfSxcbiAgICAgICAge3F1ZXN0aW9uOiBcIldvdWxkIHlvdSBsaWtlIHRvIHNpZ24gdXA/XCIsIHJvdXRlOiAnc2lnblVwJ30sXG4gICAgICAgIHtxdWVzdGlvbjogXCJPa2F5LCB5b3VyIGluZm9ybWF0aW9uIHdpbGwgbm90IGJlIHNhdmVkLlwifV07XG4gICAgJHNjb3BlLnF1ZXN0aW9uID0gaW50cm9RdWVzdGlvbnNbMF0ucXVlc3Rpb247XG4gICAgdmFyIHF1ZXN0aW9uTnVtID0gMDtcbiAgICAkc2NvcGUuc2hvd0J1dHRvbnMgPSB0cnVlO1xuICAgICRzY29wZS5nZXRRdWVzdGlvbiA9IGZ1bmN0aW9uKGFuc3dlcikge1xuICAgICAgICB2YXIgcXVlc3Rpb25UZXh0ID0gaW50cm9RdWVzdGlvbnNbcXVlc3Rpb25OdW1dLnF1ZXN0aW9uO1xuICAgICAgICB2YXIgcm91dGUgPSBpbnRyb1F1ZXN0aW9uc1txdWVzdGlvbk51bV0ucm91dGU7XG4gICAgICAgIGlmIChhbnN3ZXIpIHtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKHJvdXRlKTtcbiAgICAgICAgfSBlbHNle1xuICAgICAgICAgICAgcXVlc3Rpb25OdW0rKztcbiAgICAgICAgICAgICRzY29wZS5xdWVzdGlvbiA9IGludHJvUXVlc3Rpb25zW3F1ZXN0aW9uTnVtXS5xdWVzdGlvbjtcbiAgICAgICAgICAgIGlmKHF1ZXN0aW9uTnVtID09IGludHJvUXVlc3Rpb25zLmxlbmd0aC0xKXtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0J1dHRvbnMgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG59XSk7XG5cbmFwcC5jb250cm9sbGVyKCdhYm91dENvbnRyb2xsZXInLCBbJyRzY29wZScsZnVuY3Rpb24oJHNjb3BlKXtcbiAgICAkc2NvcGUubWVzc2FnZSA9IFwiSSdtIGEgcGFnZSB0aGF0IGRlc2NyaWJlcyB0aGlzIGFwcGxpY2F0aW9uIVwiO1xufV0pO1xuXG5hcHAuY29udHJvbGxlcignY29udGFjdENvbnRyb2xsZXInLFsnJHNjb3BlJywgZnVuY3Rpb24oJHNjb3BlKXtcbiAgICAkc2NvcGUubWVzc2FnZSA9IFwiSSdtIGEgcGFnZSB0aGF0IHRlbGxzIHlvdSBob3cgdG8geWVsbCAoYnkgd3JpdGluZyBhbiBhbGwtY2FwcyBlbWFpbCkgYXQgdGhlIGRldmVsb3BlciFcIjtcbn1dKTtcblxuYXBwLmNvbnRyb2xsZXIoJ3NpZ25VcENvbnRyb2xsZXInLFsnJHNjb3BlJywnJGh0dHAnLCBmdW5jdGlvbigkc2NvcGUsJGh0dHApe1xuXG5cbn1dKTtcblxuYXBwLmNvbnRyb2xsZXIoJ2xvZ2luQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRodHRwJywgJ2F1dGhTZXJ2aWNlJywgJyRsb2NhdGlvbicsICckcm9vdFNjb3BlJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgYXV0aFNlcnZpY2UsICRsb2NhdGlvbiwgJHJvb3RTY29wZSl7XG4gICAgJHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICRodHRwLnBvc3QoJ2FwaS9sb2dpbicsICRzY29wZS5mb3JtKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgYXV0aFNlcnZpY2Uuc2F2ZVRva2VuKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICAgICAgICAgICRyb290U2NvcGUudXNlciA9IGF1dGhTZXJ2aWNlLmdldFVzZXIoKTtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChcIi9xdWVzdGlvbm5haXJlXCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgfTtcbn1dKTtcblxuYXBwLmNvbnRyb2xsZXIoJ25hdkN0cmwnLCBbJ2F1dGhTZXJ2aWNlJywnJHNjb3BlJywnJHJvb3RTY29wZScsJyRsb2NhdGlvbicsIGZ1bmN0aW9uKGF1dGhTZXJ2aWNlLCAkc2NvcGUsJHJvb3RTY29wZSwgJGxvY2F0aW9uKXtcbiAgICAkcm9vdFNjb3BlLnVzZXIgPSBhdXRoU2VydmljZS5nZXRVc2VyKCk7XG5cbiAgICBpZigkcm9vdFNjb3BlLnVzZXIgJiYgJHJvb3RTY29wZS51c2VyLnVzZXJuYW1lKXtcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9xdWVzdGlvbm5haXJlJyk7XG4gICAgfVxuXG4gICAgJHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIGF1dGhTZXJ2aWNlLmxvZ291dCgpO1xuICAgICAgICAkcm9vdFNjb3BlLnVzZXIgPSBhdXRoU2VydmljZS5nZXRVc2VyKCk7XG4gICAgICAgICRsb2NhdGlvbi5wYXRoKFwiL2xvZ2luXCIpO1xuICAgIH1cbn1dKTtcblxuYXBwLmNvbnRyb2xsZXIoJ2hlbHBDb250cm9sbGVyJyxbJyRzY29wZScsIGZ1bmN0aW9uKCRzY29wZSl7XG4gICAgJHNjb3BlLm1lc3NhZ2UgPSBcIkknbSBhIGhlbHAgcGFnZSB0aGF0IGN1cnJlbnRseSBkb2Vzbid0IGhlbHAgYXQgYWxsXCI7XG59XSk7XG5cbmFwcC5jb250cm9sbGVyKCdxdWVzdGlvbm5haXJlQ29udHJvbGxlcicsWydxdWVzdGlvbm5haXJlJywnJHJvb3RTY29wZScsJyRzY29wZScsJyRsb2NhdGlvbicsICckaHR0cCcsIGZ1bmN0aW9uKHF1ZXN0aW9ubmFpcmUsJHJvb3RTY29wZSwkc2NvcGUsJGxvY2F0aW9uLCRodHRwKXtcblxuXG5cbiAgICB2YXIgcXVlc3Rpb25zID0gcXVlc3Rpb25uYWlyZS5xdWVzdGlvbnM7XG4gICAgdmFyIHF1ZXN0aW9uUmVzcG9uc2VzID0ge307XG4gICAgdmFyIHVzZXJRdWVzdGlvbm5haXJlID0ge307XG4gICAgdmFyIHJlY29tbWVuZGF0aW9ucztcbiAgICB2YXIgcXVlc3Rpb25OdW0gPSAwO1xuICAgICRzY29wZS5kYXRhID0ge1xuICAgICAgICBhbnN3ZXI6ICcnXG4gICAgICAgIH07XG5cbiAgICAkaHR0cC5nZXQoJy9hcGkvcXVlc3Rpb25uYWlyZS8nKyRyb290U2NvcGUudXNlci51c2VybmFtZSkuXG4gICAgICAgIHRoZW4oZnVuY3Rpb24odXNlckFuc3dlcnMpe1xuICAgICAgICAgICAgaWYodHlwZW9mIHVzZXJBbnN3ZXJzLmRhdGEgPT0gJ29iamVjdCcpe1xuICAgICAgICAgICAgICAgICRodHRwLnBvc3QoJy9hcGkvd29ybGRGYWN0Ym9vaycse2xhbmd1YWdlT3B0aW9uOnRydWUsbGFuZ3VhZ2U6dXNlckFuc3dlcnMuZGF0YS5xdWVzdGlvbjF9KS5cbiAgICAgICAgICAgICAgICAgICAgdGhlbihmdW5jdGlvbihjb3VudHJpZXNUb1NlYXJjaCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVjb21tZW5kYXRpb25zID0gcXVlc3Rpb25uYWlyZS5kZXRlcm1pbmVSZWNvbW1lbmRhdGlvbnModXNlckFuc3dlcnMuZGF0YSxjb3VudHJpZXNUb1NlYXJjaC5kYXRhKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICRzY29wZS5nZXRRdWVzdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgIC8vJHNjb3BlLnR5cGUgPSBxdWVzdGlvbnNbMF0udHlwZTtcbiAgICAvL2NvbnNvbGUubG9nKHF1ZXN0aW9uc1swXS5hbnN3ZXJPcHRpb25zKTtcbiAgICAvLyRzY29wZS5xdWVzdGlvbiA9IHF1ZXN0aW9uc1swXS5xdWVzdGlvbjtcbiAgICAvLyRzY29wZS5saXN0ID0gcXVlc3Rpb25zWzBdLmFuc3dlck9wdGlvbnM7XG4gICAgJHNjb3BlLmdldFF1ZXN0aW9uID0gZnVuY3Rpb24oKXtcblxuICAgICAgICBpZihxdWVzdGlvbk51bT09cXVlc3Rpb25zLmxlbmd0aCl7XG4gICAgICAgICAgICBxdWVzdGlvbk51bSsrO1xuICAgICAgICAgICAgcXVlc3Rpb25SZXNwb25zZXNbXCJxdWVzdGlvblwiKyhxdWVzdGlvbk51bS0xKV0gPSAkc2NvcGUuZGF0YS5hbnN3ZXI7XG4gICAgICAgICAgICAkc2NvcGUucXVlc3Rpb24gPSAnWW91ciBsaXN0IGlzIGJlaW5nIGdlbmVyYXRlZCEnO1xuICAgICAgICAgICAgdXNlclF1ZXN0aW9ubmFpcmUudXNlcm5hbWUgPSAkcm9vdFNjb3BlLnVzZXIudXNlcm5hbWU7XG4gICAgICAgICAgICB1c2VyUXVlc3Rpb25uYWlyZS5xdWVzdGlvblJlc3BvbnNlcyA9IHF1ZXN0aW9uUmVzcG9uc2VzO1xuICAgICAgICAgICAgJGh0dHAucG9zdCgnL2FwaS9xdWVzdGlvbm5haXJlJyx1c2VyUXVlc3Rpb25uYWlyZSk7XG4gICAgICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL3dvcmxkRmFjdGJvb2snLHtsYW5ndWFnZU9wdGlvbjp0cnVlLGxhbmd1YWdlOnF1ZXN0aW9uUmVzcG9uc2VzLnF1ZXN0aW9uMX0pLlxuICAgICAgICAgICAgICAgIHRoZW4oZnVuY3Rpb24oY291bnRyaWVzVG9TZWFyY2gpe1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVjb21tZW5kYXRpb25zID0gcXVlc3Rpb25uYWlyZS5kZXRlcm1pbmVSZWNvbW1lbmRhdGlvbnMocXVlc3Rpb25SZXNwb25zZXMsY291bnRyaWVzVG9TZWFyY2guZGF0YSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkc2NvcGUudHlwZSA9ICcnO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICRzY29wZS5xdWVzdGlvbiA9IHF1ZXN0aW9uc1txdWVzdGlvbk51bV0ucXVlc3Rpb247XG4gICAgICAgICAgICAkc2NvcGUudHlwZSA9IHF1ZXN0aW9uc1txdWVzdGlvbk51bV0udHlwZTtcblxuICAgICAgICAgICAgaWYoJHNjb3BlLnR5cGUgPT0gJ2xpc3QnKXtcbiAgICAgICAgICAgICAgICAkc2NvcGUubGlzdCA9IHF1ZXN0aW9uc1txdWVzdGlvbk51bV0uYW5zd2VyT3B0aW9ucztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHF1ZXN0aW9uTnVtKys7XG4gICAgICAgIH1cbiAgICB9O1xuICAgICRzY29wZS5sb2dBbnN3ZXIgPSBmdW5jdGlvbigpe1xuICAgICAgICBxdWVzdGlvblJlc3BvbnNlc1tcInF1ZXN0aW9uXCIrKHF1ZXN0aW9uTnVtLTEpXSA9ICRzY29wZS5kYXRhLmFuc3dlcjtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmFkZENvdW50cnkgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgIC8vY29uc29sZS5sb2coJHJvb3RTY29wZS51c2VybmFtZSk7XG4gICAgICAgIC8vJGh0dHAucG9zdCgnL2FwaS91c2VyQ291bnRyaWVzJyx7dXNlcm5hbWU6ICRyb290U2NvcGUudXNlci51c2VybmFtZX0pLlxuICAgICAgICAvLyAgICB0aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgLy8gICAgICAgICRzY29wZS51c2VyQ291bnRyaWVzID0gcmVzcG9uc2UudXNlckNvdW50cmllcztcbiAgICAgICAgLy8gICAgfSk7XG4gICAgICAgICRodHRwLnBvc3QoJy9hcGkvdXNlckNvdW50cmllcycse3VzZXJuYW1lOiAkcm9vdFNjb3BlLnVzZXIudXNlcm5hbWUsdXNlckNvdW50cmllczogWydmcmFuY2UnLCdnZXJtYW55Jywnc3BhaW4nXX0pLlxuICAgICAgICAgICAgdGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnVzZXJDb3VudHJpZXMgPSByZXNwb25zZS51c2VyQ291bnRyaWVzO1xuICAgICAgICAgICAgfSlcbiAgICB9XG5cbn1dKTtcblxuYXBwLnNlcnZpY2UoJ2F1dGhTZXJ2aWNlJywgWyckd2luZG93JywgZnVuY3Rpb24gKCR3aW5kb3cpIHtcbiAgICB0aGlzLnBhcnNlSnd0ID0gZnVuY3Rpb24gKHRva2VuKSB7XG4gICAgICAgIGlmICh0b2tlbikge1xuICAgICAgICAgICAgdmFyIGJhc2U2NFVybCA9IHRva2VuLnNwbGl0KCcuJylbMV07XG4gICAgICAgICAgICB2YXIgYmFzZTY0ID0gYmFzZTY0VXJsLnJlcGxhY2UoJy0nLCAnKycpLnJlcGxhY2UoJ18nLCAnLycpO1xuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoJHdpbmRvdy5hdG9iKGJhc2U2NCkpO1xuICAgICAgICB9IGVsc2UgcmV0dXJuIHt9O1xuICAgIH07XG5cbiAgICB0aGlzLnNhdmVUb2tlbiA9IGZ1bmN0aW9uICh0b2tlbikge1xuICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbiA9IHRva2VuO1xuICAgICAgICBjb25zb2xlLmxvZygnU2F2ZWQgdG9rZW46Jywkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbik7XG4gICAgfTtcblxuICAgIHRoaXMuZ2V0VG9rZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbjtcbiAgICB9O1xuXG4gICAgdGhpcy5pc0F1dGhlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRva2VuID0gdGhpcy5nZXRUb2tlbigpO1xuICAgICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB0aGlzLnBhcnNlSnd0KHRva2VuKTtcbiAgICAgICAgICAgIHZhciBub3RFeHBpcmVkID0gTWF0aC5yb3VuZChuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDApIDw9IHBhcmFtcy5leHA7XG4gICAgICAgICAgICBpZiAoIW5vdEV4cGlyZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ291dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5vdEV4cGlyZWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRlbGV0ZSAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbjtcbiAgICB9O1xuXG4gICAgLy8gZXhwb3NlIHVzZXIgYXMgYW4gb2JqZWN0XG4gICAgdGhpcy5nZXRVc2VyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXJzZUp3dCh0aGlzLmdldFRva2VuKCkpXG4gICAgfTtcbn1dKTtcblxuYXBwLmZhY3RvcnkoJ2F1dGhJbnRlcmNlcHRvcicsIFsnJHEnLCAnJGxvY2F0aW9uJywgJ2F1dGhTZXJ2aWNlJywgZnVuY3Rpb24gKCRxLCAkbG9jYXRpb24sIGF1dGhTZXJ2aWNlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKGNvbmZpZykge1xuICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMgPSBjb25maWcuaGVhZGVycyB8fCB7fTtcbiAgICAgICAgICAgIGlmIChhdXRoU2VydmljZS5pc0F1dGhlZCgpKSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMuQXV0aG9yaXphdGlvbiA9ICdCZWFyZXIgJyArIGF1dGhTZXJ2aWNlLmdldFRva2VuKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gY29uZmlnO1xuICAgICAgICB9LFxuICAgICAgICByZXNwb25zZTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xuXG4gICAgICAgICAgICAgICAgLy8gaGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSB1c2VyIGlzIG5vdCBhdXRoZW50aWNhdGVkXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvbG9naW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UgfHwgJHEud2hlbihyZXNwb25zZSk7XG4gICAgICAgIH0sIHJlc3BvbnNlRXJyb3I6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvbG9naW5cIik7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZXNwb25zZSk7XG4gICAgICAgIH1cbiAgICB9O1xufV0pO1xuXG5hcHAuZmFjdG9yeSgncXVlc3Rpb25uYWlyZScsIGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBxdWVzdGlvbnM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBxdWVzdGlvbjogXCJXaGF0IGxhbmd1YWdlKHMpIGRvIHlvdSBzcGVhaz9cIiwgdHlwZTogJ2xpc3QnLFxuICAgICAgICAgICAgICAgIGFuc3dlck9wdGlvbnM6IFsnQWR5Z2hlJywgJ0FsYmFuaWFuJywgJ0FyYWdvbmVzZScsICdBcm1lbmlhbicsICdBcm9tYW5pYW4nLCAnQXJwaXRhbicsICdBc3R1cmlhbicsICdBdmFyJywgJ0F6ZXJiYWlqYW5pJywgJ0Jhc2hraXInLCAnQmFzcXVlJywgJ0JlbGFydXNpYW4nLCAnQm9zbmlhbicsICdCcmV0b24nLCAnQnVsZ2FyaWFuJywgJ0NhdGFsYW4nLCAnQ2hlY2hlbicsICdDaHV2YXNoJywgJ0Nvcm5pc2gnLCAnQ29yc2ljYW4nLCAnQ3JpbWVhbicsICdDcm9hdGlhbicsICdDemVjaCcsICdEYW5pc2gnLCAnRHV0Y2gnLCAnRW5nbGlzaCcsICdFcnp5YScsICdFc3RvbmlhbicsICdGYXJvZXNlJywgJ0Zpbm5pc2gnLCAnRnJlbmNoJywgJ0ZyaXNpYW4nLCAnR2FnYXV6JywgJ0dhbGljaWFuJywgJ0dhbGxvJywgJ0dlb3JnaWFuJywgJ0dlcm1hbicsICdHcmVlaycsICdIdW5nYXJpYW4nLCAnSWNlbGFuZGljJywgJ0luZ3JpYW4nLCAnSXJpc2gnLCAnSXRhbGlhbicsICdLYWJhcmRpYW4nLCAnS2FzaHViaWFuJywgJ0themFraCcsICdMYWRpbicsICdMYXRpbicsICdMYXR2aWFuJywgJ0xheicsICdMaXRodWFuaWFuJywgJ0x1eGVtYm91cmdpc2gnLCAnTWFjZWRvbmlhbicsICdNYWx0ZXNlJywgJ01hbngnLCAnTWFyaScsICdNaW5ncmVsaWFuJywgJ01pcmFuZGVzZScsICdNb250ZW5lZ3JpbicsICdOb3J3ZWdpYW4nLCAnT2NjaXRhbicsICdPc3NldGlhbicsICdQaWNhcmQnLCAnUG9saXNoJywgJ1BvcnR1Z3Vlc2UnLCAnUm9tYW5pJywgJ1JvbWFuaWFuJywgJ1JvbWFuc2gnLCAnUnVzc2lhbicsICdTYW1pJywgJ1NhcmRpbmlhbicsICdTY290cycsICdTY290dGlzaCcsJ0dhZWxpYycsICdTZXJiaWFuJywgJ1NpbGVzaWFuJywgJ1Nsb3ZhaycsICdTbG92ZW5lJywgJ1NvcmJpYW4nLCAnU3BhbmlzaCcsICdTdmFuJywgJ1N3ZWRpc2gnLCAnVGFiYXNhcmFuJywgJ1RhdGFyJywgJ1R1cmtpc2gnLCAnVWtyYWluaWFuJywgJ1ZlcHNpYW4nLCAnVsO1cm8nLCAnV2FsbG9vbicsICdXZWxzaCcsICdXeW15c29yeXMnXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBxdWVzdGlvbjogJ1doYXQgZmllbGQgZG8geW91IHdvcmsgaW4/JyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnbGlzdCcsXG4gICAgICAgICAgICAgICAgYW5zd2VyT3B0aW9uczogWydBZ3JpY3VsdHVyZScsICdJbmR1c3RyeScsICdTZXJ2aWNlcyddXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHF1ZXN0aW9uOiAnV2hhdCBjbGltYXRlKHMpIHdvdWxkIHlvdSBwcmVmZXI/JyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnbGlzdCcsXG4gICAgICAgICAgICAgICAgYW5zd2VyT3B0aW9uczogWydUZW1wZXJhdGUnLCAnTWVkaXRlcnJhbmVhbicsICdUcm9waWNhbCcsICdBcmlkJywgJ0Rlc2VydCcsICdNYXJpdGltZScsICdXZXQnXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBxdWVzdGlvbjogJ1doYXQgaXMgdGhlIGlkZWFsIHNpemUgZm9yIHRoZSBsYXJnZXN0IG1ldHJvcG9saXRhbiBhcmVhPycsXG4gICAgICAgICAgICAgICAgdHlwZTogJ2xpc3QnLFxuICAgICAgICAgICAgICAgIGFuc3dlck9wdGlvbnM6IFsnU21hbGwgKDwxMDAsMDAwKScsICdNZWRpdW0gKDEwMCwwMDAtMSBtaWxsaW9uKScsICdMYXJnZSAoPjEgbWlsbGlvbiknXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBxdWVzdGlvbjogJ1dvdWxkIHlvdSBsaWtlIHRoZSBwb3B1bGF0aW9uIGRpc3RyaWJ1dGlvbiB0byBiZSBtb3N0bHkgdXJiYW4/JyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcXVlc3Rpb246ICdXaGF0IHdvdWxkIHlvdXIgaWRlYWwgbWVkaWFuIGFnZSByYW5nZSBiZT8nLCB0eXBlOiAnbGlzdCcsXG4gICAgICAgICAgICAgICAgYW5zd2VyT3B0aW9uczogWycyMC0zMHlycycsICczMC00MHlycycsICc0MCt5ZWFycyddXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHF1ZXN0aW9uOiAnV2hhdCBjb3N0IG9mIGxpdmluZyBzaG91bGQgeW91ciBkZXN0aW5hdGlvbiBoYXZlPycsIHR5cGU6J2xpc3QnLFxuICAgICAgICAgICAgICAgIGFuc3dlck9wdGlvbnM6IFsnSGlnaCcsJ0F2ZXJhZ2UnLCdMb3cnXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBxdWVzdGlvbjogJ1doYXQgcGVyY2VudGFnZSBvZiB0aGUgcG9wdWxhdGlvbiBzaG91bGQgYmUgaW50ZXJuZXQgdXNlcnM/JywgdHlwZTonbGlzdCcsXG4gICAgICAgICAgICAgICAgYW5zd2VyT3B0aW9uczogWyc8MjUlJywnMjUlLTUwJScsJzUwJS03NSUnLCc+NzUlJ11cbiAgICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgZGV0ZXJtaW5lUmVjb21tZW5kYXRpb25zOiBmdW5jdGlvbihxdWVzdGlvbm5haXJlQW5zd2Vycyxjb3VudHJpZXNUb1NlYXJjaCl7XG5cbiAgICAgICAgICAgIGNvdW50cmllcyA9IFtdO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRQcm9wb3J0aW9uYWxTY29yZShsb3dlckxpbWl0LHVwcGVyTGltaXQsdmFsdWUpe1xuXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3ZhbHVlJyx2YWx1ZSk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2codXBwZXJMaW1pdCxsb3dlckxpbWl0KTtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPj0gbG93ZXJMaW1pdCAmJiB2YWx1ZSA8PSB1cHBlckxpbWl0KXtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEwO1xuICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGltaXQgPSBNYXRoLmFicyh2YWx1ZS1sb3dlckxpbWl0KSA+IE1hdGguYWJzKHZhbHVlLXVwcGVyTGltaXQpID8gdXBwZXJMaW1pdCA6IGxvd2VyTGltaXQ7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtdWx0aXBsaWVyID0gdmFsdWUgPiBsaW1pdCA/IDAuNSA6IDEuNTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNjb3JlID0gMjAqKDEgLSBNYXRoLm1pbigxLE1hdGguYWJzKHZhbHVlIC0gbXVsdGlwbGllcipsaW1pdCkvbGltaXQpKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coc2NvcmUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NvcmU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb3VudHJpZXNUb1NlYXJjaC5mb3JFYWNoKGZ1bmN0aW9uKGNvdW50cnksaW5kZXgpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2NvcmUgPSAwLCB1cHBlckxpbWl0LCBsb3dlckxpbWl0LCBjbGltYXRlU3RyaW5nO1xuICAgICAgICAgICAgICAgIHZhciBsYWJvclBlcmNlbnQgPSBjb3VudHJ5LmxhYm9yW3F1ZXN0aW9ubmFpcmVBbnN3ZXJzLnF1ZXN0aW9uMl0gfHwgMDtcbiAgICAgICAgICAgICAgICAvL2lmIHVzZXIncyBzcGVjaWZpZWQgaW5kdXN0cnkgaXMgbW9yZSB0aGFuIDc1JSBvZiB0aGUgY291bnRyeSdzIHdvcmtmb3JjZSwgc2V0IHNjb3JlIHRvIDEwXG4gICAgICAgICAgICAgICAgdmFyIGxhYm9yU2NvcmUgPSBsYWJvclBlcmNlbnQvNy41ID4gMTAgPyAxMCA6IGxhYm9yUGVyY2VudC8xMDtcbiAgICAgICAgICAgICAgICAvL2NyZWF0ZSBSZWd1bGFyIEV4cHJlc3Npb24gdG8gY2hlY2sgY2xpbWF0ZSBzdHJpbmcgZm9yIGNsaW1hdGUgYW5zd2Vyc1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcXVlc3Rpb25uYWlyZUFuc3dlcnMucXVlc3Rpb24zID09ICdhcnJheScpIHtcbiAgICAgICAgICAgICAgICAgICAgY2xpbWF0ZVN0cmluZyA9IG5ldyBSZWdFeHAocXVlc3Rpb25uYWlyZUFuc3dlcnMucXVlc3Rpb24zLmpvaW4oJ3wnKSwnaScpO1xuICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICBjbGltYXRlU3RyaW5nID0gbmV3IFJlZ0V4cChxdWVzdGlvbm5haXJlQW5zd2Vycy5xdWVzdGlvbjMsJ2knKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy9pZiBjbGltYXRlIHN0cmluZyBjb250YWlucyBvbmUgb2YgdGhlIGNsaW1hdGUgYW5zd2Vycywgc2V0IHNjb3JlIHRvIDEwXG4gICAgICAgICAgICAgICAgdmFyIGNsaW1hdGVTY29yZSA9IGNvdW50cnkuY2xpbWF0ZS5tYXRjaChjbGltYXRlU3RyaW5nKSAhPSBudWxsID8gMTA6IDA7XG5cblxuICAgICAgICAgICAgICAgIC8vaWYgKGNvdW50cnkucGVyQ2FwaXRhUFBQID4gbG93ZXJMaW1pdCAmJiBjb3VudHJ5LnBlckNhcGl0YVBQUCA8IHVwcGVyTGltaXQpe1xuICAgICAgICAgICAgICAgIC8vICAgIHBlckNhcGl0YVBQUFNjb3JlID0gMTA7XG4gICAgICAgICAgICAgICAgLy99ZWxzZXtcbiAgICAgICAgICAgICAgICAvLyAgICB2YXIgbG93UGVyQ2FwaXRhUFBQU2NvcmUgPSAxIC0gTWF0aC5hYnMoY291bnRyeS5wZXJDYXBpdGFQUFAgLSBsb3dlckxpbWl0KS9sb3dlckxpbWl0O1xuICAgICAgICAgICAgICAgIC8vICAgIHZhciBoaWdoUGVyQ2FwaXRhUFBQU2NvcmUgPSAxIC0gTWF0aC5hYnMoY291bnRyeS5wZXJDYXBpdGFQUFAgLSBsb3dlckxpbWl0KS91cHBlckxpbWl0O1xuICAgICAgICAgICAgICAgIC8vICAgIHBlckNhcGl0YVBQUFNjb3JlID0gMTAqKE1hdGgubWluKGxvd0xhcmdlc3RDaXR5UG9wU2NvcmUsaGlnaExhcmdlc3RDaXR5UG9wU2NvcmUpKTtcbiAgICAgICAgICAgICAgICAvL31cblxuICAgICAgICAgICAgICAgIHZhciB1c2VyTGFyZ2VzdENpdHlQb3AgPSBxdWVzdGlvbm5haXJlQW5zd2Vycy5xdWVzdGlvbjQ7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2codXNlckxhcmdlc3RDaXR5UG9wKTtcbiAgICAgICAgICAgICAgICBzd2l0Y2godXNlckxhcmdlc3RDaXR5UG9wKXtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnU21hbGwgKDwxMDAsMDAwKSc6XG4gICAgICAgICAgICAgICAgICAgICAgICBsb3dlckxpbWl0ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwcGVyTGltaXQgPSAxRTU7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnTWVkaXVtICgxMDAsMDAwLTEgbWlsbGlvbiknOlxuICAgICAgICAgICAgICAgICAgICAgICAgbG93ZXJMaW1pdCA9IDFFNTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwcGVyTGltaXQgPSAxRTY7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnTGFyZ2UgKD4xIG1pbGxpb24pJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VyTGltaXQgPSAxRTY7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cHBlckxpbWl0ID0gMUUyMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGNvdW50cnkuY291bnRyeU5hbWUpO1xuICAgICAgICAgICAgICAgIHZhciBsYXJnZXN0Q2l0eVBvcFNjb3JlID0gZ2V0UHJvcG9ydGlvbmFsU2NvcmUobG93ZXJMaW1pdCx1cHBlckxpbWl0LGNvdW50cnkubGFyZ2VzdENpdHlQb3ApIHx8IDA7XG5cbiAgICAgICAgICAgICAgICAvL2lmIChjb3VudHJ5Lmxhcmdlc3RDaXR5UG9wID4gbG93ZXJMaW1pdCAmJiBjb3VudHJ5Lmxhcmdlc3RDaXR5UG9wIDwgdXBwZXJMaW1pdCl7XG4gICAgICAgICAgICAgICAgLy8gICAgbGFyZ2VzdENpdHlQb3BTY29yZSA9IDEwO1xuICAgICAgICAgICAgICAgIC8vfWVsc2V7XG4gICAgICAgICAgICAgICAgLy8gICAgdmFyIGxvd0xhcmdlc3RDaXR5UG9wU2NvcmUgPSAxIC0gTWF0aC5hYnMoY291bnRyeS5sYXJnZXN0Q2l0eVBvcCAtIGxvd2VyTGltaXQpL2xvd2VyTGltaXQ7XG4gICAgICAgICAgICAgICAgLy8gICAgdmFyIGhpZ2hMYXJnZXN0Q2l0eVBvcFNjb3JlID0gMSAtIE1hdGguYWJzKGNvdW50cnkubGFyZ2VzdENpdHlQb3AtdXBwZXJMaW1pdCkvdXBwZXJMaW1pdDtcbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIC8vICAgIGxhcmdlc3RDaXR5UG9wU2NvcmUgPSAxMCooTWF0aC5taW4obG93TGFyZ2VzdENpdHlQb3BTY29yZSxoaWdoTGFyZ2VzdENpdHlQb3BTY29yZSkpO1xuICAgICAgICAgICAgICAgIC8vfVxuICAgICAgICAgICAgICAgIHZhciB1c2VyVXJiYW5Qb3B1bGF0aW9uID0gcXVlc3Rpb25uYWlyZUFuc3dlcnMucXVlc3Rpb241O1xuICAgICAgICAgICAgICAgIHZhciB1cmJhblBvcHVsYXRpb25TY29yZTtcbiAgICAgICAgICAgICAgICBpZih1c2VyVXJiYW5Qb3B1bGF0aW9uKXtcbiAgICAgICAgICAgICAgICAgICAgdXJiYW5Qb3B1bGF0aW9uU2NvcmUgPSBjb3VudHJ5LnVyYmFuUG9wdWxhdGlvbiA+IDUwID8gMTAgOiAxMCpjb3VudHJ5LnVyYmFuUG9wdWxhdGlvbi81MDtcbiAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgdXJiYW5Qb3B1bGF0aW9uU2NvcmUgPSBjb3VudHJ5LnVyYmFuUG9wdWxhdGlvbiA8IDUwID8gMTAgOiAxMCo1MC9jb3VudHJ5LnVyYmFuUG9wdWxhdGlvbjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgdXNlck1lZGlhbkFnZSA9IHF1ZXN0aW9ubmFpcmVBbnN3ZXJzLnF1ZXN0aW9uNjtcbiAgICAgICAgICAgICAgICBzd2l0Y2godXNlck1lZGlhbkFnZSl7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJzIwLTMweXJzJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VyTGltaXQgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBwZXJMaW1pdCA9IDMwO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJzMwLTQweXJzJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VyTGltaXQgPSAzMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwcGVyTGltaXQgPSA0MDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICc0MCt5ZWFycyc6XG4gICAgICAgICAgICAgICAgICAgICAgICBsb3dlckxpbWl0ID0gNDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cHBlckxpbWl0ID0gMTUwO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgbWVkaWFuQWdlU2NvcmUgPSBnZXRQcm9wb3J0aW9uYWxTY29yZShsb3dlckxpbWl0LHVwcGVyTGltaXQsY291bnRyeS5tZWRpYW5BZ2UpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHVzZXJQZXJDYXBpdGFQUFAgPSBxdWVzdGlvbm5haXJlQW5zd2Vycy5xdWVzdGlvbjc7XG4gICAgICAgICAgICAgICAgc3dpdGNoKHVzZXJQZXJDYXBpdGFQUFApe1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdIaWdoJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VyTGltaXQgPSA2MDAwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwcGVyTGltaXQgPSAxRTEwO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ0F2ZXJhZ2UnOlxuICAgICAgICAgICAgICAgICAgICAgICAgbG93ZXJMaW1pdCA9IDMwMDAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBwZXJMaW1pdCA9IDYwMDAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ0xvdyc6XG4gICAgICAgICAgICAgICAgICAgICAgICBsb3dlckxpbWl0ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwcGVyTGltaXQgPSAzMDAwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBwZXJDYXBpdGFQUFBTY29yZSA9IGdldFByb3BvcnRpb25hbFNjb3JlKGxvd2VyTGltaXQsdXBwZXJMaW1pdCxjb3VudHJ5LnBlckNhcGl0YVBQUCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgdXNlckludGVybmV0VXNhZ2VQZXJDYXBpdGEgPSBxdWVzdGlvbm5haXJlQW5zd2Vycy5xdWVzdGlvbjg7XG4gICAgICAgICAgICAgICAgc3dpdGNoKHVzZXJJbnRlcm5ldFVzYWdlUGVyQ2FwaXRhKXtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnPDI1JSc6XG4gICAgICAgICAgICAgICAgICAgICAgICBsb3dlckxpbWl0ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwcGVyTGltaXQgPSAyNTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICcyNSUtNTAlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VyTGltaXQgPSAyNTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwcGVyTGltaXQgPSA1MDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICc1MCUtNzUlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VyTGltaXQgPSA1MDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwcGVyTGltaXQgPSA3NTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgbG93ZXJMaW1pdCA9IDc1O1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBwZXJMaW1pdCA9IDEwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBpbnRlcm5ldFVzYWdlU2NvcmUgPSBnZXRQcm9wb3J0aW9uYWxTY29yZShsb3dlckxpbWl0LHVwcGVyTGltaXQsY291bnRyeS5pbnRlcm5ldFVzYWdlUGVyQ2FwaXRhKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbGFib3JTY29yZScsbGFib3JTY29yZSwnY2xpbWF0ZVNjb3JlJyxjbGltYXRlU2NvcmUsJ2xhcmdlc3RDaXR5UG9wU2NvcmUnLGxhcmdlc3RDaXR5UG9wU2NvcmUsJ3VyYmFuUG9wdWxhdGlvblNjb3JlJyx1cmJhblBvcHVsYXRpb25TY29yZSwncGVyQ2FwaXRhUFBQU2NvcmUnLHBlckNhcGl0YVBQUFNjb3JlLCdtZWRpYW5BZ2VTY29yZScsbWVkaWFuQWdlU2NvcmUsJ2ludGVybmV0VXNhZ2VTY29yZScsaW50ZXJuZXRVc2FnZVNjb3JlKTtcbiAgICAgICAgICAgICAgICBzY29yZSA9IHNjb3JlICsgbGFib3JTY29yZSArIGNsaW1hdGVTY29yZSArIGxhcmdlc3RDaXR5UG9wU2NvcmUgKyB1cmJhblBvcHVsYXRpb25TY29yZSArIHBlckNhcGl0YVBQUFNjb3JlICsgbWVkaWFuQWdlU2NvcmUgKyBpbnRlcm5ldFVzYWdlU2NvcmU7XG4gICAgICAgICAgICAgICAgY291bnRyeS5zY29yZSA9IHNjb3JlO1xuICAgICAgICAgICAgICAgIGNvdW50cmllcy5wdXNoKGNvdW50cnkpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvdW50cmllcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhLnNjb3JlID4gYi5zY29yZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChhLnNjb3JlIDwgYi5zY29yZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYoYS5jb3VudHJ5TmFtZSA+IGIuY291bnRyeU5hbWUpe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYoYS5jb3VudHJ5TmFtZSA8IGIuY291bnRyeU5hbWUpe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvdW50cmllcy5zbGljZSgwLDQpO1xuICAgICAgICB9XG4gICAgfTtcbn0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==